import{r as l,j as e,L as O,aG as ee,aH as se,aI as te,aJ as ae,f as ne,S as le,aw as ie,aK as re,k as M,F as oe,as as ce,aL as de,R as me}from"./react-vendor.BA2wKBqg.js";import{P as he,a as xe,H as ue,A as ge,T as je,v as pe,G as fe}from"./pdf-vendor.CqKMeSPQ.js";import{C as E}from"./card.Dz2pXIg4.js";import{B as j}from"./button.ByCdt4UQ.js";import{S as ve}from"./scroll-area.BPg4eSwv.js";import{T as be,a as Ne,b as B,c as z}from"./tabs.C_L4uOLP.js";import{B as $}from"./badge.B5VK528j.js";import{P as we}from"./progress.ByCiXuA5.js";import{A as G,a as J}from"./alert.Cgxt91Jd.js";import"./ui-vendor.BQCqNqg0.js";import"./index.DFUPT9Yl.js";typeof window<"u"&&(fe.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pe}/pdf.worker.min.js`);const Ce=()=>`highlight-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,Z=()=>{document.location.hash=""},Se=()=>document.location.hash.slice(11),ye=({comment:i})=>i.text?e.jsxs("div",{className:"highlight-popup bg-white shadow-lg rounded p-2 text-sm",children:[i.emoji&&e.jsx("span",{className:"mr-1",children:i.emoji}),i.text]}):null,He=({pdfUrl:i,highlights:r,onAddHighlight:w,onUpdateHighlight:h,onDeleteHighlight:u,selectedColor:a,scale:L,currentPage:F,onPageChange:I,onTotalPagesChange:o,readOnly:x=!1})=>{const[C,R]=l.useState(!0),g=l.useRef(()=>{});l.useEffect(()=>{const c=Se(),t=r.find(p=>p.id===c);t&&g.current&&g.current(t)},[r]);const y=c=>{if(x)return;const t={...c,id:Ce()};w(t),Z()},f=c=>{document.location.hash=`highlight-${c.id}`};return e.jsx("div",{className:"pdf-highlighter-container h-full",children:e.jsx(he,{url:i,beforeLoad:e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(O,{className:"w-8 h-8 animate-spin"})}),onError:c=>(console.error("PDF loading error:",c),e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-red-500",children:"Failed to load PDF"})})),children:c=>e.jsx(xe,{pdfDocument:c,enableAreaSelection:t=>!x&&t.altKey,onScrollChange:Z,scrollRef:t=>{g.current=t},onSelectionFinished:(t,p,v,b)=>x?null:e.jsx(je,{onOpen:b,onConfirm:S=>{y({content:p,position:t,comment:S}),v()}}),highlightTransform:(t,p,v,b,S,T,H)=>{const P=!(t.content&&t.content.image)?e.jsx(ue,{isScrolledTo:H,position:t.position,comment:t.comment}):e.jsx(ge,{isScrolledTo:H,highlight:t,onChange:N=>{x||h(t.id,{position:{...t.position,boundingRect:N}})}});return e.jsx("div",{onMouseEnter:()=>v(t,N=>e.jsx(ye,{comment:N.comment})),onMouseLeave:b,onClick:()=>f(t),style:{background:a.rgba,position:"relative"},children:P},p)},highlights:r})})})},k=[{name:"Yellow",value:"#ffeb3b",rgba:"rgba(255, 235, 59, 0.4)"},{name:"Green",value:"#4caf50",rgba:"rgba(76, 175, 80, 0.4)"},{name:"Blue",value:"#2196f3",rgba:"rgba(33, 150, 243, 0.4)"},{name:"Pink",value:"#e91e63",rgba:"rgba(233, 30, 99, 0.4)"},{name:"Purple",value:"#9c27b0",rgba:"rgba(156, 39, 176, 0.4)"}];function Pe({pdfUrl:i,pdfFile:r,initialAnnotations:w=[],onAnnotationsChange:h,onSave:u,readOnly:a=!1,showToolbar:L=!0,height:F="800px",className:I=""}){const[o,x]=l.useState(w),[C,R]=l.useState(k[0]),[g,y]=l.useState(1),[f,c]=l.useState(1),[t,p]=l.useState(0),[v,b]=l.useState(null),[S,T]=l.useState(!1),[H,A]=l.useState(null),[P,N]=l.useState(null);l.useEffect(()=>{if(r){const s=URL.createObjectURL(r);return N(s),()=>URL.revokeObjectURL(s)}else i&&N(i)},[r,i]),l.useEffect(()=>{h?.(o)},[o,h]);const V=l.useCallback(s=>{if(a)return;const n={...s,color:C.value,createdAt:new Date().toISOString()};x(d=>[...d,n])},[a,C]),K=l.useCallback((s,n)=>{a||x(d=>d.map(m=>m.id===s?{...m,...n,updatedAt:new Date().toISOString()}:m))},[a]),U=l.useCallback(s=>{a||(x(n=>n.filter(d=>d.id!==s)),A(null))},[a]),W=async()=>{if(u){T(!0);try{await u(o)}catch(s){b("Failed to save annotations"),console.error("Save error:",s)}finally{T(!1)}}},q=()=>{const s=JSON.stringify(o,null,2),n="data:application/json;charset=utf-8,"+encodeURIComponent(s),d=`annotations-${Date.now()}.json`,m=document.createElement("a");m.setAttribute("href",n),m.setAttribute("download",d),m.click()},Y=s=>{const n=s.target.files?.[0];if(!n)return;const d=new FileReader;d.onload=m=>{try{const D=JSON.parse(m.target?.result);x(D)}catch(D){b("Failed to import annotations"),console.error("Import error:",D)}},d.readAsText(n)},_=()=>y(s=>Math.min(s+.25,3)),Q=()=>y(s=>Math.max(s-.25,.5)),X=s=>{A(s.id);const n=document.getElementById(s.id);n&&n.scrollIntoView({behavior:"smooth",block:"center"})};return P?e.jsxs("div",{className:`pdf-annotator-wrapper ${I}`,children:[L&&e.jsx(E,{className:"mb-4 p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[!a&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Color:"}),e.jsx("div",{className:"flex gap-1",children:k.map(s=>e.jsx("button",{onClick:()=>R(s),className:`w-6 h-6 rounded border-2 transition-all ${C.value===s.value?"border-gray-800 scale-110":"border-gray-300"}`,style:{backgroundColor:s.value},title:s.name},s.value))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:Q,disabled:g<=.5,children:e.jsx(se,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm font-medium min-w-[60px] text-center",children:[Math.round(g*100),"%"]}),e.jsx(j,{variant:"outline",size:"sm",onClick:_,disabled:g>=3,children:e.jsx(te,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:()=>c(s=>Math.max(s-1,1)),disabled:f<=1,children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm font-medium min-w-[80px] text-center",children:["Page ",f," / ",t]}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>c(s=>Math.min(s+1,t)),disabled:f>=t,children:e.jsx(ne,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[u&&!a&&e.jsxs(j,{variant:"default",size:"sm",onClick:W,disabled:S,children:[S?e.jsx(O,{className:"w-4 h-4 animate-spin"}):e.jsx(le,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"Save"})]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:q,disabled:o.length===0,children:[e.jsx(ie,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"Export"})]}),!a&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",accept:".json",onChange:Y,className:"hidden",id:"import-annotations"}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>document.getElementById("import-annotations")?.click(),children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"Import"})]})]})]})]})}),v&&e.jsx(G,{className:"mb-4",variant:"destructive",children:e.jsx(J,{children:v})}),e.jsxs("div",{className:"flex gap-4",style:{height:F},children:[e.jsx(E,{className:"flex-1 overflow-hidden",children:e.jsx(He,{pdfUrl:P,highlights:o,onAddHighlight:V,onUpdateHighlight:K,onDeleteHighlight:U,selectedColor:C,scale:g,currentPage:f,onPageChange:c,onTotalPagesChange:p,readOnly:a})}),e.jsx(E,{className:"w-80",children:e.jsxs(be,{defaultValue:"annotations",className:"h-full flex flex-col",children:[e.jsxs(Ne,{className:"grid w-full grid-cols-2",children:[e.jsxs(B,{value:"annotations",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Annotations"]}),e.jsxs(B,{value:"details",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Details"]})]}),e.jsx(z,{value:"annotations",className:"flex-1 overflow-hidden",children:e.jsx(ve,{className:"h-full p-4",children:o.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx(M,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No annotations yet"}),!a&&e.jsx("p",{className:"text-xs mt-2",children:"Select text to add highlights"})]}):e.jsx("div",{className:"space-y-3",children:o.map(s=>e.jsxs("div",{className:`p-3 rounded-lg border cursor-pointer transition-all ${H===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>X(s),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:s.color||k[0].value}}),!a&&e.jsx(j,{variant:"ghost",size:"sm",onClick:n=>{n.stopPropagation(),U(s.id)},children:e.jsx(ce,{className:"w-3 h-3"})})]}),s.content.text&&e.jsxs("p",{className:"text-sm text-gray-700 mb-2 line-clamp-3",children:['"',s.content.text,'"']}),s.comment&&e.jsx("div",{className:"bg-gray-50 rounded p-2",children:e.jsx("p",{className:"text-xs text-gray-600",children:s.comment.text})}),e.jsx("div",{className:"mt-2 text-xs text-gray-500",children:new Date(s.createdAt).toLocaleString()})]},s.id))})})}),e.jsx(z,{value:"details",className:"flex-1 p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Statistics"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Total Annotations"}),e.jsx($,{children:o.length})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Pages"}),e.jsx($,{children:t})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Color Distribution"}),e.jsx("div",{className:"space-y-2",children:k.map(s=>{const n=o.filter(m=>m.color===s.value).length,d=o.length>0?n/o.length*100:0;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:s.value}}),e.jsx("span",{className:"text-gray-600",children:s.name})]}),e.jsx("span",{children:n})]}),e.jsx(we,{value:d,className:"h-1"})]},s.value)})})]})]})})]})})]})]}):e.jsx(G,{children:e.jsx(J,{children:"No PDF file or URL provided. Please provide a PDF to annotate."})})}function Be(i,r){const w=de.createRoot(i);i.innerHTML="",w.render(e.jsx(me.StrictMode,{children:e.jsx(Pe,{pdfUrl:r.pdfUrl,initialAnnotations:r.initialAnnotations,readOnly:r.readOnly,showToolbar:r.showToolbar,height:r.height,onAnnotationsChange:h=>{const u=new CustomEvent("pdf-annotations-change",{detail:{annotations:h},bubbles:!0});i.dispatchEvent(u)},onSave:async h=>{const u=new CustomEvent("pdf-annotations-save",{detail:{annotations:h},bubbles:!0});i.dispatchEvent(u);try{const a=await fetch("/api/pdf-annotations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({annotations:h})});if(!a.ok)throw new Error("Failed to save annotations");return await a.json()}catch(a){throw console.error("Error saving annotations:",a),a}}})}))}export{Be as default};
//# sourceMappingURL=PDFAnnotatorIslandLoader.ZJHXR8u8.js.map
