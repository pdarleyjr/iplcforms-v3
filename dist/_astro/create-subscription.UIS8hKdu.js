import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{B as o}from"./button.DAHL7osy.js";import{D as S,a as D,b as E,c as P,d as T}from"./dialog.CJQRyvNY.js";import{o as N,g as B,n as I,s as c,u as V,a as k,F as L,b as u,c as x,d as l,e as h,f as j}from"./schemas.DmIWGFrR.js";import{I as m}from"./input.BqLLRaLk.js";import{T as O}from"./textarea.BU_xJv7O.js";import{r as f}from"./index.7-fRwNhn.js";import{a as R}from"./api.BiPwSYRr.js";import{P as z}from"./plus.q9ev0EMF.js";import{X as A}from"./x.iTm9BFym.js";import"./index.CuufFikk.js";import"./index.DVFN_t0d.js";import"./index.AmEYgA8_.js";import"./index.BDInZWg7.js";import"./index.BhDqio8u.js";import"./Combination.D1D1t5_V.js";import"./index.D1rCwynp.js";import"./label.CzLeOBg3.js";const H=N({name:c().min(2,"Name must be at least 2 characters"),description:c().min(10,"Description must be at least 10 characters"),price:I().min(0,"Price must be a positive number"),features:B(N({name:c().min(2,"Feature name must be at least 2 characters"),description:c().optional()}))});function ne({apiToken:w}){const[v,b]=f.useState(!1),[i,d]=f.useState([]),[a,p]=f.useState({name:"",description:""}),t=V({resolver:k(H),defaultValues:{name:"",description:"",price:0,features:[]}}),C=r=>{const s=i.filter((n,F)=>F!==r);d(s),t.setValue("features",s)},g=async()=>a.name.trim()?new Promise(r=>{d(s=>{const n=[...s,a];return t.setValue("features",n),r(n),n}),p({name:"",description:""})}):i,y=async r=>{try{let s=i;a.name.trim()&&(s=await g());const n=new URL(window.location.href);if(!(await R(n.origin,w,{...r,features:s})).success)throw new Error("Failed to create subscription");t.reset(),d([]),b(!1),window.location.reload()}catch(s){console.error("Error creating subscription:",s)}};return e.jsxs(S,{open:v,onOpenChange:b,children:[e.jsx(D,{asChild:!0,children:e.jsxs(o,{children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Create New Subscription"]})}),e.jsxs(E,{className:"sm:max-w-[600px]",children:[e.jsx(P,{children:e.jsx(T,{children:"Create New Subscription"})}),e.jsx(L,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(y),className:"space-y-4",children:[e.jsx(u,{control:t.control,name:"name",render:({field:r})=>e.jsxs(x,{children:[e.jsx(l,{children:"Name"}),e.jsx(h,{children:e.jsx(m,{placeholder:"Enter subscription name",...r})}),e.jsx(j,{})]})}),e.jsx(u,{control:t.control,name:"description",render:({field:r})=>e.jsxs(x,{children:[e.jsx(l,{children:"Description"}),e.jsx(h,{children:e.jsx(O,{placeholder:"Enter subscription description",...r})}),e.jsx(j,{})]})}),e.jsx(u,{control:t.control,name:"price",render:({field:r})=>e.jsxs(x,{children:[e.jsx(l,{children:"Price"}),e.jsx(h,{children:e.jsx(m,{type:"number",placeholder:"Enter price",...r,onChange:s=>r.onChange(Number(s.target.value))})}),e.jsx(j,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{children:"Features"}),e.jsx("div",{className:"space-y-2",children:i.map((r,s)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-md",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:r.name}),r.description&&e.jsx("div",{className:"text-sm text-gray-500",children:r.description})]}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>C(s),children:e.jsx(A,{className:"h-4 w-4"})})]},s))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(m,{placeholder:"Feature name",value:a.name,onChange:r=>p({...a,name:r.target.value})}),e.jsx(m,{placeholder:"Feature description (optional)",value:a.description,onChange:r=>p({...a,description:r.target.value})})]}),e.jsx(o,{type:"button",onClick:g,className:"self-start",children:"Add Feature"})]})]}),e.jsx(o,{type:"submit",className:"w-full",children:"Create Subscription"})]})})]})]})}export{ne as CreateSubscriptionButton};
//# sourceMappingURL=create-subscription.UIS8hKdu.js.map
