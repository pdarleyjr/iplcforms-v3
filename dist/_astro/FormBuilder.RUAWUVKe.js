import{c as _,j as t,a as be}from"./index.BDwUue4i.js";import{r as c,R as P}from"./index.D4lIrffr.js";import{B as W}from"./button.BBqis-m9.js";import{D as Tn,b as Rn,c as Mn,d as Fn}from"./dialog.epzmHarR.js";import{T as Ln,a as On,b as Yt,c as Wt}from"./tabs.BHKcKwpR.js";import{o as In,h as bs,s as Ne,_ as Pn,n as _n,g as Bn,u as $n,a as zn,F as qn,b as yt,c as wt,d as jt,e as Nt,f as Ct}from"./schemas.8s39zcMy.js";import{I as B}from"./input.DVIqiHmA.js";import{T as Et}from"./textarea.Db7GML6A.js";import{P as Vn,e as os,S as Ps,a as _s,T as Bs,b as Hn}from"./evaluation-sections-config.BCkyIMEa.js";import{S as Be,a as $e,b as ze,c as qe,d as z}from"./select.ihagOez5.js";import{C as Un}from"./checkbox.BaXQiebc.js";import{r as rt}from"./index.CWpJmkEa.js";import{C as $s,a as Xn}from"./ComponentPalette.DKYJRQb7.js";import{C as Pt,d as _t,a as is,b as ls,c as zs}from"./card.DLdw4ClT.js";import{L as at}from"./label.DrpxMY44.js";import{B as Ce}from"./badge.CaCO5-Vh.js";import{A as qs,R as Yn}from"./AISummaryElement.1jwThfLI.js";import{E as At,b as Vs,S as Wn,a as Kn,B as Gn,C as Jn,U as Zn,T as Qn}from"./scroll-area.uohAyeuR.js";import{C as Hs}from"./type.Bd32Sr5l.js";import{C as Tt}from"./chevron-right.CaEU_g0D.js";import{C as es}from"./calendar.CvMlM1NW.js";import{M as er}from"./menu.Dp7BajDY.js";import{F as Ve}from"./file-text.CGEFS-_6.js";import{C as ys}from"./chevron-down.4jjxEcjq.js";import{M as tr}from"./message-square.CgYO-VTg.js";import{P as ts}from"./plus.B0ra3a6p.js";import{S as ss}from"./shield.Cm9dfRAP.js";import{U as sr}from"./users.CXBGSiUN.js";import{A as Us,a as Xs}from"./alert.DYfTMRW2.js";import{L as Ys,C as nr}from"./loader-circle.CFEkYbsw.js";import{S as rr}from"./sparkles.CBLYbECK.js";import{L as ar,S as or}from"./save.D1TtpFub.js";import{S as ir}from"./settings.CBq_9z7J.js";import"./index.7Xl9-Kly.js";import"./Combination.DEQktaGu.js";import"./index.BXhwHFWz.js";import"./x.D5giPUq_.js";import"./index.DPnI-K_u.js";import"./index.BQPgbWHL.js";import"./index.BIhjN8Ec.js";import"./index.C_ksqHmP.js";import"./circle.CZXr8haV.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lr=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],cr=_("activity",lr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dr=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],ur=_("award",dr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mr=[["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M19.38 6.813A9 9 0 0 1 20.8 10.2a2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"11xh7x"}],["path",{d:"M9 12h.01",key:"157uk2"}]],hr=_("baby",mr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fr=[["path",{d:"M10 4 8 6",key:"1rru8s"}],["path",{d:"M17 19v2",key:"ts1sot"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"M7 19v2",key:"12npes"}],["path",{d:"M9 5 7.621 3.621A2.121 2.121 0 0 0 4 5v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5",key:"14ym8i"}]],pr=_("bath",fr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gr=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],xr=_("briefcase",gr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]],br=_("car",vr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yr=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]],wr=_("cloud-off",yr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],Nr=_("cloud",jr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=[["path",{d:"M6 8.5a6.5 6.5 0 1 1 13 0c0 6-6 6-6 10a3.5 3.5 0 1 1-7 0",key:"1dfaln"}],["path",{d:"M15 8.5a2.5 2.5 0 0 0-5 0v1a2 2 0 1 1 0 4",key:"1qnva7"}]],Sr=_("ear",Cr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]],kr=_("footprints",Dr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Er=[["line",{x1:"6",x2:"10",y1:"12",y2:"12",key:"161bw2"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"15",x2:"15.01",y1:"13",y2:"13",key:"dqpgro"}],["line",{x1:"18",x2:"18.01",y1:"11",y2:"11",key:"meh2c"}],["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}]],Ar=_("gamepad",Er);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]],Rr=_("git-branch",Tr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],Ws=_("grip-vertical",Mr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fr=[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]],Ks=_("hand",Fr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]],Or=_("heart",Lr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],Pr=_("house",Ir);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]],Br=_("pill",_r);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $r=[["path",{d:"M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z",key:"1wgbhj"}]],zr=_("shirt",$r);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qr=[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]],Vr=_("stethoscope",qr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]],Ur=_("test-tube",Hr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xr=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Yr=_("trending-up",Xr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wr=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Kr=_("user-plus",Wr);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],Jr=_("utensils",Gr);function Zr(){for(var e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];return c.useMemo(()=>r=>{s.forEach(a=>a(r))},s)}const Bt=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Je(e){const s=Object.prototype.toString.call(e);return s==="[object Window]"||s==="[object global]"}function cs(e){return"nodeType"in e}function G(e){var s,n;return e?Je(e)?e:cs(e)&&(s=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?s:window:window}function ds(e){const{Document:s}=G(e);return e instanceof s}function ut(e){return Je(e)?!1:e instanceof G(e).HTMLElement}function Gs(e){return e instanceof G(e).SVGElement}function Ze(e){return e?Je(e)?e.document:cs(e)?ds(e)?e:ut(e)||Gs(e)?e.ownerDocument:document:document:document}const he=Bt?c.useLayoutEffect:c.useEffect;function $t(e){const s=c.useRef(e);return he(()=>{s.current=e}),c.useCallback(function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return s.current==null?void 0:s.current(...r)},[])}function Qr(){const e=c.useRef(null),s=c.useCallback((r,a)=>{e.current=setInterval(r,a)},[]),n=c.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[s,n]}function ct(e,s){s===void 0&&(s=[e]);const n=c.useRef(e);return he(()=>{n.current!==e&&(n.current=e)},s),n}function mt(e,s){const n=c.useRef();return c.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...s])}function Rt(e){const s=$t(e),n=c.useRef(null),r=c.useCallback(a=>{a!==n.current&&s?.(a,n.current),n.current=a},[]);return[n,r]}function Mt(e){const s=c.useRef();return c.useEffect(()=>{s.current=e},[e]),s.current}let Kt={};function ht(e,s){return c.useMemo(()=>{if(s)return s;const n=Kt[e]==null?0:Kt[e]+1;return Kt[e]=n,e+"-"+n},[e,s])}function Js(e){return function(s){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return r.reduce((o,i)=>{const l=Object.entries(i);for(const[u,m]of l){const f=o[u];f!=null&&(o[u]=f+e*m)}return o},{...s})}}const Ke=Js(1),dt=Js(-1);function ea(e){return"clientX"in e&&"clientY"in e}function zt(e){if(!e)return!1;const{KeyboardEvent:s}=G(e.target);return s&&e instanceof s}function ta(e){if(!e)return!1;const{TouchEvent:s}=G(e.target);return s&&e instanceof s}function Ft(e){if(ta(e)){if(e.touches&&e.touches.length){const{clientX:s,clientY:n}=e.touches[0];return{x:s,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:s,clientY:n}=e.changedTouches[0];return{x:s,y:n}}}return ea(e)?{x:e.clientX,y:e.clientY}:null}const Le=Object.freeze({Translate:{toString(e){if(!e)return;const{x:s,y:n}=e;return"translate3d("+(s?Math.round(s):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:s,scaleY:n}=e;return"scaleX("+s+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[Le.Translate.toString(e),Le.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:s,duration:n,easing:r}=e;return s+" "+n+"ms "+r}}}),ws="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function sa(e){return e.matches(ws)?e:e.querySelector(ws)}const na={display:"none"};function ra(e){let{id:s,value:n}=e;return P.createElement("div",{id:s,style:na},n)}function aa(e){let{id:s,announcement:n,ariaLiveType:r="assertive"}=e;const a={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return P.createElement("div",{id:s,style:a,role:"status","aria-live":r,"aria-atomic":!0},n)}function oa(){const[e,s]=c.useState("");return{announce:c.useCallback(r=>{r!=null&&s(r)},[]),announcement:e}}const Zs=c.createContext(null);function ia(e){const s=c.useContext(Zs);c.useEffect(()=>{if(!s)throw new Error("useDndMonitor must be used within a children of <DndContext>");return s(e)},[e,s])}function la(){const[e]=c.useState(()=>new Set),s=c.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[c.useCallback(r=>{let{type:a,event:o}=r;e.forEach(i=>{var l;return(l=i[a])==null?void 0:l.call(i,o)})},[e]),s]}const ca={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},da={onDragStart(e){let{active:s}=e;return"Picked up draggable item "+s.id+"."},onDragOver(e){let{active:s,over:n}=e;return n?"Draggable item "+s.id+" was moved over droppable area "+n.id+".":"Draggable item "+s.id+" is no longer over a droppable area."},onDragEnd(e){let{active:s,over:n}=e;return n?"Draggable item "+s.id+" was dropped over droppable area "+n.id:"Draggable item "+s.id+" was dropped."},onDragCancel(e){let{active:s}=e;return"Dragging was cancelled. Draggable item "+s.id+" was dropped."}};function ua(e){let{announcements:s=da,container:n,hiddenTextDescribedById:r,screenReaderInstructions:a=ca}=e;const{announce:o,announcement:i}=oa(),l=ht("DndLiveRegion"),[u,m]=c.useState(!1);if(c.useEffect(()=>{m(!0)},[]),ia(c.useMemo(()=>({onDragStart(d){let{active:p}=d;o(s.onDragStart({active:p}))},onDragMove(d){let{active:p,over:x}=d;s.onDragMove&&o(s.onDragMove({active:p,over:x}))},onDragOver(d){let{active:p,over:x}=d;o(s.onDragOver({active:p,over:x}))},onDragEnd(d){let{active:p,over:x}=d;o(s.onDragEnd({active:p,over:x}))},onDragCancel(d){let{active:p,over:x}=d;o(s.onDragCancel({active:p,over:x}))}}),[o,s])),!u)return null;const f=P.createElement(P.Fragment,null,P.createElement(ra,{id:r,value:a.draggable}),P.createElement(aa,{id:l,announcement:i}));return n?rt.createPortal(f,n):f}var $;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})($||($={}));function Lt(){}function Gt(e,s){return c.useMemo(()=>({sensor:e,options:s??{}}),[e,s])}function ma(){for(var e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];return c.useMemo(()=>[...s].filter(r=>r!=null),[...s])}const fe=Object.freeze({x:0,y:0});function Qs(e,s){return Math.sqrt(Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2))}function ha(e,s){const n=Ft(e);if(!n)return"0 0";const r={x:(n.x-s.left)/s.width*100,y:(n.y-s.top)/s.height*100};return r.x+"% "+r.y+"%"}function en(e,s){let{data:{value:n}}=e,{data:{value:r}}=s;return n-r}function fa(e,s){let{data:{value:n}}=e,{data:{value:r}}=s;return r-n}function js(e){let{left:s,top:n,height:r,width:a}=e;return[{x:s,y:n},{x:s+a,y:n},{x:s,y:n+r},{x:s+a,y:n+r}]}function tn(e,s){if(!e||e.length===0)return null;const[n]=e;return n[s]}function Ns(e,s,n){return s===void 0&&(s=e.left),n===void 0&&(n=e.top),{x:s+e.width*.5,y:n+e.height*.5}}const pa=e=>{let{collisionRect:s,droppableRects:n,droppableContainers:r}=e;const a=Ns(s,s.left,s.top),o=[];for(const i of r){const{id:l}=i,u=n.get(l);if(u){const m=Qs(Ns(u),a);o.push({id:l,data:{droppableContainer:i,value:m}})}}return o.sort(en)},ga=e=>{let{collisionRect:s,droppableRects:n,droppableContainers:r}=e;const a=js(s),o=[];for(const i of r){const{id:l}=i,u=n.get(l);if(u){const m=js(u),f=a.reduce((p,x,j)=>p+Qs(m[j],x),0),d=Number((f/4).toFixed(4));o.push({id:l,data:{droppableContainer:i,value:d}})}}return o.sort(en)};function xa(e,s){const n=Math.max(s.top,e.top),r=Math.max(s.left,e.left),a=Math.min(s.left+s.width,e.left+e.width),o=Math.min(s.top+s.height,e.top+e.height),i=a-r,l=o-n;if(r<a&&n<o){const u=s.width*s.height,m=e.width*e.height,f=i*l,d=f/(u+m-f);return Number(d.toFixed(4))}return 0}const va=e=>{let{collisionRect:s,droppableRects:n,droppableContainers:r}=e;const a=[];for(const o of r){const{id:i}=o,l=n.get(i);if(l){const u=xa(l,s);u>0&&a.push({id:i,data:{droppableContainer:o,value:u}})}}return a.sort(fa)};function ba(e,s,n){return{...e,scaleX:s&&n?s.width/n.width:1,scaleY:s&&n?s.height/n.height:1}}function sn(e,s){return e&&s?{x:e.left-s.left,y:e.top-s.top}:fe}function ya(e){return function(n){for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return a.reduce((i,l)=>({...i,top:i.top+e*l.y,bottom:i.bottom+e*l.y,left:i.left+e*l.x,right:i.right+e*l.x}),{...n})}}const wa=ya(1);function nn(e){if(e.startsWith("matrix3d(")){const s=e.slice(9,-1).split(/, /);return{x:+s[12],y:+s[13],scaleX:+s[0],scaleY:+s[5]}}else if(e.startsWith("matrix(")){const s=e.slice(7,-1).split(/, /);return{x:+s[4],y:+s[5],scaleX:+s[0],scaleY:+s[3]}}return null}function ja(e,s,n){const r=nn(s);if(!r)return e;const{scaleX:a,scaleY:o,x:i,y:l}=r,u=e.left-i-(1-a)*parseFloat(n),m=e.top-l-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),f=a?e.width/a:e.width,d=o?e.height/o:e.height;return{width:f,height:d,top:m,right:u+f,bottom:m+d,left:u}}const Na={ignoreTransform:!1};function Qe(e,s){s===void 0&&(s=Na);let n=e.getBoundingClientRect();if(s.ignoreTransform){const{transform:m,transformOrigin:f}=G(e).getComputedStyle(e);m&&(n=ja(n,m,f))}const{top:r,left:a,width:o,height:i,bottom:l,right:u}=n;return{top:r,left:a,width:o,height:i,bottom:l,right:u}}function Cs(e){return Qe(e,{ignoreTransform:!0})}function Ca(e){const s=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:s,bottom:n,width:s,height:n}}function Sa(e,s){return s===void 0&&(s=G(e).getComputedStyle(e)),s.position==="fixed"}function Da(e,s){s===void 0&&(s=G(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(a=>{const o=s[a];return typeof o=="string"?n.test(o):!1})}function qt(e,s){const n=[];function r(a){if(s!=null&&n.length>=s||!a)return n;if(ds(a)&&a.scrollingElement!=null&&!n.includes(a.scrollingElement))return n.push(a.scrollingElement),n;if(!ut(a)||Gs(a)||n.includes(a))return n;const o=G(e).getComputedStyle(a);return a!==e&&Da(a,o)&&n.push(a),Sa(a,o)?n:r(a.parentNode)}return e?r(e):n}function rn(e){const[s]=qt(e,1);return s??null}function Jt(e){return!Bt||!e?null:Je(e)?e:cs(e)?ds(e)||e===Ze(e).scrollingElement?window:ut(e)?e:null:null}function an(e){return Je(e)?e.scrollX:e.scrollLeft}function on(e){return Je(e)?e.scrollY:e.scrollTop}function ns(e){return{x:an(e),y:on(e)}}var q;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(q||(q={}));function ln(e){return!Bt||!e?!1:e===document.scrollingElement}function cn(e){const s={x:0,y:0},n=ln(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},a=e.scrollTop<=s.y,o=e.scrollLeft<=s.x,i=e.scrollTop>=r.y,l=e.scrollLeft>=r.x;return{isTop:a,isLeft:o,isBottom:i,isRight:l,maxScroll:r,minScroll:s}}const ka={x:.2,y:.2};function Ea(e,s,n,r,a){let{top:o,left:i,right:l,bottom:u}=n;r===void 0&&(r=10),a===void 0&&(a=ka);const{isTop:m,isBottom:f,isLeft:d,isRight:p}=cn(e),x={x:0,y:0},j={x:0,y:0},v={height:s.height*a.y,width:s.width*a.x};return!m&&o<=s.top+v.height?(x.y=q.Backward,j.y=r*Math.abs((s.top+v.height-o)/v.height)):!f&&u>=s.bottom-v.height&&(x.y=q.Forward,j.y=r*Math.abs((s.bottom-v.height-u)/v.height)),!p&&l>=s.right-v.width?(x.x=q.Forward,j.x=r*Math.abs((s.right-v.width-l)/v.width)):!d&&i<=s.left+v.width&&(x.x=q.Backward,j.x=r*Math.abs((s.left+v.width-i)/v.width)),{direction:x,speed:j}}function Aa(e){if(e===document.scrollingElement){const{innerWidth:o,innerHeight:i}=window;return{top:0,left:0,right:o,bottom:i,width:o,height:i}}const{top:s,left:n,right:r,bottom:a}=e.getBoundingClientRect();return{top:s,left:n,right:r,bottom:a,width:e.clientWidth,height:e.clientHeight}}function dn(e){return e.reduce((s,n)=>Ke(s,ns(n)),fe)}function Ta(e){return e.reduce((s,n)=>s+an(n),0)}function Ra(e){return e.reduce((s,n)=>s+on(n),0)}function un(e,s){if(s===void 0&&(s=Qe),!e)return;const{top:n,left:r,bottom:a,right:o}=s(e);rn(e)&&(a<=0||o<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Ma=[["x",["left","right"],Ta],["y",["top","bottom"],Ra]];class us{constructor(s,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=qt(n),a=dn(r);this.rect={...s},this.width=s.width,this.height=s.height;for(const[o,i,l]of Ma)for(const u of i)Object.defineProperty(this,u,{get:()=>{const m=l(r),f=a[o]-m;return this.rect[u]+f},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class ot{constructor(s){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=s}add(s,n,r){var a;(a=this.target)==null||a.addEventListener(s,n,r),this.listeners.push([s,n,r])}}function Fa(e){const{EventTarget:s}=G(e);return e instanceof s?e:Ze(e)}function Zt(e,s){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof s=="number"?Math.sqrt(n**2+r**2)>s:"x"in s&&"y"in s?n>s.x&&r>s.y:"x"in s?n>s.x:"y"in s?r>s.y:!1}var le;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(le||(le={}));function Ss(e){e.preventDefault()}function La(e){e.stopPropagation()}var M;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(M||(M={}));const mn={start:[M.Space,M.Enter],cancel:[M.Esc],end:[M.Space,M.Enter,M.Tab]},Oa=(e,s)=>{let{currentCoordinates:n}=s;switch(e.code){case M.Right:return{...n,x:n.x+25};case M.Left:return{...n,x:n.x-25};case M.Down:return{...n,y:n.y+25};case M.Up:return{...n,y:n.y-25}}};class ms{constructor(s){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=s;const{event:{target:n}}=s;this.props=s,this.listeners=new ot(Ze(n)),this.windowListeners=new ot(G(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(le.Resize,this.handleCancel),this.windowListeners.add(le.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(le.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:s,onStart:n}=this.props,r=s.node.current;r&&un(r),n(fe)}handleKeyDown(s){if(zt(s)){const{active:n,context:r,options:a}=this.props,{keyboardCodes:o=mn,coordinateGetter:i=Oa,scrollBehavior:l="smooth"}=a,{code:u}=s;if(o.end.includes(u)){this.handleEnd(s);return}if(o.cancel.includes(u)){this.handleCancel(s);return}const{collisionRect:m}=r.current,f=m?{x:m.left,y:m.top}:fe;this.referenceCoordinates||(this.referenceCoordinates=f);const d=i(s,{active:n,context:r.current,currentCoordinates:f});if(d){const p=dt(d,f),x={x:0,y:0},{scrollableAncestors:j}=r.current;for(const v of j){const w=s.code,{isTop:g,isRight:D,isLeft:k,isBottom:E,maxScroll:C,minScroll:h}=cn(v),y=Aa(v),b={x:Math.min(w===M.Right?y.right-y.width/2:y.right,Math.max(w===M.Right?y.left:y.left+y.width/2,d.x)),y:Math.min(w===M.Down?y.bottom-y.height/2:y.bottom,Math.max(w===M.Down?y.top:y.top+y.height/2,d.y))},S=w===M.Right&&!D||w===M.Left&&!k,T=w===M.Down&&!E||w===M.Up&&!g;if(S&&b.x!==d.x){const F=v.scrollLeft+p.x,V=w===M.Right&&F<=C.x||w===M.Left&&F>=h.x;if(V&&!p.y){v.scrollTo({left:F,behavior:l});return}V?x.x=v.scrollLeft-F:x.x=w===M.Right?v.scrollLeft-C.x:v.scrollLeft-h.x,x.x&&v.scrollBy({left:-x.x,behavior:l});break}else if(T&&b.y!==d.y){const F=v.scrollTop+p.y,V=w===M.Down&&F<=C.y||w===M.Up&&F>=h.y;if(V&&!p.x){v.scrollTo({top:F,behavior:l});return}V?x.y=v.scrollTop-F:x.y=w===M.Down?v.scrollTop-C.y:v.scrollTop-h.y,x.y&&v.scrollBy({top:-x.y,behavior:l});break}}this.handleMove(s,Ke(dt(d,this.referenceCoordinates),x))}}}handleMove(s,n){const{onMove:r}=this.props;s.preventDefault(),r(n)}handleEnd(s){const{onEnd:n}=this.props;s.preventDefault(),this.detach(),n()}handleCancel(s){const{onCancel:n}=this.props;s.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}ms.activators=[{eventName:"onKeyDown",handler:(e,s,n)=>{let{keyboardCodes:r=mn,onActivation:a}=s,{active:o}=n;const{code:i}=e.nativeEvent;if(r.start.includes(i)){const l=o.activatorNode.current;return l&&e.target!==l?!1:(e.preventDefault(),a?.({event:e.nativeEvent}),!0)}return!1}}];function Ds(e){return!!(e&&"distance"in e)}function ks(e){return!!(e&&"delay"in e)}class hs{constructor(s,n,r){var a;r===void 0&&(r=Fa(s.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=s,this.events=n;const{event:o}=s,{target:i}=o;this.props=s,this.events=n,this.document=Ze(i),this.documentListeners=new ot(this.document),this.listeners=new ot(r),this.windowListeners=new ot(G(i)),this.initialCoordinates=(a=Ft(o))!=null?a:fe,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:s,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(s.move.name,this.handleMove,{passive:!1}),this.listeners.add(s.end.name,this.handleEnd),s.cancel&&this.listeners.add(s.cancel.name,this.handleCancel),this.windowListeners.add(le.Resize,this.handleCancel),this.windowListeners.add(le.DragStart,Ss),this.windowListeners.add(le.VisibilityChange,this.handleCancel),this.windowListeners.add(le.ContextMenu,Ss),this.documentListeners.add(le.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(ks(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Ds(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(s,n){const{active:r,onPending:a}=this.props;a(r,s,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:s}=this,{onStart:n}=this.props;s&&(this.activated=!0,this.documentListeners.add(le.Click,La,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(le.SelectionChange,this.removeTextSelection),n(s))}handleMove(s){var n;const{activated:r,initialCoordinates:a,props:o}=this,{onMove:i,options:{activationConstraint:l}}=o;if(!a)return;const u=(n=Ft(s))!=null?n:fe,m=dt(a,u);if(!r&&l){if(Ds(l)){if(l.tolerance!=null&&Zt(m,l.tolerance))return this.handleCancel();if(Zt(m,l.distance))return this.handleStart()}if(ks(l)&&Zt(m,l.tolerance))return this.handleCancel();this.handlePending(l,m);return}s.cancelable&&s.preventDefault(),i(u)}handleEnd(){const{onAbort:s,onEnd:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleCancel(){const{onAbort:s,onCancel:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleKeydown(s){s.code===M.Esc&&this.handleCancel()}removeTextSelection(){var s;(s=this.document.getSelection())==null||s.removeAllRanges()}}const Ia={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class fs extends hs{constructor(s){const{event:n}=s,r=Ze(n.target);super(s,Ia,r)}}fs.activators=[{eventName:"onPointerDown",handler:(e,s)=>{let{nativeEvent:n}=e,{onActivation:r}=s;return!n.isPrimary||n.button!==0?!1:(r?.({event:n}),!0)}}];const Pa={move:{name:"mousemove"},end:{name:"mouseup"}};var rs;(function(e){e[e.RightClick=2]="RightClick"})(rs||(rs={}));class _a extends hs{constructor(s){super(s,Pa,Ze(s.event.target))}}_a.activators=[{eventName:"onMouseDown",handler:(e,s)=>{let{nativeEvent:n}=e,{onActivation:r}=s;return n.button===rs.RightClick?!1:(r?.({event:n}),!0)}}];const Qt={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class hn extends hs{constructor(s){super(s,Qt)}static setup(){return window.addEventListener(Qt.move.name,s,{capture:!1,passive:!1}),function(){window.removeEventListener(Qt.move.name,s)};function s(){}}}hn.activators=[{eventName:"onTouchStart",handler:(e,s)=>{let{nativeEvent:n}=e,{onActivation:r}=s;const{touches:a}=n;return a.length>1?!1:(r?.({event:n}),!0)}}];var it;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(it||(it={}));var Ot;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(Ot||(Ot={}));function Ba(e){let{acceleration:s,activator:n=it.Pointer,canScroll:r,draggingRect:a,enabled:o,interval:i=5,order:l=Ot.TreeOrder,pointerCoordinates:u,scrollableAncestors:m,scrollableAncestorRects:f,delta:d,threshold:p}=e;const x=za({delta:d,disabled:!o}),[j,v]=Qr(),w=c.useRef({x:0,y:0}),g=c.useRef({x:0,y:0}),D=c.useMemo(()=>{switch(n){case it.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case it.DraggableRect:return a}},[n,a,u]),k=c.useRef(null),E=c.useCallback(()=>{const h=k.current;if(!h)return;const y=w.current.x*g.current.x,b=w.current.y*g.current.y;h.scrollBy(y,b)},[]),C=c.useMemo(()=>l===Ot.TreeOrder?[...m].reverse():m,[l,m]);c.useEffect(()=>{if(!o||!m.length||!D){v();return}for(const h of C){if(r?.(h)===!1)continue;const y=m.indexOf(h),b=f[y];if(!b)continue;const{direction:S,speed:T}=Ea(h,b,D,s,p);for(const F of["x","y"])x[F][S[F]]||(T[F]=0,S[F]=0);if(T.x>0||T.y>0){v(),k.current=h,j(E,i),w.current=T,g.current=S;return}}w.current={x:0,y:0},g.current={x:0,y:0},v()},[s,E,r,v,o,i,JSON.stringify(D),JSON.stringify(x),j,m,C,f,JSON.stringify(p)])}const $a={x:{[q.Backward]:!1,[q.Forward]:!1},y:{[q.Backward]:!1,[q.Forward]:!1}};function za(e){let{delta:s,disabled:n}=e;const r=Mt(s);return mt(a=>{if(n||!r||!a)return $a;const o={x:Math.sign(s.x-r.x),y:Math.sign(s.y-r.y)};return{x:{[q.Backward]:a.x[q.Backward]||o.x===-1,[q.Forward]:a.x[q.Forward]||o.x===1},y:{[q.Backward]:a.y[q.Backward]||o.y===-1,[q.Forward]:a.y[q.Forward]||o.y===1}}},[n,s,r])}function qa(e,s){const n=s!=null?e.get(s):void 0,r=n?n.node.current:null;return mt(a=>{var o;return s==null?null:(o=r??a)!=null?o:null},[r,s])}function Va(e,s){return c.useMemo(()=>e.reduce((n,r)=>{const{sensor:a}=r,o=a.activators.map(i=>({eventName:i.eventName,handler:s(i.handler,r)}));return[...n,...o]},[]),[e,s])}var Ge;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Ge||(Ge={}));var as;(function(e){e.Optimized="optimized"})(as||(as={}));const Es=new Map;function Ha(e,s){let{dragging:n,dependencies:r,config:a}=s;const[o,i]=c.useState(null),{frequency:l,measure:u,strategy:m}=a,f=c.useRef(e),d=w(),p=ct(d),x=c.useCallback(function(g){g===void 0&&(g=[]),!p.current&&i(D=>D===null?g:D.concat(g.filter(k=>!D.includes(k))))},[p]),j=c.useRef(null),v=mt(g=>{if(d&&!n)return Es;if(!g||g===Es||f.current!==e||o!=null){const D=new Map;for(let k of e){if(!k)continue;if(o&&o.length>0&&!o.includes(k.id)&&k.rect.current){D.set(k.id,k.rect.current);continue}const E=k.node.current,C=E?new us(u(E),E):null;k.rect.current=C,C&&D.set(k.id,C)}return D}return g},[e,o,n,d,u]);return c.useEffect(()=>{f.current=e},[e]),c.useEffect(()=>{d||x()},[n,d]),c.useEffect(()=>{o&&o.length>0&&i(null)},[JSON.stringify(o)]),c.useEffect(()=>{d||typeof l!="number"||j.current!==null||(j.current=setTimeout(()=>{x(),j.current=null},l))},[l,d,x,...r]),{droppableRects:v,measureDroppableContainers:x,measuringScheduled:o!=null};function w(){switch(m){case Ge.Always:return!1;case Ge.BeforeDragging:return n;default:return!n}}}function ps(e,s){return mt(n=>e?n||(typeof s=="function"?s(e):e):null,[s,e])}function Ua(e,s){return ps(e,s)}function Xa(e){let{callback:s,disabled:n}=e;const r=$t(s),a=c.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(r)},[r,n]);return c.useEffect(()=>()=>a?.disconnect(),[a]),a}function Vt(e){let{callback:s,disabled:n}=e;const r=$t(s),a=c.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(r)},[n]);return c.useEffect(()=>()=>a?.disconnect(),[a]),a}function Ya(e){return new us(Qe(e),e)}function As(e,s,n){s===void 0&&(s=Ya);const[r,a]=c.useState(null);function o(){a(u=>{if(!e)return null;if(e.isConnected===!1){var m;return(m=u??n)!=null?m:null}const f=s(e);return JSON.stringify(u)===JSON.stringify(f)?u:f})}const i=Xa({callback(u){if(e)for(const m of u){const{type:f,target:d}=m;if(f==="childList"&&d instanceof HTMLElement&&d.contains(e)){o();break}}}}),l=Vt({callback:o});return he(()=>{o(),e?(l?.observe(e),i?.observe(document.body,{childList:!0,subtree:!0})):(l?.disconnect(),i?.disconnect())},[e]),r}function Wa(e){const s=ps(e);return sn(e,s)}const Ts=[];function Ka(e){const s=c.useRef(e),n=mt(r=>e?r&&r!==Ts&&e&&s.current&&e.parentNode===s.current.parentNode?r:qt(e):Ts,[e]);return c.useEffect(()=>{s.current=e},[e]),n}function Ga(e){const[s,n]=c.useState(null),r=c.useRef(e),a=c.useCallback(o=>{const i=Jt(o.target);i&&n(l=>l?(l.set(i,ns(i)),new Map(l)):null)},[]);return c.useEffect(()=>{const o=r.current;if(e!==o){i(o);const l=e.map(u=>{const m=Jt(u);return m?(m.addEventListener("scroll",a,{passive:!0}),[m,ns(m)]):null}).filter(u=>u!=null);n(l.length?new Map(l):null),r.current=e}return()=>{i(e),i(o)};function i(l){l.forEach(u=>{const m=Jt(u);m?.removeEventListener("scroll",a)})}},[a,e]),c.useMemo(()=>e.length?s?Array.from(s.values()).reduce((o,i)=>Ke(o,i),fe):dn(e):fe,[e,s])}function Rs(e,s){s===void 0&&(s=[]);const n=c.useRef(null);return c.useEffect(()=>{n.current=null},s),c.useEffect(()=>{const r=e!==fe;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?dt(e,n.current):fe}function Ja(e){c.useEffect(()=>{if(!Bt)return;const s=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of s)n?.()}},e.map(s=>{let{sensor:n}=s;return n}))}function Za(e,s){return c.useMemo(()=>e.reduce((n,r)=>{let{eventName:a,handler:o}=r;return n[a]=i=>{o(i,s)},n},{}),[e,s])}function fn(e){return c.useMemo(()=>e?Ca(e):null,[e])}const Ms=[];function Qa(e,s){s===void 0&&(s=Qe);const[n]=e,r=fn(n?G(n):null),[a,o]=c.useState(Ms);function i(){o(()=>e.length?e.map(u=>ln(u)?r:new us(s(u),u)):Ms)}const l=Vt({callback:i});return he(()=>{l?.disconnect(),i(),e.forEach(u=>l?.observe(u))},[e]),a}function pn(e){if(!e)return null;if(e.children.length>1)return e;const s=e.children[0];return ut(s)?s:e}function eo(e){let{measure:s}=e;const[n,r]=c.useState(null),a=c.useCallback(m=>{for(const{target:f}of m)if(ut(f)){r(d=>{const p=s(f);return d?{...d,width:p.width,height:p.height}:p});break}},[s]),o=Vt({callback:a}),i=c.useCallback(m=>{const f=pn(m);o?.disconnect(),f&&o?.observe(f),r(f?s(f):null)},[s,o]),[l,u]=Rt(i);return c.useMemo(()=>({nodeRef:l,rect:n,setRef:u}),[n,l,u])}const to=[{sensor:fs,options:{}},{sensor:ms,options:{}}],so={current:{}},kt={draggable:{measure:Cs},droppable:{measure:Cs,strategy:Ge.WhileDragging,frequency:as.Optimized},dragOverlay:{measure:Qe}};class lt extends Map{get(s){var n;return s!=null&&(n=super.get(s))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(s=>{let{disabled:n}=s;return!n})}getNodeFor(s){var n,r;return(n=(r=this.get(s))==null?void 0:r.node.current)!=null?n:void 0}}const no={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new lt,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Lt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:kt,measureDroppableContainers:Lt,windowRect:null,measuringScheduled:!1},gn={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Lt,draggableNodes:new Map,over:null,measureDroppableContainers:Lt},ft=c.createContext(gn),xn=c.createContext(no);function ro(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new lt}}}function ao(e,s){switch(s.type){case $.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:s.initialCoordinates,active:s.active}};case $.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:s.coordinates.x-e.draggable.initialCoordinates.x,y:s.coordinates.y-e.draggable.initialCoordinates.y}}};case $.DragEnd:case $.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case $.RegisterDroppable:{const{element:n}=s,{id:r}=n,a=new lt(e.droppable.containers);return a.set(r,n),{...e,droppable:{...e.droppable,containers:a}}}case $.SetDroppableDisabled:{const{id:n,key:r,disabled:a}=s,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const i=new lt(e.droppable.containers);return i.set(n,{...o,disabled:a}),{...e,droppable:{...e.droppable,containers:i}}}case $.UnregisterDroppable:{const{id:n,key:r}=s,a=e.droppable.containers.get(n);if(!a||r!==a.key)return e;const o=new lt(e.droppable.containers);return o.delete(n),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function oo(e){let{disabled:s}=e;const{active:n,activatorEvent:r,draggableNodes:a}=c.useContext(ft),o=Mt(r),i=Mt(n?.id);return c.useEffect(()=>{if(!s&&!r&&o&&i!=null){if(!zt(o)||document.activeElement===o.target)return;const l=a.get(i);if(!l)return;const{activatorNode:u,node:m}=l;if(!u.current&&!m.current)return;requestAnimationFrame(()=>{for(const f of[u.current,m.current]){if(!f)continue;const d=sa(f);if(d){d.focus();break}}})}},[r,s,a,i,o]),null}function vn(e,s){let{transform:n,...r}=s;return e!=null&&e.length?e.reduce((a,o)=>o({transform:a,...r}),n):n}function io(e){return c.useMemo(()=>({draggable:{...kt.draggable,...e?.draggable},droppable:{...kt.droppable,...e?.droppable},dragOverlay:{...kt.dragOverlay,...e?.dragOverlay}}),[e?.draggable,e?.droppable,e?.dragOverlay])}function lo(e){let{activeNode:s,measure:n,initialRect:r,config:a=!0}=e;const o=c.useRef(!1),{x:i,y:l}=typeof a=="boolean"?{x:a,y:a}:a;he(()=>{if(!i&&!l||!s){o.current=!1;return}if(o.current||!r)return;const m=s?.node.current;if(!m||m.isConnected===!1)return;const f=n(m),d=sn(f,r);if(i||(d.x=0),l||(d.y=0),o.current=!0,Math.abs(d.x)>0||Math.abs(d.y)>0){const p=rn(m);p&&p.scrollBy({top:d.y,left:d.x})}},[s,i,l,r,n])}const Ht=c.createContext({...fe,scaleX:1,scaleY:1});var Fe;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Fe||(Fe={}));const co=c.memo(function(s){var n,r,a,o;let{id:i,accessibility:l,autoScroll:u=!0,children:m,sensors:f=to,collisionDetection:d=va,measuring:p,modifiers:x,...j}=s;const v=c.useReducer(ao,void 0,ro),[w,g]=v,[D,k]=la(),[E,C]=c.useState(Fe.Uninitialized),h=E===Fe.Initialized,{draggable:{active:y,nodes:b,translate:S},droppable:{containers:T}}=w,F=y!=null?b.get(y):null,V=c.useRef({initial:null,translated:null}),se=c.useMemo(()=>{var Y;return y!=null?{id:y,data:(Y=F?.data)!=null?Y:so,rect:V}:null},[y,F]),ne=c.useRef(null),[He,Oe]=c.useState(null),[U,et]=c.useState(null),re=ct(j,Object.values(j)),Ue=ht("DndDescribedBy",i),Se=c.useMemo(()=>T.getEnabled(),[T]),K=io(p),{droppableRects:pe,measureDroppableContainers:De,measuringScheduled:ke}=Ha(Se,{dragging:h,dependencies:[S.x,S.y],config:K.droppable}),Z=qa(b,y),Ie=c.useMemo(()=>U?Ft(U):null,[U]),ye=An(),ce=Ua(Z,K.draggable.measure);lo({activeNode:y!=null?b.get(y):null,config:ye.layoutShiftCompensation,initialRect:ce,measure:K.draggable.measure});const O=As(Z,K.draggable.measure,ce),Ee=As(Z?Z.parentElement:null),J=c.useRef({activatorEvent:null,active:null,activeNode:Z,collisionRect:null,collisions:null,droppableRects:pe,draggableNodes:b,draggingNode:null,draggingNodeRect:null,droppableContainers:T,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),de=T.getNodeFor((n=J.current.over)==null?void 0:n.id),ue=eo({measure:K.dragOverlay.measure}),ge=(r=ue.nodeRef.current)!=null?r:Z,me=h?(a=ue.rect)!=null?a:O:null,pt=!!(ue.nodeRef.current&&ue.rect),I=Wa(pt?null:O),Pe=fn(ge?G(ge):null),ae=Ka(h?de??Z:null),Xe=Qa(ae),Ye=vn(x,{transform:{x:S.x-I.x,y:S.y-I.y,scaleX:1,scaleY:1},activatorEvent:U,active:se,activeNodeRect:O,containerNodeRect:Ee,draggingNodeRect:me,over:J.current.over,overlayNodeRect:ue.rect,scrollableAncestors:ae,scrollableAncestorRects:Xe,windowRect:Pe}),gt=Ie?Ke(Ie,S):null,xt=Ga(ae),Ut=Rs(xt),vt=Rs(xt,[O]),Ae=Ke(Ye,Ut),we=me?wa(me,Ye):null,N=se&&we?d({active:se,collisionRect:we,droppableRects:pe,droppableContainers:Se,pointerCoordinates:gt}):null,R=tn(N,"id"),[A,L]=c.useState(null),X=pt?Ye:Ke(Ye,vt),oe=ba(X,(o=A?.rect)!=null?o:null,O),_e=c.useRef(null),bt=c.useCallback((Y,Q)=>{let{sensor:ee,options:Te}=Q;if(ne.current==null)return;const ie=b.get(ne.current);if(!ie)return;const te=Y.nativeEvent,xe=new ee({active:ne.current,activeNode:ie,event:te,options:Te,context:J,onAbort(H){if(!b.get(H))return;const{onDragAbort:ve}=re.current,je={id:H};ve?.(je),D({type:"onDragAbort",event:je})},onPending(H,Re,ve,je){if(!b.get(H))return;const{onDragPending:st}=re.current,Me={id:H,constraint:Re,initialCoordinates:ve,offset:je};st?.(Me),D({type:"onDragPending",event:Me})},onStart(H){const Re=ne.current;if(Re==null)return;const ve=b.get(Re);if(!ve)return;const{onDragStart:je}=re.current,tt={activatorEvent:te,active:{id:Re,data:ve.data,rect:V}};rt.unstable_batchedUpdates(()=>{je?.(tt),C(Fe.Initializing),g({type:$.DragStart,initialCoordinates:H,active:Re}),D({type:"onDragStart",event:tt}),Oe(_e.current),et(te)})},onMove(H){g({type:$.DragMove,coordinates:H})},onEnd:We($.DragEnd),onCancel:We($.DragCancel)});_e.current=xe;function We(H){return async function(){const{active:ve,collisions:je,over:tt,scrollAdjustedTranslate:st}=J.current;let Me=null;if(ve&&st){const{cancelDrop:nt}=re.current;Me={activatorEvent:te,active:ve,collisions:je,delta:st,over:tt},H===$.DragEnd&&typeof nt=="function"&&await Promise.resolve(nt(Me))&&(H=$.DragCancel)}ne.current=null,rt.unstable_batchedUpdates(()=>{g({type:H}),C(Fe.Uninitialized),L(null),Oe(null),et(null),_e.current=null;const nt=H===$.DragEnd?"onDragEnd":"onDragCancel";if(Me){const Xt=re.current[nt];Xt?.(Me),D({type:nt,event:Me})}})}}},[b]),Dn=c.useCallback((Y,Q)=>(ee,Te)=>{const ie=ee.nativeEvent,te=b.get(Te);if(ne.current!==null||!te||ie.dndKit||ie.defaultPrevented)return;const xe={active:te};Y(ee,Q.options,xe)===!0&&(ie.dndKit={capturedBy:Q.sensor},ne.current=Te,bt(ee,Q))},[b,bt]),vs=Va(f,Dn);Ja(f),he(()=>{O&&E===Fe.Initializing&&C(Fe.Initialized)},[O,E]),c.useEffect(()=>{const{onDragMove:Y}=re.current,{active:Q,activatorEvent:ee,collisions:Te,over:ie}=J.current;if(!Q||!ee)return;const te={active:Q,activatorEvent:ee,collisions:Te,delta:{x:Ae.x,y:Ae.y},over:ie};rt.unstable_batchedUpdates(()=>{Y?.(te),D({type:"onDragMove",event:te})})},[Ae.x,Ae.y]),c.useEffect(()=>{const{active:Y,activatorEvent:Q,collisions:ee,droppableContainers:Te,scrollAdjustedTranslate:ie}=J.current;if(!Y||ne.current==null||!Q||!ie)return;const{onDragOver:te}=re.current,xe=Te.get(R),We=xe&&xe.rect.current?{id:xe.id,rect:xe.rect.current,data:xe.data,disabled:xe.disabled}:null,H={active:Y,activatorEvent:Q,collisions:ee,delta:{x:ie.x,y:ie.y},over:We};rt.unstable_batchedUpdates(()=>{L(We),te?.(H),D({type:"onDragOver",event:H})})},[R]),he(()=>{J.current={activatorEvent:U,active:se,activeNode:Z,collisionRect:we,collisions:N,droppableRects:pe,draggableNodes:b,draggingNode:ge,draggingNodeRect:me,droppableContainers:T,over:A,scrollableAncestors:ae,scrollAdjustedTranslate:Ae},V.current={initial:me,translated:we}},[se,Z,N,we,b,ge,me,pe,T,A,ae,Ae]),Ba({...ye,delta:S,draggingRect:we,pointerCoordinates:gt,scrollableAncestors:ae,scrollableAncestorRects:Xe});const kn=c.useMemo(()=>({active:se,activeNode:Z,activeNodeRect:O,activatorEvent:U,collisions:N,containerNodeRect:Ee,dragOverlay:ue,draggableNodes:b,droppableContainers:T,droppableRects:pe,over:A,measureDroppableContainers:De,scrollableAncestors:ae,scrollableAncestorRects:Xe,measuringConfiguration:K,measuringScheduled:ke,windowRect:Pe}),[se,Z,O,U,N,Ee,ue,b,T,pe,A,De,ae,Xe,K,ke,Pe]),En=c.useMemo(()=>({activatorEvent:U,activators:vs,active:se,activeNodeRect:O,ariaDescribedById:{draggable:Ue},dispatch:g,draggableNodes:b,over:A,measureDroppableContainers:De}),[U,vs,se,O,g,Ue,b,A,De]);return P.createElement(Zs.Provider,{value:k},P.createElement(ft.Provider,{value:En},P.createElement(xn.Provider,{value:kn},P.createElement(Ht.Provider,{value:oe},m)),P.createElement(oo,{disabled:l?.restoreFocus===!1})),P.createElement(ua,{...l,hiddenTextDescribedById:Ue}));function An(){const Y=He?.autoScrollEnabled===!1,Q=typeof u=="object"?u.enabled===!1:u===!1,ee=h&&!Y&&!Q;return typeof u=="object"?{...u,enabled:ee}:{enabled:ee}}}),uo=c.createContext(null),Fs="button",mo="Draggable";function ho(e){let{id:s,data:n,disabled:r=!1,attributes:a}=e;const o=ht(mo),{activators:i,activatorEvent:l,active:u,activeNodeRect:m,ariaDescribedById:f,draggableNodes:d,over:p}=c.useContext(ft),{role:x=Fs,roleDescription:j="draggable",tabIndex:v=0}=a??{},w=u?.id===s,g=c.useContext(w?Ht:uo),[D,k]=Rt(),[E,C]=Rt(),h=Za(i,s),y=ct(n);he(()=>(d.set(s,{id:s,key:o,node:D,activatorNode:E,data:y}),()=>{const S=d.get(s);S&&S.key===o&&d.delete(s)}),[d,s]);const b=c.useMemo(()=>({role:x,tabIndex:v,"aria-disabled":r,"aria-pressed":w&&x===Fs?!0:void 0,"aria-roledescription":j,"aria-describedby":f.draggable}),[r,x,v,w,j,f.draggable]);return{active:u,activatorEvent:l,activeNodeRect:m,attributes:b,isDragging:w,listeners:r?void 0:h,node:D,over:p,setNodeRef:k,setActivatorNodeRef:C,transform:g}}function bn(){return c.useContext(xn)}const fo="Droppable",po={timeout:25};function go(e){let{data:s,disabled:n=!1,id:r,resizeObserverConfig:a}=e;const o=ht(fo),{active:i,dispatch:l,over:u,measureDroppableContainers:m}=c.useContext(ft),f=c.useRef({disabled:n}),d=c.useRef(!1),p=c.useRef(null),x=c.useRef(null),{disabled:j,updateMeasurementsFor:v,timeout:w}={...po,...a},g=ct(v??r),D=c.useCallback(()=>{if(!d.current){d.current=!0;return}x.current!=null&&clearTimeout(x.current),x.current=setTimeout(()=>{m(Array.isArray(g.current)?g.current:[g.current]),x.current=null},w)},[w]),k=Vt({callback:D,disabled:j||!i}),E=c.useCallback((b,S)=>{k&&(S&&(k.unobserve(S),d.current=!1),b&&k.observe(b))},[k]),[C,h]=Rt(E),y=ct(s);return c.useEffect(()=>{!k||!C.current||(k.disconnect(),d.current=!1,k.observe(C.current))},[C,k]),c.useEffect(()=>(l({type:$.RegisterDroppable,element:{id:r,key:o,disabled:n,node:C,rect:p,data:y}}),()=>l({type:$.UnregisterDroppable,key:o,id:r})),[r]),c.useEffect(()=>{n!==f.current.disabled&&(l({type:$.SetDroppableDisabled,id:r,key:o,disabled:n}),f.current.disabled=n)},[r,o,n,l]),{active:i,rect:p,isOver:u?.id===r,node:C,over:u,setNodeRef:h}}function xo(e){let{animation:s,children:n}=e;const[r,a]=c.useState(null),[o,i]=c.useState(null),l=Mt(n);return!n&&!r&&l&&a(l),he(()=>{if(!o)return;const u=r?.key,m=r?.props.id;if(u==null||m==null){a(null);return}Promise.resolve(s(m,o)).then(()=>{a(null)})},[s,r,o]),P.createElement(P.Fragment,null,n,r?c.cloneElement(r,{ref:i}):null)}const vo={x:0,y:0,scaleX:1,scaleY:1};function bo(e){let{children:s}=e;return P.createElement(ft.Provider,{value:gn},P.createElement(Ht.Provider,{value:vo},s))}const yo={position:"fixed",touchAction:"none"},wo=e=>zt(e)?"transform 250ms ease":void 0,jo=c.forwardRef((e,s)=>{let{as:n,activatorEvent:r,adjustScale:a,children:o,className:i,rect:l,style:u,transform:m,transition:f=wo}=e;if(!l)return null;const d=a?m:{...m,scaleX:1,scaleY:1},p={...yo,width:l.width,height:l.height,top:l.top,left:l.left,transform:Le.Transform.toString(d),transformOrigin:a&&r?ha(r,l):void 0,transition:typeof f=="function"?f(r):f,...u};return P.createElement(n,{className:i,style:p,ref:s},o)}),No=e=>s=>{let{active:n,dragOverlay:r}=s;const a={},{styles:o,className:i}=e;if(o!=null&&o.active)for(const[l,u]of Object.entries(o.active))u!==void 0&&(a[l]=n.node.style.getPropertyValue(l),n.node.style.setProperty(l,u));if(o!=null&&o.dragOverlay)for(const[l,u]of Object.entries(o.dragOverlay))u!==void 0&&r.node.style.setProperty(l,u);return i!=null&&i.active&&n.node.classList.add(i.active),i!=null&&i.dragOverlay&&r.node.classList.add(i.dragOverlay),function(){for(const[u,m]of Object.entries(a))n.node.style.setProperty(u,m);i!=null&&i.active&&n.node.classList.remove(i.active)}},Co=e=>{let{transform:{initial:s,final:n}}=e;return[{transform:Le.Transform.toString(s)},{transform:Le.Transform.toString(n)}]},So={duration:250,easing:"ease",keyframes:Co,sideEffects:No({styles:{active:{opacity:"0"}}})};function Do(e){let{config:s,draggableNodes:n,droppableContainers:r,measuringConfiguration:a}=e;return $t((o,i)=>{if(s===null)return;const l=n.get(o);if(!l)return;const u=l.node.current;if(!u)return;const m=pn(i);if(!m)return;const{transform:f}=G(i).getComputedStyle(i),d=nn(f);if(!d)return;const p=typeof s=="function"?s:ko(s);return un(u,a.draggable.measure),p({active:{id:o,data:l.data,node:u,rect:a.draggable.measure(u)},draggableNodes:n,dragOverlay:{node:i,rect:a.dragOverlay.measure(m)},droppableContainers:r,measuringConfiguration:a,transform:d})})}function ko(e){const{duration:s,easing:n,sideEffects:r,keyframes:a}={...So,...e};return o=>{let{active:i,dragOverlay:l,transform:u,...m}=o;if(!s)return;const f={x:l.rect.left-i.rect.left,y:l.rect.top-i.rect.top},d={scaleX:u.scaleX!==1?i.rect.width*u.scaleX/l.rect.width:1,scaleY:u.scaleY!==1?i.rect.height*u.scaleY/l.rect.height:1},p={x:u.x-f.x,y:u.y-f.y,...d},x=a({...m,active:i,dragOverlay:l,transform:{initial:u,final:p}}),[j]=x,v=x[x.length-1];if(JSON.stringify(j)===JSON.stringify(v))return;const w=r?.({active:i,dragOverlay:l,...m}),g=l.node.animate(x,{duration:s,easing:n,fill:"forwards"});return new Promise(D=>{g.onfinish=()=>{w?.(),D()}})}}let Ls=0;function Eo(e){return c.useMemo(()=>{if(e!=null)return Ls++,Ls},[e])}const Ao=P.memo(e=>{let{adjustScale:s=!1,children:n,dropAnimation:r,style:a,transition:o,modifiers:i,wrapperElement:l="div",className:u,zIndex:m=999}=e;const{activatorEvent:f,active:d,activeNodeRect:p,containerNodeRect:x,draggableNodes:j,droppableContainers:v,dragOverlay:w,over:g,measuringConfiguration:D,scrollableAncestors:k,scrollableAncestorRects:E,windowRect:C}=bn(),h=c.useContext(Ht),y=Eo(d?.id),b=vn(i,{activatorEvent:f,active:d,activeNodeRect:p,containerNodeRect:x,draggingNodeRect:w.rect,over:g,overlayNodeRect:w.rect,scrollableAncestors:k,scrollableAncestorRects:E,transform:h,windowRect:C}),S=ps(p),T=Do({config:r,draggableNodes:j,droppableContainers:v,measuringConfiguration:D}),F=S?w.setRef:void 0;return P.createElement(bo,null,P.createElement(xo,{animation:T},d&&y?P.createElement(jo,{key:y,id:d.id,ref:F,as:l,activatorEvent:f,adjustScale:s,className:u,transition:o,rect:S,style:{zIndex:m,...a},transform:b},n):null))});function gs(e,s,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(s,1)[0]),r}function To(e,s){return e.reduce((n,r,a)=>{const o=s.get(r);return o&&(n[a]=o),n},Array(e.length))}function St(e){return e!==null&&e>=0}function Ro(e,s){if(e===s)return!0;if(e.length!==s.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==s[n])return!1;return!0}function Mo(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const yn=e=>{let{rects:s,activeIndex:n,overIndex:r,index:a}=e;const o=gs(s,r,n),i=s[a],l=o[a];return!l||!i?null:{x:l.left-i.left,y:l.top-i.top,scaleX:l.width/i.width,scaleY:l.height/i.height}},Dt={scaleX:1,scaleY:1},Fo=e=>{var s;let{activeIndex:n,activeNodeRect:r,index:a,rects:o,overIndex:i}=e;const l=(s=o[n])!=null?s:r;if(!l)return null;if(a===n){const m=o[i];return m?{x:0,y:n<i?m.top+m.height-(l.top+l.height):m.top-l.top,...Dt}:null}const u=Lo(o,a,n);return a>n&&a<=i?{x:0,y:-l.height-u,...Dt}:a<n&&a>=i?{x:0,y:l.height+u,...Dt}:{x:0,y:0,...Dt}};function Lo(e,s,n){const r=e[s],a=e[s-1],o=e[s+1];return r?n<s?a?r.top-(a.top+a.height):o?o.top-(r.top+r.height):0:o?o.top-(r.top+r.height):a?r.top-(a.top+a.height):0:0}const wn="Sortable",jn=P.createContext({activeIndex:-1,containerId:wn,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:yn,disabled:{draggable:!1,droppable:!1}});function Oo(e){let{children:s,id:n,items:r,strategy:a=yn,disabled:o=!1}=e;const{active:i,dragOverlay:l,droppableRects:u,over:m,measureDroppableContainers:f}=bn(),d=ht(wn,n),p=l.rect!==null,x=c.useMemo(()=>r.map(h=>typeof h=="object"&&"id"in h?h.id:h),[r]),j=i!=null,v=i?x.indexOf(i.id):-1,w=m?x.indexOf(m.id):-1,g=c.useRef(x),D=!Ro(x,g.current),k=w!==-1&&v===-1||D,E=Mo(o);he(()=>{D&&j&&f(x)},[D,x,j,f]),c.useEffect(()=>{g.current=x},[x]);const C=c.useMemo(()=>({activeIndex:v,containerId:d,disabled:E,disableTransforms:k,items:x,overIndex:w,useDragOverlay:p,sortedRects:To(x,u),strategy:a}),[v,d,E.draggable,E.droppable,k,x,w,u,p,a]);return P.createElement(jn.Provider,{value:C},s)}const Io=e=>{let{id:s,items:n,activeIndex:r,overIndex:a}=e;return gs(n,r,a).indexOf(s)},Po=e=>{let{containerId:s,isSorting:n,wasDragging:r,index:a,items:o,newIndex:i,previousItems:l,previousContainerId:u,transition:m}=e;return!m||!r||l!==o&&a===i?!1:n?!0:i!==a&&s===u},_o={duration:200,easing:"ease"},Nn="transform",Bo=Le.Transition.toString({property:Nn,duration:0,easing:"linear"}),$o={roleDescription:"sortable"};function zo(e){let{disabled:s,index:n,node:r,rect:a}=e;const[o,i]=c.useState(null),l=c.useRef(n);return he(()=>{if(!s&&n!==l.current&&r.current){const u=a.current;if(u){const m=Qe(r.current,{ignoreTransform:!0}),f={x:u.left-m.left,y:u.top-m.top,scaleX:u.width/m.width,scaleY:u.height/m.height};(f.x||f.y)&&i(f)}}n!==l.current&&(l.current=n)},[s,n,r,a]),c.useEffect(()=>{o&&i(null)},[o]),o}function qo(e){let{animateLayoutChanges:s=Po,attributes:n,disabled:r,data:a,getNewIndex:o=Io,id:i,strategy:l,resizeObserverConfig:u,transition:m=_o}=e;const{items:f,containerId:d,activeIndex:p,disabled:x,disableTransforms:j,sortedRects:v,overIndex:w,useDragOverlay:g,strategy:D}=c.useContext(jn),k=Vo(r,x),E=f.indexOf(i),C=c.useMemo(()=>({sortable:{containerId:d,index:E,items:f},...a}),[d,a,E,f]),h=c.useMemo(()=>f.slice(f.indexOf(i)),[f,i]),{rect:y,node:b,isOver:S,setNodeRef:T}=go({id:i,data:C,disabled:k.droppable,resizeObserverConfig:{updateMeasurementsFor:h,...u}}),{active:F,activatorEvent:V,activeNodeRect:se,attributes:ne,setNodeRef:He,listeners:Oe,isDragging:U,over:et,setActivatorNodeRef:re,transform:Ue}=ho({id:i,data:C,attributes:{...$o,...n},disabled:k.draggable}),Se=Zr(T,He),K=!!F,pe=K&&!j&&St(p)&&St(w),De=!g&&U,ke=De&&pe?Ue:null,Ie=pe?ke??(l??D)({rects:v,activeNodeRect:se,activeIndex:p,overIndex:w,index:E}):null,ye=St(p)&&St(w)?o({id:i,items:f,activeIndex:p,overIndex:w}):E,ce=F?.id,O=c.useRef({activeId:ce,items:f,newIndex:ye,containerId:d}),Ee=f!==O.current.items,J=s({active:F,containerId:d,isDragging:U,isSorting:K,id:i,index:E,items:f,newIndex:O.current.newIndex,previousItems:O.current.items,previousContainerId:O.current.containerId,transition:m,wasDragging:O.current.activeId!=null}),de=zo({disabled:!J,index:E,node:b,rect:y});return c.useEffect(()=>{K&&O.current.newIndex!==ye&&(O.current.newIndex=ye),d!==O.current.containerId&&(O.current.containerId=d),f!==O.current.items&&(O.current.items=f)},[K,ye,d,f]),c.useEffect(()=>{if(ce===O.current.activeId)return;if(ce&&!O.current.activeId){O.current.activeId=ce;return}const ge=setTimeout(()=>{O.current.activeId=ce},50);return()=>clearTimeout(ge)},[ce]),{active:F,activeIndex:p,attributes:ne,data:C,rect:y,index:E,newIndex:ye,items:f,isOver:S,isSorting:K,isDragging:U,listeners:Oe,node:b,overIndex:w,over:et,setNodeRef:Se,setActivatorNodeRef:re,setDroppableNodeRef:T,setDraggableNodeRef:He,transform:de??Ie,transition:ue()};function ue(){if(de||Ee&&O.current.newIndex===E)return Bo;if(!(De&&!zt(V)||!m)&&(K||J))return Le.Transition.toString({...m,property:Nn})}}function Vo(e,s){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e?.draggable)!=null?n:s.draggable,droppable:(r=e?.droppable)!=null?r:s.droppable}}function It(e){if(!e)return!1;const s=e.data.current;return!!(s&&"sortable"in s&&typeof s.sortable=="object"&&"containerId"in s.sortable&&"items"in s.sortable&&"index"in s.sortable)}const Ho=[M.Down,M.Right,M.Up,M.Left],Uo=(e,s)=>{let{context:{active:n,collisionRect:r,droppableRects:a,droppableContainers:o,over:i,scrollableAncestors:l}}=s;if(Ho.includes(e.code)){if(e.preventDefault(),!n||!r)return;const u=[];o.getEnabled().forEach(d=>{if(!d||d!=null&&d.disabled)return;const p=a.get(d.id);if(p)switch(e.code){case M.Down:r.top<p.top&&u.push(d);break;case M.Up:r.top>p.top&&u.push(d);break;case M.Left:r.left>p.left&&u.push(d);break;case M.Right:r.left<p.left&&u.push(d);break}});const m=ga({collisionRect:r,droppableRects:a,droppableContainers:u});let f=tn(m,"id");if(f===i?.id&&m.length>1&&(f=m[1].id),f!=null){const d=o.get(n.id),p=o.get(f),x=p?a.get(p.id):null,j=p?.node.current;if(j&&x&&d&&p){const w=qt(j).some((h,y)=>l[y]!==h),g=Cn(d,p),D=Xo(d,p),k=w||!g?{x:0,y:0}:{x:D?r.width-x.width:0,y:D?r.height-x.height:0},E={x:x.left,y:x.top};return k.x&&k.y?E:dt(E,k)}}}};function Cn(e,s){return!It(e)||!It(s)?!1:e.data.current.sortable.containerId===s.data.current.sortable.containerId}function Xo(e,s){return!It(e)||!It(s)||!Cn(e,s)?!1:e.data.current.sortable.index<s.data.current.sortable.index}function Yo(e,s,n){const r={...e};return s.top+e.y<=n.top?r.y=n.top-s.top:s.bottom+e.y>=n.top+n.height&&(r.y=n.top+n.height-s.bottom),s.left+e.x<=n.left?r.x=n.left-s.left:s.right+e.x>=n.left+n.width&&(r.x=n.left+n.width-s.right),r}const Wo=e=>{let{transform:s}=e;return{...s,x:0}},Ko=e=>{let{transform:s,draggingNodeRect:n,windowRect:r}=e;return!n||!r?s:Yo(s,n,r)},Go=({show:e})=>e?t.jsxs("div",{className:"flex justify-between items-start mb-6 pb-4 border-b border-gray-200",children:[t.jsx("div",{className:"text-2xl font-bold",children:"FormPro"}),t.jsx("div",{className:"text-xs text-gray-400",children:"Form powered by IPLC"})]}):null,Jo=({components:e,pages:s,isMultiPage:n=!1,title:r,description:a="",className:o="",showIplcLogo:i})=>{const[l,u]=c.useState(0),m=n&&s?s[l]?.components||[]:e||[],f=[...m].sort((j,v)=>j.order-v.order),d=s?.length||1,p=s?.[l],x=j=>{const{type:v,label:w,props:g={}}=j,D=g.required||!1,k=g.placeholder||"",E=g.description||"",C=g.options||[],h=t.jsxs(at,{className:"text-sm font-medium text-gray-700",children:[w,D&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"}),E&&t.jsx("span",{className:"text-xs text-gray-500 font-normal block mt-1",children:E})]});switch(v){case"text_input":return t.jsxs("div",{className:"space-y-2",children:[h,t.jsx(B,{placeholder:k,disabled:!0,className:"bg-gray-50"})]},j.id);case"textarea":return t.jsxs("div",{className:"space-y-2",children:[h,t.jsx(Et,{placeholder:k,disabled:!0,className:"bg-gray-50 min-h-[100px]"})]},j.id);case"select":return t.jsxs("div",{className:"space-y-2",children:[h,t.jsxs("select",{disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:k||"Select an option..."}),C.map((y,b)=>t.jsx("option",{value:y,children:y},b))]})]},j.id);case"radio":return t.jsxs("div",{className:"space-y-3",children:[h,t.jsx("div",{className:"space-y-2",children:C.map((y,b)=>t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"radio",value:y,disabled:!0,className:"h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),t.jsx(at,{className:"text-sm text-gray-600",children:y})]},b))})]},j.id);case"checkbox":return t.jsxs("div",{className:"space-y-3",children:[h,t.jsx("div",{className:"space-y-2",children:C.map((y,b)=>t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"checkbox",disabled:!0,className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),t.jsx(at,{className:"text-sm text-gray-600",children:y})]},b))})]},j.id);case"date":return t.jsxs("div",{className:"space-y-2",children:[h,t.jsxs("div",{className:"relative",children:[t.jsx(B,{type:"date",disabled:!0,className:"bg-gray-50"}),t.jsx(es,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})]},j.id);case"number":return t.jsxs("div",{className:"space-y-2",children:[h,t.jsx(B,{type:"number",placeholder:k,min:g.min,max:g.max,disabled:!0,className:"bg-gray-50"}),(g.min!==void 0||g.max!==void 0)&&t.jsxs("div",{className:"text-xs text-gray-500",children:["Range: ",g.min||0," - ",g.max||"∞"]})]},j.id);case"scale":return t.jsxs("div",{className:"space-y-3",children:[h,t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-sm text-gray-500",children:g.min||1}),t.jsx("span",{className:"text-sm text-gray-500",children:g.max||10})]}),t.jsx("div",{className:"flex space-x-2",children:Array.from({length:(g.max||10)-(g.min||1)+1},(y,b)=>{const S=(g.min||1)+b;return t.jsx("button",{disabled:!0,className:"w-8 h-8 rounded-full border-2 border-gray-300 bg-gray-50 text-sm text-gray-600 flex items-center justify-center font-medium shadow-sm",children:S},S)})})]})]},j.id);case"ai_summary":return t.jsx("div",{children:t.jsx(qs,{component:j,isEditing:!1,allComponents:m})},j.id);case"title_subtitle":return t.jsx(Bs,{component:j},j.id);case"subtitle":return t.jsx(_s,{props:j.props},j.id);case"line_separator":return t.jsx(Ps,{props:j.props},j.id);case"evaluation_section":{const b=os.evaluationSections.find(S=>S.id===j.sectionId);return b?t.jsxs("div",{className:"space-y-4 p-4 border-2 border-blue-200 rounded-lg bg-blue-50/50",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:j.label}),t.jsx(Ce,{variant:"outline",className:"text-xs",children:b.discipline})]}),b.description&&t.jsx("p",{className:"text-sm text-gray-600",children:b.description}),t.jsx("div",{className:"space-y-3 mt-4",children:b.fields.map((S,T)=>{switch(`${j.id}${S.id}`,S.type){case"section_header":return t.jsx("div",{className:`mt-${S.level===1?"4":"3"} mb-2`,children:t.jsx("h4",{className:`text-${S.level===1?"lg":"md"} font-semibold text-gray-800`,children:S.label})},T);case"text":return t.jsxs("div",{className:"space-y-1",children:[t.jsxs("label",{className:"text-sm font-medium text-gray-700",children:[S.label,S.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx(B,{disabled:!0,placeholder:`Enter ${S.label.toLowerCase()}`,className:"bg-gray-50"})]},T);case"textarea":return t.jsxs("div",{className:"space-y-1",children:[t.jsxs("label",{className:"text-sm font-medium text-gray-700",children:[S.label,S.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx(Et,{disabled:!0,placeholder:`Enter ${S.label.toLowerCase()}`,rows:S.rows||3,className:"bg-gray-50 min-h-[60px]"})]},T);case"date":return t.jsxs("div",{className:"space-y-1",children:[t.jsxs("label",{className:"text-sm font-medium text-gray-700",children:[S.label,S.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(B,{type:"date",disabled:!0,className:"bg-gray-50"}),t.jsx(es,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})]},T);case"select":return t.jsxs("div",{className:"space-y-1",children:[t.jsxs("label",{className:"text-sm font-medium text-gray-700",children:[S.label,S.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("select",{disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-600",children:[t.jsxs("option",{value:"",children:["Select ",S.label.toLowerCase()]}),S.options?.map((F,V)=>t.jsx("option",{value:F,children:F},V))]})]},T);case"number":return t.jsxs("div",{className:"space-y-1",children:[t.jsxs("label",{className:"text-sm font-medium text-gray-700",children:[S.label,S.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx(B,{type:"number",disabled:!0,placeholder:`Enter ${S.label.toLowerCase()}`,min:S.min,max:S.max,className:"bg-gray-50"})]},T);case"subsection":return t.jsx("div",{className:"mt-3 mb-2",children:t.jsx("h5",{className:"text-sm font-medium text-gray-700",children:S.label})},T);default:return t.jsxs("div",{className:"text-sm text-gray-500",children:[S.label," (",S.type,")"]},T)}})})]},j.id):t.jsx("div",{className:"p-4 border border-red-300 rounded bg-red-50",children:t.jsxs("p",{className:"text-sm text-red-600",children:["Evaluation section not found: ",j.sectionId]})},j.id)}default:return t.jsx("div",{className:"space-y-2",children:t.jsxs(at,{className:"text-sm text-gray-500",children:["Unknown Component Type: ",v]})},j.id)}};return t.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg h-full overflow-y-auto ${o}`,children:[t.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(At,{className:"h-4 w-4 text-gray-500"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Preview"}),t.jsxs(Ce,{variant:"secondary",className:"text-xs",children:[f.length," ",f.length===1?"field":"fields"]})]}),n&&s&&s.length>1&&t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("span",{className:"text-xs text-gray-500",children:["Page ",l+1," of ",d]})})]}),t.jsx("p",{className:"text-xs text-gray-500",children:"This is how your form will appear to users"})]})}),t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"max-w-2xl mx-auto",children:[t.jsx(Go,{show:i??!0}),t.jsxs("div",{className:"mb-8",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:r||"Untitled Form"}),a&&t.jsx("p",{className:"text-gray-600",children:a}),n&&s&&s.length>1&&t.jsxs("div",{className:"mt-6 space-y-2",children:[t.jsx(Vn,{value:(l+1)/d*100,className:"h-2"}),t.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[t.jsxs("span",{children:["Step ",l+1," of ",d]}),p&&t.jsx("span",{className:"font-medium",children:p.title})]})]})]}),n&&p&&t.jsxs("div",{className:"mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:p.title}),p.description&&t.jsx("p",{className:"text-gray-600 text-sm",children:p.description})]}),f.length>0?t.jsxs("div",{className:"space-y-6",children:[f.map(x),t.jsx("div",{className:"pt-6 border-t border-gray-200",children:n&&s&&s.length>1?t.jsxs("div",{className:"flex justify-between",children:[t.jsxs(W,{disabled:!0,variant:"outline",className:l===0?"invisible":"",children:[t.jsx(Hs,{className:"h-4 w-4 mr-1"}),"Previous"]}),t.jsx(W,{disabled:!0,className:"bg-blue-600 hover:bg-blue-700",children:l===d-1?"Submit Form":t.jsxs(t.Fragment,{children:["Next",t.jsx(Tt,{className:"h-4 w-4 ml-1"})]})})]}):t.jsx(W,{disabled:!0,className:"bg-blue-600 hover:bg-blue-700",children:"Submit Form"})})]}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"text-gray-400 mb-4",children:t.jsx(At,{className:"h-12 w-12 mx-auto"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-500 mb-2",children:"No components yet"}),t.jsx("p",{className:"text-gray-400",children:"Drag components from the palette to start building your form"})]})]})})]})},Os={ClipboardList:t.jsx($s,{className:"h-4 w-4"}),Brain:t.jsx(Vs,{className:"h-4 w-4"}),Hand:t.jsx(Ks,{className:"h-4 w-4"}),MessageSquare:t.jsx(tr,{className:"h-4 w-4"}),Award:t.jsx(ur,{className:"h-4 w-4"}),FileText:t.jsx(Ve,{className:"h-4 w-4"}),TrendingUp:t.jsx(Yr,{className:"h-4 w-4"})},Zo={"Initial Assessment":"bg-[#219FD9]/20 text-[#219FD9] border-[#219FD9]/30","Cognitive Assessment":"bg-purple-500/20 text-purple-300 border-purple-500/30","Motor Assessment":"bg-[#80C97B]/20 text-[#80C97B] border-[#80C97B]/30","Communication Assessment":"bg-blue-500/20 text-blue-300 border-blue-500/30","Functional Assessment":"bg-[#F9C04D]/20 text-[#F9C04D] border-[#F9C04D]/30","Testing Results":"bg-yellow-500/20 text-yellow-300 border-yellow-500/30",Summary:"bg-gray-500/20 text-gray-300 border-gray-500/30","Progress Monitoring":"bg-[#27599F]/20 text-[#219FD9] border-[#27599F]/30"},Is={SLP:"bg-blue-500/20 text-blue-300 border-blue-500/30",OT:"bg-[#80C97B]/20 text-[#80C97B] border-[#80C97B]/30",Both:"bg-[#219FD9]/20 text-[#219FD9] border-[#219FD9]/30"},Qo=({className:e="",onSectionDrag:s,onComponentClick:n,selectedDiscipline:r="Both",isCollapsed:a,onCollapsedChange:o})=>{P.useEffect(()=>{console.log("EvaluationSectionsModule mounted at",new Date().toISOString()),console.log("Props received:",{hasOnSectionDrag:!!s,hasOnComponentClick:!!n,onComponentClickType:typeof n,selectedDiscipline:r})},[]);const[i,l]=c.useState(new Set),[u,m]=c.useState(!1),[f,d]=c.useState(!1),p=a!==void 0?a:u,x=o||m;c.useEffect(()=>{const h=()=>{d(window.innerWidth<768)};return h(),window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]),c.useEffect(()=>{f&&!p&&x(!0)},[f]);const j=os.evaluationSections,v=h=>({id:`evaluation_section_${Date.now()}`,type:"evaluation_section",sectionId:h.id,label:h.label,collapsed:!1,fieldValues:{},props:{required:!1,description:h.description,editable:!0}}),w=(h,y)=>{console.log("EvaluationSectionsModule: handleDragStart called for section",y.label);const b=v(y);s&&(console.log("EvaluationSectionsModule: Calling onSectionDrag with component",b),s(b)),h.dataTransfer.setData("application/json",JSON.stringify(b)),h.dataTransfer.effectAllowed="copy"},g=h=>{if(console.log("EvaluationSectionsModule: handleClick called for",h.type),n){const y=v(h);console.log("EvaluationSectionsModule: calling onComponentClick with",y),n(y)}else console.log("EvaluationSectionsModule: onComponentClick not provided")},D=h=>{l(y=>{const b=new Set(y);return b.has(h)?b.delete(h):b.add(h),b})},k=j.filter(h=>r==="Both"||h.discipline===r||h.discipline==="Both"),E=k.reduce((h,y)=>(h[y.category]||(h[y.category]=[]),h[y.category].push(y),h),{}),C=h=>{switch(h.type){case"section_header":return t.jsx("h3",{className:`font-bold text-white ${h.level===1?"text-lg":"text-base"}`,children:h.label});case"subsection":return t.jsx("h4",{className:"font-semibold text-[#219FD9] text-sm mt-2",children:h.label});case"text":case"date":return t.jsxs("div",{className:"mt-1",children:[t.jsxs("label",{className:"text-xs text-gray-300",children:[h.label," ",h.required&&t.jsx("span",{className:"text-[#F9C04D]",children:"*"})]}),t.jsx("div",{className:"h-8 bg-[#27599F]/20 rounded border border-[#27599F]/30 mt-1"})]});case"textarea":return t.jsxs("div",{className:"mt-1",children:[t.jsxs("label",{className:"text-xs text-gray-300",children:[h.label," ",h.required&&t.jsx("span",{className:"text-[#F9C04D]",children:"*"})]}),t.jsx("div",{className:"bg-[#27599F]/20 rounded border border-[#27599F]/30 mt-1",style:{height:`${(typeof h.rows=="number"?h.rows:3)*1.5}rem`}})]});case"select":return t.jsxs("div",{className:"mt-1",children:[t.jsxs("label",{className:"text-xs text-gray-300",children:[h.label," ",h.required&&t.jsx("span",{className:"text-[#F9C04D]",children:"*"})]}),t.jsxs("div",{className:"h-8 bg-[#27599F]/20 rounded border border-[#27599F]/30 mt-1 flex items-center px-2",children:[t.jsx("span",{className:"text-xs text-gray-400",children:h.options?.[0]||"Select..."}),t.jsx(ys,{className:"h-3 w-3 ml-auto text-gray-400"})]})]});case"number":return t.jsxs("div",{className:"mt-1",children:[t.jsxs("label",{className:"text-xs text-gray-300",children:[h.label," ",h.required&&t.jsx("span",{className:"text-[#F9C04D]",children:"*"})]}),t.jsx("div",{className:"h-8 bg-[#27599F]/20 rounded border border-[#27599F]/30 mt-1"})]});case"rating_scale":return t.jsxs("div",{className:"mt-1",children:[t.jsx("label",{className:"text-xs text-gray-300",children:h.label}),t.jsx("div",{className:"flex gap-1 mt-1",children:h.scale?.map((y,b)=>t.jsx("div",{className:"flex-1 h-6 bg-[#27599F]/20 border border-[#27599F]/30 rounded text-xs flex items-center justify-center text-gray-300",children:y},y))}),h.labels&&t.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[t.jsx("span",{children:h.labels[0]}),t.jsx("span",{children:h.labels[h.labels.length-1]})]})]});case"checkbox_group":return t.jsxs("div",{className:"mt-1",children:[t.jsx("label",{className:"text-xs text-gray-300",children:h.label}),t.jsxs("div",{className:"space-y-1 mt-1",children:[h.options?.slice(0,3).map((y,b)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"h-3 w-3 border border-[#27599F]/30 rounded"}),t.jsx("span",{className:"text-xs text-gray-300",children:y})]},b)),h.options&&h.options.length>3&&t.jsxs("span",{className:"text-xs text-gray-400",children:["+",h.options.length-3," more"]})]})]});case"rating_grid":case"assistance_grid":return t.jsxs("div",{className:"mt-1",children:[t.jsx("label",{className:"text-xs text-gray-300",children:h.label}),t.jsxs("div",{className:"bg-[#27599F]/10 rounded border border-[#27599F]/30 p-2 mt-1",children:[t.jsxs("div",{className:"grid grid-cols-5 gap-1 text-xs",children:[t.jsx("div",{}),h.columns?.slice(0,4).map((y,b)=>t.jsx("div",{className:"text-center text-gray-400 truncate",children:y},b)),Array.isArray(h.rows)&&h.rows.slice(0,2).map((y,b)=>t.jsxs(P.Fragment,{children:[t.jsx("div",{className:"text-gray-300 truncate",children:y}),h.columns?.slice(0,4).map((S,T)=>t.jsx("div",{className:"h-4 bg-[#27599F]/20 rounded"},T))]},b))]}),Array.isArray(h.rows)&&h.rows.length>2&&t.jsxs("div",{className:"text-xs text-gray-400 text-center mt-1",children:["+",h.rows.length-2," more rows"]})]})]});case"repeating_group":return t.jsxs("div",{className:"mt-1",children:[t.jsx("label",{className:"text-xs text-gray-300",children:h.label}),t.jsxs("div",{className:"bg-[#27599F]/10 rounded border border-[#27599F]/30 p-2 mt-1",children:[t.jsx("div",{className:"space-y-1",children:h.fields?.slice(0,2).map((y,b)=>t.jsxs("div",{className:"text-xs text-gray-300",children:["• ",y.label]},b))}),t.jsxs(W,{variant:"outline",size:"sm",className:"mt-2 h-6 text-xs border-[#219FD9]/30 text-[#219FD9] hover:bg-[#219FD9]/10",children:[t.jsx(ts,{className:"h-3 w-3 mr-1"}),h.addButtonLabel||"Add Item"]})]})]});default:return null}};return t.jsxs("div",{className:be("evaluation-sections-module relative h-full flex flex-col bg-[#153F81] transition-all duration-300 ease-in-out","iplc-shadow-xl border-r-2 border-[#27599F]/30",p?"w-16":"w-80",f&&"fixed top-0 left-0 z-50 h-screen",f&&p&&"-translate-x-full",e),children:[t.jsx("button",{onClick:()=>x(!p),className:be("absolute -right-3 top-20 z-50","w-6 h-6 rounded-full bg-gradient-metallic-primary iplc-shadow-md","flex items-center justify-center","hover:iplc-shadow-lg transition-all duration-200","text-white"),"aria-label":p?"Expand sidebar":"Collapse sidebar",children:p?t.jsx(Tt,{className:"h-3 w-3"}):t.jsx(Hs,{className:"h-3 w-3"})}),f&&t.jsx("button",{onClick:()=>x(!p),className:be("fixed top-4 left-4 z-50","w-10 h-10 rounded-lg bg-gradient-metallic-primary iplc-shadow-md","flex items-center justify-center","hover:iplc-shadow-lg transition-all duration-200",p?"visible":"invisible"),"aria-label":"Open evaluation sections",children:t.jsx(er,{className:"h-5 w-5 text-white"})}),t.jsxs("div",{className:be("p-4 border-b border-[#27599F]/30 flex-shrink-0 bg-gradient-to-br from-[#153F81] to-[#27599F]/50",p&&"px-2"),children:[t.jsxs("div",{className:be("flex items-center gap-2 mb-2",p&&"justify-center"),children:[t.jsx(Ve,{className:"h-5 w-5 text-[#F9C04D] flex-shrink-0"}),!p&&t.jsx("h3",{className:"text-lg font-semibold text-white",children:"Evaluation Sections"})]}),!p&&t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-sm text-gray-300",children:"Comprehensive evaluation modules for clinical assessments"}),t.jsxs("div",{className:"flex gap-1 mt-2",children:[t.jsx(Ce,{variant:"outline",className:`text-xs px-2 py-0.5 border ${Is[r]}`,children:r==="Both"?"All Disciplines":r}),t.jsxs(Ce,{variant:"outline",className:"text-xs px-2 py-0.5 border border-[#27599F]/30 text-gray-300",children:[k.length," sections"]})]})]})]}),t.jsx("div",{className:be("flex-1 overflow-y-auto custom-scrollbar space-y-6",p?"px-2 py-4":"p-4"),children:Object.entries(E).map(([h,y])=>t.jsxs("div",{children:[!p&&t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-300",children:h}),t.jsx(Ce,{variant:"outline",className:`text-xs px-2 py-0.5 border ${Zo[h]||"bg-gray-500/20 text-gray-300 border-gray-500/30"}`,children:y.length})]}),t.jsx("div",{className:be("space-y-2",p&&"space-y-3"),children:y.map(b=>p?t.jsxs("div",{className:"group relative",children:[t.jsx("button",{className:be("w-full p-2 rounded-lg","bg-gradient-to-br from-[#27599F]/30 to-[#153F81]/30","hover:from-[#219FD9]/40 hover:to-[#27599F]/40","border border-[#27599F]/30 hover:border-[#219FD9]/50","iplc-shadow-md hover:iplc-shadow-lg","transition-all duration-200","flex items-center justify-center"),onClick:()=>g(b),title:b.label,children:t.jsx("div",{className:"p-1.5 bg-gradient-to-br from-[#219FD9]/20 to-[#27599F]/20 rounded",children:Os[b.icon]||t.jsx(Ve,{className:"h-4 w-4 text-[#F9C04D]"})})}),t.jsx("div",{className:be("absolute left-full ml-2 top-1/2 -translate-y-1/2 z-50","bg-[#153F81] border border-[#27599F]/30 rounded-lg iplc-shadow-xl","px-3 py-2 text-sm text-white","opacity-0 group-hover:opacity-100 pointer-events-none","transition-opacity duration-200","whitespace-nowrap"),children:b.label})]},b.id):t.jsx(Pt,{className:be("cursor-pointer transition-all duration-200","bg-gradient-to-br from-[#27599F]/20 to-[#153F81]/20","border border-[#27599F]/30 hover:border-[#219FD9]/50","hover:iplc-shadow-lg","overflow-hidden"),"data-section-id":b.id,onClick:S=>{console.log("EvaluationSectionsModule: Card onClick triggered for",b.label),console.log("Event target:",S.target),console.log("Current target:",S.currentTarget),console.log("Event type:",S.type),console.log("onComponentClick exists:",!!n),console.log("onComponentClick type:",typeof n);const T=S.target;if(T.closest(".grip-handle")||T.closest("button")){console.log("EvaluationSectionsModule: Click on interactive element, ignoring");return}if(S.stopPropagation(),n){const F=v(b);console.log("EvaluationSectionsModule: Calling onComponentClick with component",F),n(F)}else console.error("EvaluationSectionsModule: No onComponentClick handler provided!")},onMouseDown:S=>{console.log("EvaluationSectionsModule: Card onMouseDown triggered for",b.label),console.log("MouseDown target:",S.target)},onPointerDown:S=>{console.log("EvaluationSectionsModule: Card onPointerDown triggered for",b.label),console.log("PointerDown target:",S.target)},children:t.jsx(_t,{className:"p-3",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0 p-2 bg-gradient-to-br from-[#219FD9]/20 to-[#27599F]/20 rounded-md",children:Os[b.icon]||t.jsx(Ve,{className:"h-4 w-4 text-[#F9C04D]"})}),t.jsxs("div",{className:"flex-grow min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("h5",{className:"text-sm font-medium text-white truncate",children:b.label}),t.jsx(Ce,{variant:"outline",className:`text-xs px-2 py-0.5 border ${Is[b.discipline]}`,children:b.discipline})]}),t.jsx("p",{className:"text-xs text-gray-300 mb-2",children:b.description}),t.jsx(W,{variant:"ghost",size:"sm",className:"h-6 text-xs p-0 hover:bg-[#27599F]/20 text-gray-300",onClick:S=>{S.stopPropagation(),D(b.id)},children:i.has(b.id)?t.jsxs(t.Fragment,{children:[t.jsx(ys,{className:"h-3 w-3 mr-1"}),"Hide Fields"]}):t.jsxs(t.Fragment,{children:[t.jsx(Tt,{className:"h-3 w-3 mr-1"}),"Preview Fields (",b.fields.length,")"]})}),i.has(b.id)&&t.jsx("div",{className:"mt-3 space-y-2 p-3 bg-[#153F81]/50 rounded-md max-h-60 overflow-y-auto border border-[#27599F]/30",children:b.fields.map((S,T)=>t.jsx("div",{children:C(S)},T))})]}),t.jsx("div",{className:"flex-shrink-0 grip-handle cursor-move p-1 hover:bg-[#27599F]/20 rounded transition-colors duration-200",draggable:!0,onDragStart:S=>{console.log("EvaluationSectionsModule: Grip handle dragStart for",b.label),S.stopPropagation(),w(S,b)},onDragEnd:S=>{console.log("EvaluationSectionsModule: Grip handle dragEnd"),S.stopPropagation()},children:t.jsx(Ws,{className:"h-4 w-4 text-gray-400"})})]})})},b.id))})]},h))}),!p&&t.jsx("div",{className:"p-4 border-t border-[#27599F]/30 bg-gradient-to-br from-[#27599F]/20 to-[#153F81]/20 flex-shrink-0",children:t.jsxs("div",{className:"text-xs text-gray-300",children:[t.jsxs("p",{className:"font-medium mb-2 flex items-center gap-1 text-[#F9C04D]",children:[t.jsx($s,{className:"h-3 w-3"}),"Usage Tips:"]}),t.jsxs("ul",{className:"space-y-1",children:[t.jsx("li",{children:"• Drag sections to add comprehensive evaluations"}),t.jsx("li",{children:"• Each section includes multiple assessment fields"}),t.jsx("li",{children:"• Fields are customizable via Property Grid"}),t.jsx("li",{children:"• Sections follow clinical best practices"})]})]})})]})},ei=[{id:"assessment-tools",name:"Assessment Tools",icon:"stethoscope",description:"Standardized assessment instruments and evaluation tools",subcategories:[{id:"motor-assessments",name:"Motor & Physical Assessments",components:[{id:"rom-assessment",name:"Range of Motion Assessment",type:"rom_assessment",discipline:"OT",description:"Document joint range of motion measurements",fields:[{name:"joint",type:"select",label:"Joint",options:["Shoulder","Elbow","Wrist","Hip","Knee","Ankle"]},{name:"movement",type:"select",label:"Movement",options:["Flexion","Extension","Abduction","Adduction","Rotation"]},{name:"degrees",type:"number",label:"Degrees"}]},{id:"strength-assessment",name:"Manual Muscle Testing",type:"mmt_assessment",discipline:"OT",description:"Document muscle strength using standard MMT scale",config:{scale:"0-5",includeGravity:!0}},{id:"balance-assessment",name:"Balance Assessment",type:"balance_assessment",discipline:"Both",description:"Evaluate static and dynamic balance",fields:[{name:"testType",type:"select",label:"Test Type",options:["Berg Balance Scale","Tinetti","Single Leg Stance","Functional Reach"]}]}]},{id:"cognitive-assessments",name:"Cognitive & Language Assessments",components:[{id:"moca-assessment",name:"Montreal Cognitive Assessment (MoCA)",type:"moca_assessment",discipline:"Both",description:"Standardized cognitive screening tool"},{id:"mmse-assessment",name:"Mini-Mental State Exam (MMSE)",type:"mmse_assessment",discipline:"Both",description:"Brief cognitive status examination"},{id:"language-assessment",name:"Language Assessment Battery",type:"language_assessment",discipline:"SLP",description:"Comprehensive language evaluation",fields:[{name:"domain",type:"checkbox",label:"Domains Assessed",options:["Expressive Language","Receptive Language","Pragmatics","Reading","Writing"]}]}]}]},{id:"adl-iadl",name:"ADL & IADL Assessments",icon:"home",description:"Activities of Daily Living evaluations",subcategories:[{id:"basic-adl",name:"Basic ADLs",components:[{id:"bathing-assessment",name:"Bathing/Hygiene Assessment",type:"bathing_assessment",discipline:"OT",description:"Evaluate bathing and personal hygiene skills"},{id:"dressing-assessment",name:"Dressing Assessment",type:"dressing_assessment",discipline:"OT",description:"Assess upper and lower body dressing abilities"},{id:"feeding-assessment",name:"Feeding/Eating Assessment",type:"feeding_assessment",discipline:"Both",description:"Evaluate feeding and swallowing function"},{id:"toileting-assessment",name:"Toileting Assessment",type:"toileting_assessment",discipline:"OT",description:"Assess toilet transfer and hygiene"}]},{id:"instrumental-adl",name:"Instrumental ADLs",components:[{id:"cooking-assessment",name:"Meal Preparation Assessment",type:"cooking_assessment",discipline:"OT",description:"Evaluate cooking and kitchen safety skills"},{id:"medication-management",name:"Medication Management",type:"medication_assessment",discipline:"OT",description:"Assess ability to manage medications independently"},{id:"money-management",name:"Financial Management",type:"money_assessment",discipline:"OT",description:"Evaluate money handling and budgeting skills"}]}]},{id:"communication",name:"Communication & Swallowing",icon:"user",description:"Speech, language, and swallowing assessments",subcategories:[{id:"speech-assessments",name:"Speech Production",components:[{id:"articulation-assessment",name:"Articulation Assessment",type:"articulation_assessment",discipline:"SLP",description:"Evaluate speech sound production"},{id:"fluency-assessment",name:"Fluency Assessment",type:"fluency_assessment",discipline:"SLP",description:"Assess stuttering and fluency disorders"},{id:"voice-assessment",name:"Voice Assessment",type:"voice_assessment",discipline:"SLP",description:"Evaluate vocal quality and function"}]},{id:"swallowing-assessments",name:"Swallowing & Dysphagia",components:[{id:"bedside-swallow",name:"Bedside Swallow Evaluation",type:"bedside_swallow",discipline:"SLP",description:"Clinical swallowing assessment"},{id:"oral-motor-exam",name:"Oral Motor Examination",type:"oral_motor_exam",discipline:"SLP",description:"Assess oral motor structure and function"}]}]},{id:"pediatric",name:"Pediatric Assessments",icon:"baby",description:"Child-specific evaluation tools",subcategories:[{id:"developmental",name:"Developmental Assessments",components:[{id:"peabody-assessment",name:"Peabody Developmental Motor Scales",type:"peabody_assessment",discipline:"OT",description:"Assess gross and fine motor development"},{id:"sensory-profile",name:"Sensory Profile",type:"sensory_profile",discipline:"OT",description:"Evaluate sensory processing patterns"},{id:"pls-assessment",name:"Preschool Language Scales",type:"pls_assessment",discipline:"SLP",description:"Comprehensive language assessment for young children"}]},{id:"school-function",name:"School Function",components:[{id:"handwriting-assessment",name:"Handwriting Assessment",type:"handwriting_assessment",discipline:"OT",description:"Evaluate handwriting legibility and speed"},{id:"school-amps",name:"School AMPS",type:"school_amps",discipline:"OT",description:"Assessment of Motor and Process Skills in school"}]}]},{id:"specialized",name:"Specialized Assessments",icon:"brain",description:"Condition-specific evaluation tools",subcategories:[{id:"neurological",name:"Neurological Conditions",components:[{id:"stroke-assessment",name:"Stroke Impact Scale",type:"stroke_assessment",discipline:"Both",description:"Assess stroke recovery across multiple domains"},{id:"aphasia-assessment",name:"Aphasia Assessment",type:"aphasia_assessment",discipline:"SLP",description:"Comprehensive aphasia evaluation"},{id:"apraxia-assessment",name:"Apraxia Battery",type:"apraxia_assessment",discipline:"Both",description:"Assess motor planning and execution"}]},{id:"cognitive-communication",name:"Cognitive-Communication",components:[{id:"rbans-assessment",name:"RBANS",type:"rbans_assessment",discipline:"SLP",description:"Repeatable Battery for Assessment of Neuropsychological Status"},{id:"executive-function",name:"Executive Function Assessment",type:"executive_assessment",discipline:"Both",description:"Evaluate planning, organization, and problem-solving"}]}]}],ti={categories:ei},si={activity:t.jsx(cr,{className:"h-4 w-4"}),brain:t.jsx(Vs,{className:"h-4 w-4"}),heart:t.jsx(Or,{className:"h-4 w-4"}),stethoscope:t.jsx(Vr,{className:"h-4 w-4"}),user:t.jsx(Zn,{className:"h-4 w-4"}),filetext:t.jsx(Ve,{className:"h-4 w-4"}),calendar:t.jsx(es,{className:"h-4 w-4"}),clock:t.jsx(Jn,{className:"h-4 w-4"}),pill:t.jsx(Br,{className:"h-4 w-4"}),testtube:t.jsx(Ur,{className:"h-4 w-4"}),eye:t.jsx(At,{className:"h-4 w-4"}),ear:t.jsx(Sr,{className:"h-4 w-4"}),hand:t.jsx(Ks,{className:"h-4 w-4"}),footprints:t.jsx(kr,{className:"h-4 w-4"}),users:t.jsx(sr,{className:"h-4 w-4"}),baby:t.jsx(hr,{className:"h-4 w-4"}),userplus:t.jsx(Kr,{className:"h-4 w-4"}),briefcase:t.jsx(xr,{className:"h-4 w-4"}),home:t.jsx(Pr,{className:"h-4 w-4"}),car:t.jsx(br,{className:"h-4 w-4"}),utensils:t.jsx(Jr,{className:"h-4 w-4"}),bath:t.jsx(pr,{className:"h-4 w-4"}),shirt:t.jsx(zr,{className:"h-4 w-4"}),bookopen:t.jsx(Gn,{className:"h-4 w-4"}),gamepad:t.jsx(Ar,{className:"h-4 w-4"})};function ni({onComponentDrag:e,onComponentClick:s,selectedDiscipline:n="Both"}){const[r,a]=c.useState(""),[o,i]=c.useState("all"),[l,u]=c.useState(new Set),[m,f]=c.useState(n),d=ti.categories.map(g=>({id:g.id,name:g.name,description:g.description,icon:si[g.icon]||t.jsx(ss,{className:"h-4 w-4"}),subcategories:g.subcategories.map(D=>({id:D.id,name:D.name,components:D.components.map(k=>({id:k.id,name:k.name,type:k.type,discipline:k.discipline,description:k.description,fields:k.fields,config:k.config??{}}))}))})),p=g=>g.filter(D=>{const k=r===""||D.name.toLowerCase().includes(r.toLowerCase())||D.description?.toLowerCase().includes(r.toLowerCase()),E=m==="Both"||D.discipline==="Both"||D.discipline===m;return k&&E}),x=o==="all"?d:d.filter(g=>g.id===o),j=g=>{const D=new Set(l);D.has(g)?D.delete(g):D.add(g),u(D)},v=g=>{const D=g.config??{},k={id:`${g.type}_${Date.now()}`,type:"clinical_component",label:g.name,order:0,props:{componentType:g.type,discipline:g.discipline,...D},fields:g.fields};s(k)},w=(g,D)=>{const k=D.config??{},E={id:`${D.type}_${Date.now()}`,type:"clinical_component",label:D.name,order:0,props:{componentType:D.type,discipline:D.discipline,...k},fields:D.fields};g.dataTransfer.effectAllowed="copy",e(E)};return c.useEffect(()=>{if(r){const g=new Set;d.forEach(D=>{D.subcategories.forEach(k=>{p(k.components).length>0&&g.add(D.id)})}),u(g)}},[r]),t.jsxs("div",{className:"h-full flex flex-col p-4 bg-gradient-to-br from-gray-50 to-gray-100",children:[t.jsxs("div",{className:"mb-4",children:[t.jsxs("h2",{className:"text-lg font-semibold mb-2 flex items-center gap-2",children:[t.jsx(ss,{className:"h-5 w-5 text-blue-600"}),"Clinical Components"]}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Specialized components for clinical assessments and documentation"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Wn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),t.jsx(B,{placeholder:"Search clinical components...",value:r,onChange:g=>a(g.target.value),className:"pl-10"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(Be,{value:m,onValueChange:g=>f(g),children:[t.jsx($e,{className:"w-[140px]",children:t.jsx(ze,{})}),t.jsxs(qe,{children:[t.jsx(z,{value:"Both",children:"All Disciplines"}),t.jsx(z,{value:"OT",children:"OT Only"}),t.jsx(z,{value:"SLP",children:"SLP Only"})]})]}),t.jsxs(Be,{value:o,onValueChange:i,children:[t.jsx($e,{className:"flex-1",children:t.jsx(ze,{placeholder:"All Categories"})}),t.jsxs(qe,{children:[t.jsx(z,{value:"all",children:"All Categories"}),d.map(g=>t.jsx(z,{value:g.id,children:g.name},g.id))]})]})]})]})]}),t.jsx(Kn,{className:"flex-1",children:t.jsx("div",{className:"space-y-4",children:x.map(g=>{const D=l.has(g.id);return!g.subcategories.some(E=>p(E.components).length>0)&&r?null:t.jsxs(Pt,{className:"border-l-4 border-l-blue-500",children:[t.jsxs(is,{className:"cursor-pointer pb-3",onClick:()=>j(g.id),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[g.icon,t.jsx(ls,{className:"text-base",children:g.name})]}),t.jsx(Tt,{className:`h-4 w-4 transition-transform ${D?"rotate-90":""}`})]}),t.jsx(zs,{className:"text-xs mt-1",children:g.description})]}),D&&t.jsx(_t,{className:"pt-0",children:g.subcategories.map(E=>{const C=p(E.components);return C.length===0?null:t.jsxs("div",{className:"mb-4 last:mb-0",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:E.name}),t.jsx("div",{className:"grid gap-2",children:C.map(h=>t.jsxs("div",{draggable:!0,onDragStart:y=>w(y,h),onClick:()=>v(h),className:"group relative p-3 bg-white border rounded-lg cursor-move hover:shadow-md hover:border-blue-300 transition-all duration-150",children:[t.jsx("div",{className:"flex items-start justify-between",children:t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"font-medium text-sm",children:h.name}),t.jsx(Ce,{variant:h.discipline==="OT"?"default":h.discipline==="SLP"?"secondary":"outline",className:"text-xs",children:h.discipline})]}),h.description&&t.jsx("p",{className:"text-xs text-gray-600",children:h.description})]})}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-150 pointer-events-none"})]},h.id))})]},E.id)})})]},g.id)})})}),t.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:t.jsxs("p",{className:"text-xs text-blue-700",children:[t.jsx("strong",{children:"Tip:"})," Drag components to the form canvas or click to add them. Use the discipline filter to show components specific to OT or SLP."]})})]})}function ri({component:e,allComponents:s,onUpdate:n}){const r=s.filter(d=>d.id!==e.id&&!["title_subtitle","line_separator","evaluation_section","ai_summary"].includes(d.type)),a=e.props?.visibilityCondition?{field:e.props.visibilityCondition.field??"",operator:e.props.visibilityCondition.operator??"equals",value:String(e.props.visibilityCondition.value??"")}:void 0,o=!!a,i=d=>{if(d)n({props:{...e.props,visibilityCondition:{field:r[0]?.id||"",operator:"equals",value:""}}});else{const{visibilityCondition:p,...x}=e.props||{};n({props:x})}},l=d=>{n({props:{...e.props,visibilityCondition:{...a,field:d,value:""}}})},u=d=>{n({props:{...e.props,visibilityCondition:{...a,operator:d}}})},m=d=>{n({props:{...e.props,visibilityCondition:{...a,value:d}}})},f=r.find(d=>d.id===a?.field);return t.jsxs(Pt,{className:"border-0 shadow-none",children:[t.jsx(is,{className:"px-0 pt-0 pb-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Rr,{className:"h-4 w-4 text-blue-600"}),t.jsx(ls,{className:"text-sm font-medium",children:"Conditional Logic"})]}),t.jsx(Hn,{checked:o,onCheckedChange:i})]})}),o&&t.jsxs(_t,{className:"px-0 space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(at,{className:"text-xs",children:"Show this field when:"}),t.jsx("div",{className:"space-y-2",children:t.jsxs(Be,{value:a.field,onValueChange:l,children:[t.jsx($e,{className:"h-9",children:t.jsx(ze,{placeholder:"Select a field"})}),t.jsx(qe,{children:r.map(d=>t.jsx(z,{value:d.id,children:d.label||d.id},d.id))})]})}),t.jsx("div",{className:"space-y-2",children:t.jsxs(Be,{value:a?.operator??"equals",onValueChange:d=>u(d),children:[t.jsx($e,{className:"h-9",children:t.jsx(ze,{placeholder:"Select operator"})}),t.jsxs(qe,{children:[t.jsx(z,{value:"equals",children:"Equals"}),t.jsx(z,{value:"not_equals",children:"Does not equal"}),t.jsx(z,{value:"contains",children:"Contains"}),t.jsx(z,{value:"greater_than",children:"Greater than"}),t.jsx(z,{value:"less_than",children:"Less than"})]})]})}),t.jsx("div",{className:"space-y-2",children:f?.type==="select"||f?.type==="radio"?t.jsxs(Be,{value:a?.value??"",onValueChange:m,children:[t.jsx($e,{className:"h-9",children:t.jsx(ze,{placeholder:"Select value"})}),t.jsx(qe,{children:f.props?.options?.map(d=>t.jsx(z,{value:d,children:d},d))})]}):f?.type==="checkbox"?t.jsxs(Be,{value:a?.value??"",onValueChange:m,children:[t.jsx($e,{className:"h-9",children:t.jsx(ze,{placeholder:"Select state"})}),t.jsxs(qe,{children:[t.jsx(z,{value:"true",children:"Checked"}),t.jsx(z,{value:"false",children:"Unchecked"})]})]}):t.jsx(B,{value:a?.value??"",onChange:d=>m(d.target.value),placeholder:f?.type==="number"?"Enter number":f?.type==="date"?"YYYY-MM-DD":"Enter value",type:f?.type==="number"?"number":"text",className:"h-9"})})]}),t.jsx("div",{className:"p-3 bg-blue-50 rounded-md",children:t.jsxs("p",{className:"text-xs text-blue-700",children:[t.jsx("span",{className:"font-medium",children:"Preview:"})," Show when"," ",t.jsx("span",{className:"font-mono bg-blue-100 px-1 rounded",children:f?.label||"field"})," ",(a?.operator??"equals")==="equals"&&"equals",(a?.operator??"equals")==="not_equals"&&"does not equal",(a?.operator??"equals")==="contains"&&"contains",(a?.operator??"equals")==="greater_than"&&"is greater than",(a?.operator??"equals")==="less_than"&&"is less than"," ",t.jsx("span",{className:"font-mono bg-blue-100 px-1 rounded",children:(a?.value??"")||"..."})]})})]})]})}function Sn({component:e,onUpdate:s,isEditing:n=!1,allComponents:r=[]}){e.type==="evaluation_section"&&(console.log("ComponentRenderer: Rendering evaluation section",e),console.log("Component sectionId:",e.sectionId));const a=o=>{s?.({label:o})};switch(e.type){case"text_input":return t.jsxs("div",{className:"space-y-2",children:[n?t.jsx(B,{value:e.label,onChange:o=>a(o.target.value),className:"font-medium border-dashed",placeholder:"Enter field label"}):t.jsx("label",{className:"text-sm font-medium",children:e.label}),t.jsx(B,{placeholder:e.props?.placeholder||"Enter text...",disabled:!n,className:n?"bg-gray-50":""}),e.props?.required&&t.jsx("span",{className:"text-xs text-red-500",children:"* Required"})]});case"textarea":return t.jsxs("div",{className:"space-y-2",children:[n?t.jsx(B,{value:e.label,onChange:o=>a(o.target.value),className:"font-medium border-dashed",placeholder:"Enter field label"}):t.jsx("label",{className:"text-sm font-medium",children:e.label}),t.jsx(Et,{placeholder:e.props?.placeholder||"Enter text...",disabled:!n,className:n?"bg-gray-50":""}),e.props?.required&&t.jsx("span",{className:"text-xs text-red-500",children:"* Required"})]});case"select":return t.jsxs("div",{className:"space-y-2",children:[n?t.jsx(B,{value:e.label,onChange:o=>a(o.target.value),className:"font-medium border-dashed",placeholder:"Enter field label"}):t.jsx("label",{className:"text-sm font-medium",children:e.label}),t.jsxs("select",{disabled:!n,className:"flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",children:[t.jsx("option",{value:"",children:"Select an option..."}),e.props?.options?.map((o,i)=>t.jsx("option",{value:o,children:o},i))]}),e.props?.required&&t.jsx("span",{className:"text-xs text-red-500",children:"* Required"})]});case"radio":return t.jsxs("div",{className:"space-y-2",children:[n?t.jsx(B,{value:e.label,onChange:o=>a(o.target.value),className:"font-medium border-dashed",placeholder:"Enter field label"}):t.jsx("label",{className:"text-sm font-medium",children:e.label}),t.jsx("div",{className:"space-y-2",children:e.props?.options?.map((o,i)=>t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"radio",name:e.id,value:o,disabled:!n,className:"h-4 w-4"}),t.jsx("label",{className:"text-sm",children:o})]},i))}),e.props?.required&&t.jsx("span",{className:"text-xs text-red-500",children:"* Required"})]});case"checkbox":return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"checkbox",disabled:!n,className:"h-4 w-4"}),n?t.jsx(B,{value:e.label,onChange:o=>a(o.target.value),className:"font-medium border-dashed flex-1",placeholder:"Enter checkbox label"}):t.jsx("label",{className:"text-sm font-medium",children:e.label})]}),e.props?.required&&t.jsx("span",{className:"text-xs text-red-500",children:"* Required"})]});case"date":return t.jsxs("div",{className:"space-y-2",children:[n?t.jsx(B,{value:e.label,onChange:o=>a(o.target.value),className:"font-medium border-dashed",placeholder:"Enter field label"}):t.jsx("label",{className:"text-sm font-medium",children:e.label}),t.jsx(B,{type:"date",disabled:!n,className:n?"bg-gray-50":""}),e.props?.required&&t.jsx("span",{className:"text-xs text-red-500",children:"* Required"})]});case"number":return t.jsxs("div",{className:"space-y-2",children:[n?t.jsx(B,{value:e.label,onChange:o=>a(o.target.value),className:"font-medium border-dashed",placeholder:"Enter field label"}):t.jsx("label",{className:"text-sm font-medium",children:e.label}),t.jsx(B,{type:"number",placeholder:e.props?.placeholder||"Enter number...",disabled:!n,className:n?"bg-gray-50":""}),e.props?.required&&t.jsx("span",{className:"text-xs text-red-500",children:"* Required"})]});case"scale":return t.jsxs("div",{className:"space-y-2",children:[n?t.jsx(B,{value:e.label,onChange:o=>a(o.target.value),className:"font-medium border-dashed",placeholder:"Enter scale label"}):t.jsx("label",{className:"text-sm font-medium",children:e.label}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500",children:e.props?.min||1}),t.jsx("input",{type:"range",min:e.props?.min||1,max:e.props?.max||10,disabled:!n,className:"flex-1"}),t.jsx("span",{className:"text-xs text-gray-500",children:e.props?.max||10})]}),e.props?.required&&t.jsx("span",{className:"text-xs text-red-500",children:"* Required"})]});case"ai_summary":return t.jsx(qs,{component:e,onUpdate:s,isEditing:n,allComponents:r});case"title_subtitle":return t.jsx(Bs,{component:e,onUpdate:s,isEditing:n});case"subtitle":return t.jsx(_s,{props:e.props,isSelected:n,onPropsChange:o=>s&&s({props:o})});case"line_separator":return t.jsx(Ps,{props:e.props,isSelected:n,onPropsChange:o=>s&&s({props:o})});case"evaluation_section":{const i=os.evaluationSections.find(l=>l.id===e.sectionId);return i?t.jsxs("div",{className:"space-y-4 p-4 border-2 border-blue-200 rounded-lg bg-blue-50/50",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:e.label}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ce,{variant:"outline",className:"text-xs",children:i.discipline}),e.collapsed&&t.jsx(Ce,{variant:"secondary",className:"text-xs",children:"Collapsed"})]})]}),i.description&&t.jsx("p",{className:"text-sm text-gray-600",children:i.description}),t.jsxs("div",{className:"space-y-3 mt-4",children:[i.fields.slice(0,5).map((l,u)=>t.jsx("div",{className:"pl-4 border-l-2 border-blue-200",children:t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{className:"font-medium text-gray-700",children:l.label}),l.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Type: ",l.type]})]})},u)),i.fields.length>5&&t.jsxs("p",{className:"text-xs text-gray-500 italic",children:["... and ",i.fields.length-5," more fields"]})]}),n&&t.jsx("div",{className:"mt-4 pt-4 border-t border-blue-200",children:t.jsxs("p",{className:"text-xs text-blue-700",children:["This evaluation section contains ",i.fields.length," fields. Use the Property Grid to customize individual field properties."]})})]}):t.jsx("div",{className:"p-4 border border-red-300 rounded bg-red-50",children:t.jsxs("p",{className:"text-sm text-red-600",children:["Evaluation section not found: ",e.sectionId]})})}default:return t.jsx("div",{className:"p-4 border border-dashed border-gray-300 rounded",children:t.jsxs("p",{className:"text-sm text-gray-500",children:["Unknown component type: ",e.type]})})}}function ai({formId:e,formName:s,formDescription:n,components:r,isOpen:a=!1,onClose:o}){const[i,l]=c.useState(null),[u,m]=c.useState(!1),[f,d]=c.useState(null),[p,x]=c.useState(null),[j,v]=c.useState(new Set);c.useEffect(()=>{a&&e!=="new"&&w()},[a,e]);const w=async()=>{try{const C=await fetch(`/api/form-summary?formId=${e}`),h=await C.json();C.ok&&h.summary&&(l(h.summary),x(h.updatedAt?new Date(h.updatedAt):null))}catch(C){console.error("Failed to fetch summary:",C)}},g=async()=>{if(j.size===0){d("Please select at least one form component to generate a summary");return}m(!0),d(null);try{const C=r.filter(b=>j.has(b.id)),h=await fetch("/api/form-summary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({formId:e,formData:{name:s,description:n,components:C}})}),y=await h.json();if(h.ok&&y.summary)l(y.summary),x(y.generatedAt?new Date(y.generatedAt):new Date);else throw new Error(y.error||"Failed to generate summary")}catch(C){d(C instanceof Error?C.message:"Failed to generate summary")}finally{m(!1)}},D=C=>{v(h=>{const y=new Set(h);return y.has(C)?y.delete(C):y.add(C),y})},k=()=>{v(new Set(r.map(C=>C.id)))},E=()=>{v(new Set)};return a?t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:t.jsxs(Pt,{className:"w-full max-w-2xl max-h-[80vh] overflow-hidden",children:[t.jsxs(is,{className:"pb-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ve,{className:"h-5 w-5"}),t.jsx(ls,{children:"Form Summary"})]}),t.jsx(W,{variant:"ghost",size:"sm",onClick:o,children:"✕"})]}),t.jsx(zs,{children:"AI-generated overview"})]}),t.jsxs(_t,{className:"overflow-y-auto max-h-[60vh]",children:[f&&t.jsx(Us,{variant:"destructive",className:"mb-4",children:t.jsx(Xs,{children:f})}),!i&&!u&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"text-center py-4",children:[t.jsx(Ve,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"Select form components to include in the AI summary"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between pb-2 border-b",children:[t.jsx("h4",{className:"font-medium",children:"Form Components"}),t.jsxs("div",{className:"space-x-2",children:[t.jsx(W,{variant:"ghost",size:"sm",onClick:k,children:"Select All"}),t.jsx(W,{variant:"ghost",size:"sm",onClick:E,children:"Deselect All"})]})]}),t.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:r.map(C=>t.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg hover:bg-gray-50",children:[t.jsx(Un,{id:C.id,checked:j.has(C.id),onCheckedChange:()=>D(C.id)}),t.jsxs("label",{htmlFor:C.id,className:"flex-1 cursor-pointer text-sm",children:[t.jsx("div",{className:"font-medium",children:C.label||`${C.type} field`}),t.jsxs("div",{className:"text-muted-foreground text-xs",children:["Type: ",C.type,C.props?.required&&" • Required"]})]})]},C.id))}),t.jsx("div",{className:"pt-4 flex justify-center",children:t.jsxs(W,{onClick:g,disabled:j.size===0,children:["Generate Summary (",j.size," selected)"]})})]})]}),u&&t.jsxs("div",{className:"flex items-center justify-center py-8",children:[t.jsx(Ys,{className:"h-8 w-8 animate-spin text-primary"}),t.jsx("span",{className:"ml-2",children:"Generating summary..."})]}),i&&!u&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"prose prose-sm max-w-none",children:i.split(`
`).map((C,h)=>C.startsWith("###")?t.jsx("h3",{className:"text-base font-semibold mt-4 mb-2",children:C.replace(/^###\s*/,"")},h):C.startsWith("**")&&C.endsWith("**")?t.jsx("p",{className:"font-semibold mb-2",children:C.replace(/\*\*/g,"")},h):C.startsWith("-")?t.jsx("li",{className:"ml-4 mb-1",children:C.replace(/^-\s*/,"")},h):C.trim()===""?t.jsx("br",{},h):t.jsx("p",{className:"mb-2",children:C},h))}),t.jsxs("div",{className:"mt-6 pt-4 border-t flex items-center justify-between",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:p&&t.jsxs(t.Fragment,{children:["Last updated: ",p.toLocaleString()]})}),t.jsxs(W,{variant:"outline",size:"sm",onClick:()=>{l(null),d(null)},disabled:u,children:[t.jsx(Yn,{className:"h-4 w-4 mr-2"}),"Regenerate"]})]})]})]})]})}):null}const oi=async(e,s,n)=>{const r=new URL(`${e}/api/form-templates`);n&&Object.entries(n).forEach(([o,i])=>{i!=null&&(Array.isArray(i)?i.forEach(l=>r.searchParams.append(o,l.toString())):r.searchParams.append(o,i.toString()))});const a=await fetch(r.toString(),{headers:{Authorization:`Bearer ${s}`}});if(a.ok){const o=await a.json();return{templates:o.templates,success:!0,total:o.total||o.templates.length,hasMore:o.hasMore||!1}}else return console.error("Failed to fetch form templates"),{templates:[],success:!1,total:0,hasMore:!1}},ii=async(e,s,n)=>{const r=await fetch(`${e}/api/form-templates`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(n)});return r.ok?{template:(await r.json()).template,success:!0}:(console.error("Failed to create form template"),{template:null,success:!1})},li=async(e,s,n,r)=>{const a=await fetch(`${s}/api/form-templates/${e}`,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(r)});return a.ok?{template:(await a.json()).template,success:!0}:(console.error("Failed to update form template"),{template:null,success:!1})};function ci(e,s){let n=null,r=null,a=null;const o=function(...i){r=i,a=this;const l=()=>{n=null,r&&e.apply(a,r)};n&&clearTimeout(n),n=setTimeout(l,s)};return o.cancel=()=>{n&&(clearTimeout(n),n=null),r=null,a=null},o.flush=()=>{n&&r&&(clearTimeout(n),e.apply(a,r),n=null,r=null,a=null)},o}function di({sessionId:e,formId:s,userId:n,userName:r,onSaveSuccess:a,onSaveError:o,debounceMs:i=2e3}){const[l,u]=c.useState({saving:!1,lastSaved:null,error:null}),m=c.useRef(null),f=c.useCallback(async p=>{m.current&&m.current.abort(),m.current=new AbortController,u(x=>({...x,saving:!0,error:null}));try{const x=await fetch("/api/form-sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e,formData:p,templateId:parseInt(s,10),userName:r,timestamp:new Date().toISOString()}),signal:m.current.signal});if(!x.ok){const v=await x.text();let w=`Save failed: ${x.statusText}`;try{const g=JSON.parse(v);g.error&&(w=`Save failed: ${g.error}`),g.details&&(w+=` - ${g.details}`)}catch{v&&(w=`Save failed: ${v}`)}throw new Error(w)}const j=await x.json();return u({saving:!1,lastSaved:new Date,error:null}),a?.(),j}catch(x){if(x.name==="AbortError")return;const j=x instanceof Error?x:new Error(String(x));u(v=>({...v,saving:!1,error:j})),o?.(j);try{await ui(e,{formId:s,userId:n,userName:r,data:p,lastSaved:new Date().toISOString()})}catch(v){console.error("Failed to save to IndexedDB:",v)}}},[e,s,n,r,a,o]),d=c.useRef(ci(f,i)).current;return c.useEffect(()=>()=>{m.current&&m.current.abort(),d.cancel()},[d]),c.useEffect(()=>{(async()=>{try{const x=await fetch(`/api/form-sessions?sessionId=${e}`);if(x.ok)return await x.json()}catch(x){console.error("Failed to load session:",x)}try{return await mi(e)}catch(x){console.error("Failed to load from IndexedDB:",x)}return null})()},[e]),{save:d,status:l,deleteSession:async()=>{try{await fetch(`/api/form-sessions?sessionId=${e}`,{method:"DELETE"}),await hi(e)}catch(p){console.error("Failed to delete session:",p)}}}}async function xs(){return new Promise((e,s)=>{const n=indexedDB.open("FormAutosave",1);n.onerror=()=>s(n.error),n.onsuccess=()=>e(n.result),n.onupgradeneeded=r=>{const a=r.target.result;a.objectStoreNames.contains("sessions")||a.createObjectStore("sessions",{keyPath:"sessionId"})}})}async function ui(e,s){const a=(await xs()).transaction(["sessions"],"readwrite").objectStore("sessions");return new Promise((o,i)=>{const l=a.put({sessionId:e,...s,savedAt:new Date().toISOString()});l.onsuccess=()=>o(),l.onerror=()=>i(l.error)})}async function mi(e){const r=(await xs()).transaction(["sessions"],"readonly").objectStore("sessions");return new Promise((a,o)=>{const i=r.get(e);i.onsuccess=()=>a(i.result),i.onerror=()=>o(i.error)})}async function hi(e){const r=(await xs()).transaction(["sessions"],"readwrite").objectStore("sessions");return new Promise((a,o)=>{const i=r.delete(e);i.onsuccess=()=>a(),i.onerror=()=>o(i.error)})}function fi({formId:e,userId:s,userName:n,onLockAcquired:r,onLockFailed:a,onLockReleased:o,refreshInterval:i=6e4}){const[l,u]=c.useState({isLocked:!1,lockedBy:null,lockHash:null,canTakeover:!1,loading:!0,error:null}),m=c.useRef(null),f=c.useRef(null),d=c.useCallback(async()=>{try{const v=await fetch(`/api/form-locks?formId=${e}`),w=await v.json();if(v.ok)return u(g=>({...g,isLocked:w.locked,lockedBy:w.lockedBy||null,canTakeover:w.canTakeover||!1,loading:!1,error:null})),w.locked;throw new Error(w.error||"Failed to check lock status")}catch(v){return u(w=>({...w,loading:!1,error:v instanceof Error?v:new Error("Unknown error")})),!1}},[e]),p=c.useCallback(async(v=!1)=>{u(w=>({...w,loading:!0,error:null}));try{const w=await fetch("/api/form-locks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({formId:e,userId:s,userName:n,forceTakeover:v})}),g=await w.json();if(w.ok&&g.lockHash)f.current=g.lockHash,u({isLocked:!0,lockedBy:n,lockHash:g.lockHash,canTakeover:!1,loading:!1,error:null}),r?.(),m.current&&clearInterval(m.current),m.current=setInterval(()=>{x()},i);else if(w.status===423)u({isLocked:!0,lockedBy:g.lockedBy||"Unknown user",lockHash:null,canTakeover:g.canTakeover||!1,loading:!1,error:null}),a?.(g.lockedBy||"Unknown user");else throw new Error(g.error||"Failed to acquire lock")}catch(w){u(g=>({...g,loading:!1,error:w instanceof Error?w:new Error("Unknown error")}))}},[e,s,n,r,a,i]),x=c.useCallback(async()=>{if(f.current)try{await fetch("/api/form-locks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({formId:e,userId:s,userName:n,forceTakeover:!1})})}catch(v){console.error("Failed to refresh lock:",v)}},[e,s,n]),j=c.useCallback(async()=>{if(f.current)try{(await fetch("/api/form-locks",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({formId:e,lockHash:f.current})})).ok&&(f.current=null,u({isLocked:!1,lockedBy:null,lockHash:null,canTakeover:!1,loading:!1,error:null}),o?.(),m.current&&(clearInterval(m.current),m.current=null))}catch(v){console.error("Failed to release lock:",v)}},[e,o]);return c.useEffect(()=>((async()=>{await d()||await p()})(),()=>{f.current&&j(),m.current&&clearInterval(m.current)}),[]),c.useEffect(()=>{const v=()=>{f.current&&fetch("/api/form-locks",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({formId:e,lockHash:f.current}),keepalive:!0}).catch(()=>{})};return window.addEventListener("beforeunload",v),window.addEventListener("unload",v),()=>{window.removeEventListener("beforeunload",v),window.removeEventListener("unload",v)}},[e]),{status:l,acquireLock:p,releaseLock:j,refreshLock:x,checkLockStatus:d}}const pi=In({name:Ne().min(2,"Name must be at least 2 characters"),description:Ne().optional(),category:Ne().min(1,"Category is required"),subcategory:Ne().optional(),clinical_context:Ne().min(2,"Clinical context is required"),tags:Ne().optional(),targetAudience:Bn(Ne()).optional(),estimatedCompletionTime:_n().min(1).max(180).optional(),showIplcLogo:bs(),logoPosition:Pn(["top-left","top-right","top-center"]),primaryColor:Ne().optional(),fontFamily:Ne().optional(),isPublic:bs()});function gi({id:e,component:s,index:n,isSelected:r,onRemove:a,onUpdate:o,onClick:i,allComponents:l,isEditing:u}){const{attributes:m,listeners:f,setNodeRef:d,transform:p,transition:x,isDragging:j}=qo({id:e,disabled:!u}),v={transform:Le.Transform.toString(p),transition:x,opacity:j?.5:1};return t.jsxs("div",{ref:d,style:v,className:`relative group border rounded-lg p-4 bg-white ${j?"z-50 shadow-lg":r?"border-blue-500 bg-blue-50/50":"border-gray-200"} transition-all duration-200 cursor-pointer`,onClick:i,role:"button",tabIndex:0,"aria-label":`Form component: ${s.label||s.type}`,children:[t.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(W,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-50 hover:text-red-600",onClick:w=>{w.stopPropagation(),a()},"aria-label":"Remove component",children:t.jsx(Qn,{className:"h-4 w-4"})}),t.jsx("div",{className:"drag-handle cursor-move p-2 hover:bg-gradient-metallic-primary hover:text-white rounded-md shadow-sm border border-gray-200",style:{minWidth:"40px",minHeight:"40px",display:"flex",alignItems:"center",justifyContent:"center"},...m,...f,"aria-label":"Drag to reorder",children:t.jsx(Ws,{className:"h-5 w-5"})})]})}),t.jsx("div",{className:"pr-16",children:t.jsx(Sn,{component:s,onUpdate:o,isEditing:u,allComponents:l})}),r&&s.type!=="title_subtitle"&&s.type!=="line_separator"&&s.type!=="evaluation_section"&&t.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:t.jsx(ri,{component:s,allComponents:l,onUpdate:o})})]})}function al({apiToken:e="",template:s,onSave:n,mode:r="create"}){const[a,o]=c.useState(s?.schema?.isMultiPage||!1),[i,l]=c.useState(()=>s?.schema?.pages&&s.schema.pages.length>0?s.schema.pages:[{id:"page_1",title:"Page 1",description:"",order:0,components:s?.schema?.components||[]}]),[u,m]=c.useState(i[0]?.id||"page_1"),d=i.find(N=>N.id===u)?.components||[],p=c.useCallback(N=>{l(R=>R.map(A=>A.id===u?{...A,components:N}:A))},[u]),[x,j]=c.useState(!1),[v,w]=c.useState(!1),[g,D]=c.useState(!1),[k,E]=c.useState("components"),[C,h]=c.useState(null),[y,b]=c.useState(!1),[S,T]=c.useState(null),[F,V]=c.useState(null),[se,ne]=c.useState([]),[He,Oe]=c.useState(!1),[U,et]=c.useState(""),[re,Ue]=c.useState(""),[Se,K]=c.useState([]),[pe,De]=c.useState("grid"),[ke,Z]=c.useState("updated_at"),[Ie,ye]=c.useState("desc"),ce=ma(Gt(fs,{activationConstraint:{distance:8}}),Gt(hn,{activationConstraint:{delay:250,tolerance:5}}),Gt(ms,{coordinateGetter:Uo})),O=c.useMemo(()=>s?.id?`form_${s.id}_${Date.now()}`:`form_new_${Date.now()}`,[s?.id]),Ee="1",J="User",{status:de,acquireLock:ue}=fi({formId:s?.id?.toString()||"new",userId:Ee,userName:J,onLockAcquired:()=>{console.log("Form lock acquired")},onLockFailed:N=>{console.log(`Form is locked by ${N}`)}}),{save:ge,status:me,deleteSession:pt}=di({sessionId:O,formId:s?.id?.toString()||"new",userId:Ee,userName:J,onSaveSuccess:()=>{console.log("Autosave successful")},onSaveError:N=>{console.error("Autosave failed:",N)}}),I=$n({resolver:zn(pi),defaultValues:{name:s?.name||"",description:s?.description||"",category:s?.category||"",subcategory:s?.metadata?.subcategory||"",clinical_context:s?.clinical_context||"",tags:s?.metadata?.tags?.join(", ")||"",targetAudience:s?.metadata?.targetAudience||[],estimatedCompletionTime:s?.metadata?.estimatedCompletionTime||15,showIplcLogo:s?.metadata?.showIplcLogo??!0,logoPosition:s?.metadata?.logoPosition||"top-left",primaryColor:s?.metadata?.customStyling?.primaryColor||"#007bff",fontFamily:s?.metadata?.customStyling?.fontFamily||"system",isPublic:s?.metadata?.isPublic??!1}});c.useEffect(()=>{a&&i.length>0?ge({components:[],pages:i,isMultiPage:!0,metadata:{name:I.getValues("name"),description:I.getValues("description"),category:I.getValues("category"),clinical_context:I.getValues("clinical_context"),showIplcLogo:I.getValues("showIplcLogo")}}):!a&&d.length>0&&ge({components:d,pages:[],isMultiPage:!1,metadata:{name:I.getValues("name"),description:I.getValues("description"),category:I.getValues("category"),clinical_context:I.getValues("clinical_context"),showIplcLogo:I.getValues("showIplcLogo")}})},[d,i,a,ge,I]),c.useEffect(()=>{if(typeof window>"u")return;const N=A=>{const L=A.target;L&&(L.tagName==="INPUT"||L.tagName==="TEXTAREA")&&setTimeout(()=>{L.scrollIntoView({behavior:"smooth",block:"center"})},300)},R=()=>{if(window.visualViewport){const A=window.visualViewport;document.documentElement.style.setProperty("--viewport-height",`${A.height}px`)}};return document.addEventListener("focusin",N),window.visualViewport?.addEventListener("resize",R),()=>{document.removeEventListener("focusin",N),window.visualViewport?.removeEventListener("resize",R)}},[]),c.useCallback(()=>{const N=`page_${Date.now()}`,R={id:N,title:`Page ${i.length+1}`,description:"",order:i.length,components:[]};l([...i,R]),m(N)},[i]),c.useCallback(N=>{if(i.length<=1)return;const R=i.findIndex(L=>L.id===N),A=i.filter(L=>L.id!==N);if(A.forEach((L,X)=>{L.order=X}),l(A),N===u){const L=Math.max(0,R-1);m(A[L].id)}},[i,u]);const Pe=c.useCallback((N,R)=>{const A=[...d],L=R!==void 0?R:A.length,X={...N,id:N.id||`${N.type}_${Date.now()}`,order:L};A.splice(L,0,X),A.forEach((oe,_e)=>{oe.order=_e}),p(A)},[d,p]),ae=c.useCallback(N=>{Pe(N)},[Pe]),Xe=c.useCallback(N=>{const R=d.filter((A,L)=>L!==N);R.forEach((A,L)=>{A.order=L}),p(R)},[d,p]),Ye=c.useCallback((N,R)=>{const A=[...d];A[N]={...A[N],...R},p(A)},[d,p]),gt=N=>{T(N.active.id)},xt=N=>{V(N.over?.id||null)},Ut=N=>{const{active:R,over:A}=N;if(!A){T(null),V(null);return}if(typeof R.id=="string"&&R.id.startsWith("palette-")){const L=R.data?.current;if(L){const X=d.findIndex(oe=>oe.id===A.id);Pe(L,X>=0?X:void 0)}}else if(R.id!==A.id){const L=d.findIndex(oe=>oe.id===R.id),X=d.findIndex(oe=>oe.id===A.id);if(L!==-1&&X!==-1){const oe=gs(d,L,X);oe.forEach((_e,bt)=>{_e.order=bt}),p(oe)}}T(null),V(null)},vt=c.useCallback(async()=>{Oe(!0);try{const N=new URL(window.location.href),R={search:U||void 0,category:re||void 0,tags:Se.length>0?Se:void 0,sort_by:ke,sort_order:Ie,status:"active",limit:50},A=await oi(N.origin,e,R);A.success&&ne(A.templates)}catch(N){console.error("Failed to load templates:",N)}finally{Oe(!1)}},[e,U,re,Se,ke,Ie]);c.useEffect(()=>{g&&vt()},[g,vt]);const Ae=async N=>{try{const R=new URL(window.location.href),A={name:N.name,description:N.description,category:N.category,clinical_context:N.clinical_context,schema:{components:a?[]:d,pages:a?i:[],isMultiPage:a},metadata:{...s?.metadata,showIplcLogo:N.showIplcLogo,logoPosition:N.logoPosition,primaryColor:N.primaryColor,fontFamily:N.fontFamily,isPublic:N.isPublic,subcategory:N.subcategory,tags:N.tags?.split(",").map(X=>X.trim()).filter(Boolean),targetAudience:N.targetAudience,estimatedCompletionTime:N.estimatedCompletionTime},status:s?.status||"draft",version:s?s.version+1:1,created_by:1,updated_by:1};let L;if(s&&s.id){const X=typeof s.id=="string"?parseInt(s.id,10):Number(s.id);if(!isNaN(X))L=await li(Number(X),R.origin,e,A);else throw new Error("Invalid template ID")}else L=await ii(R.origin,e,A);L.success&&L.template&&(await pt(),n&&n(L.template)),w(!1)}catch(R){console.error("Error saving form template:",R)}},we=S?d.find(N=>N.id===S):null;return t.jsx(co,{sensors:ce,collisionDetection:pa,onDragStart:gt,onDragOver:xt,onDragEnd:Ut,modifiers:[Wo,Ko],measuring:{droppable:{strategy:Ge.Always}},children:t.jsxs("div",{className:"form-builder-container flex h-screen bg-background",children:[t.jsx("div",{className:"relative flex-shrink-0 transition-all duration-300 ease-in-out",children:t.jsxs(Ln,{value:k,onValueChange:N=>E(N),className:"h-full flex flex-col",children:[t.jsxs(On,{className:"grid w-full grid-cols-3 bg-gradient-metallic-primary",children:[t.jsxs(Yt,{value:"components",className:"flex items-center gap-2",children:[t.jsx(ts,{className:"h-4 w-4"}),"Components"]}),t.jsxs(Yt,{value:"evaluation",className:"flex items-center gap-2",children:[t.jsx(rr,{className:"h-4 w-4"}),"Evaluation"]}),t.jsxs(Yt,{value:"clinical",className:"flex items-center gap-2",children:[t.jsx(ss,{className:"h-4 w-4"}),"Clinical"]})]}),t.jsx(Wt,{value:"components",className:"flex-1 mt-0 overflow-hidden",children:t.jsx(Xn,{onComponentDrag:N=>{console.log("Component drag from palette",N)},onComponentClick:ae})}),t.jsx(Wt,{value:"evaluation",className:"flex-1 mt-0 overflow-hidden",children:t.jsx(Qo,{onSectionDrag:N=>{console.log("Section drag from palette",N)},onComponentClick:ae})}),t.jsx(Wt,{value:"clinical",className:"flex-1 mt-0 overflow-hidden",children:t.jsx(ni,{onComponentDrag:N=>{console.log("Clinical component drag from palette",N)},onComponentClick:ae,selectedDiscipline:"Both"})})]})}),t.jsxs("div",{className:"flex-1 flex flex-col",children:[de.isLocked&&de.lockedBy!==J&&t.jsxs(Us,{className:"m-4 border-yellow-500 bg-yellow-50",children:[t.jsx(nr,{className:"h-4 w-4"}),t.jsxs(Xs,{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ar,{className:"h-4 w-4"}),t.jsxs("span",{children:["This form is currently being edited by ",t.jsx("strong",{children:de.lockedBy}),"."]})]}),de.canTakeover&&t.jsx(W,{variant:"outline",size:"sm",onClick:()=>ue(!0),children:"Take Over"})]})]}),t.jsx("div",{className:"border-b bg-card p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("h2",{className:"text-lg font-semibold",children:s?`Edit: ${s.name}`:"New Form Template"}),t.jsx("div",{className:"flex items-center gap-2 text-sm",children:me.saving?t.jsxs(t.Fragment,{children:[t.jsx(Ys,{className:"h-4 w-4 animate-spin text-muted-foreground"}),t.jsx("span",{className:"text-muted-foreground",children:"Saving..."})]}):me.lastSaved?t.jsxs(t.Fragment,{children:[t.jsx(Nr,{className:"h-4 w-4 text-green-600"}),t.jsxs("span",{className:"text-muted-foreground",children:["Saved ",new Date(me.lastSaved).toLocaleTimeString()]})]}):me.error?t.jsxs(t.Fragment,{children:[t.jsx(wr,{className:"h-4 w-4 text-red-600"}),t.jsx("span",{className:"text-red-600",children:"Save failed"})]}):null})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(W,{variant:"outline",size:"sm",onClick:()=>j(!x),children:[t.jsx(At,{className:"mr-2 h-4 w-4"}),x?"Edit":"Preview"]}),t.jsxs(W,{variant:"outline",size:"sm",onClick:()=>w(!0),children:[t.jsx(ir,{className:"mr-2 h-4 w-4"}),"Settings"]})]})]})}),t.jsx("div",{className:"flex-1 overflow-auto p-6",children:x?t.jsx(Jo,{components:a?void 0:d,pages:a?i:void 0,isMultiPage:a,title:I.getValues("name")||"Form Preview",description:I.getValues("description"),showIplcLogo:I.getValues("showIplcLogo")}):t.jsx("div",{className:`min-h-full bg-white rounded-lg border-2 border-dashed ${F?"border-primary bg-primary/5":"border-gray-300"} p-6 transition-colors duration-200`,children:d.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-muted-foreground",children:[t.jsx(ts,{className:"h-12 w-12 mb-4"}),t.jsx("p",{className:"text-lg font-medium",children:"Start building your form"}),t.jsx("p",{className:"text-sm",children:"Drag components from the palette or click to add"})]}):t.jsx(Oo,{items:d.map(N=>N.id),strategy:Fo,children:t.jsx("div",{className:"space-y-4",children:d.map((N,R)=>t.jsx(gi,{id:N.id,component:N,index:R,isSelected:C===R,onRemove:()=>Xe(R),onUpdate:A=>Ye(R,A),onClick:()=>h(R===C?null:R),allComponents:d,isEditing:!x},N.id))})})})})]}),t.jsx(Ao,{children:we?t.jsx("div",{className:"bg-white border-2 border-primary rounded-lg p-4 shadow-lg opacity-90",children:t.jsx(Sn,{component:we,isEditing:!1,allComponents:[]})}):null}),t.jsx(Tn,{open:v,onOpenChange:w,children:t.jsxs(Rn,{className:"max-w-2xl",children:[t.jsx(Mn,{children:t.jsx(Fn,{children:"Save Template"})}),t.jsx(qn,{...I,children:t.jsxs("form",{onSubmit:I.handleSubmit(Ae),className:"space-y-4",children:[t.jsx(yt,{control:I.control,name:"name",render:({field:N})=>t.jsxs(wt,{children:[t.jsx(jt,{children:"Template Name"}),t.jsx(Nt,{children:t.jsx(B,{placeholder:"Enter template name",...N})}),t.jsx(Ct,{})]})}),t.jsx(yt,{control:I.control,name:"description",render:({field:N})=>t.jsxs(wt,{children:[t.jsx(jt,{children:"Description"}),t.jsx(Nt,{children:t.jsx(Et,{placeholder:"Enter template description",...N})}),t.jsx(Ct,{})]})}),t.jsx(yt,{control:I.control,name:"category",render:({field:N})=>t.jsxs(wt,{children:[t.jsx(jt,{children:"Category"}),t.jsxs(Be,{onValueChange:N.onChange,defaultValue:N.value,children:[t.jsx(Nt,{children:t.jsx($e,{children:t.jsx(ze,{placeholder:"Select a category"})})}),t.jsxs(qe,{children:[t.jsx(z,{value:"assessment",children:"Assessment"}),t.jsx(z,{value:"treatment",children:"Treatment"}),t.jsx(z,{value:"progress",children:"Progress Notes"}),t.jsx(z,{value:"evaluation",children:"Evaluation"})]})]}),t.jsx(Ct,{})]})}),t.jsx(yt,{control:I.control,name:"clinical_context",render:({field:N})=>t.jsxs(wt,{children:[t.jsx(jt,{children:"Clinical Context"}),t.jsx(Nt,{children:t.jsx(B,{placeholder:"e.g., Speech Therapy, Occupational Therapy",...N})}),t.jsx(Ct,{})]})}),t.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[t.jsx(W,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancel"}),t.jsxs(W,{type:"submit",children:[t.jsx(or,{className:"mr-2 h-4 w-4"}),"Save Template"]})]})]})})]})}),t.jsx(ai,{formId:s?.id?.toString()||"new",formName:I.getValues("name")||"Untitled Form",formDescription:I.getValues("description"),components:d,isOpen:y,onClose:()=>b(!1)})]})})}export{al as FormBuilder};
//# sourceMappingURL=FormBuilder.RUAWUVKe.js.map
