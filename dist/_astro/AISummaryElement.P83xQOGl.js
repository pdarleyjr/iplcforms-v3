import{c as z,j as e}from"./index.BDwUue4i.js";import{r as f}from"./index.D4lIrffr.js";import{B as h}from"./button.BBqis-m9.js";import{C as F,a as b,b as A,d as D}from"./card.DLdw4ClT.js";import{T as L}from"./textarea.Db7GML6A.js";import{A as N,a as C}from"./alert.DYfTMRW2.js";import{B as T}from"./badge.CaCO5-Vh.js";import{D as M,b as O,c as E,d as _,e as B,f as R}from"./dialog.CKzr9dHy.js";import{C as V}from"./checkbox.BaXQiebc.js";import{L as P}from"./label.DrpxMY44.js";import{S as w}from"./sparkles.CBLYbECK.js";import{C as k,L as G}from"./loader-circle.CFEkYbsw.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],H=z("info",$);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Y=z("refresh-cw",J),U=({isOpen:t,onClose:m,allComponents:x,formData:u,preselectedFields:g=[],onConfirm:y})=>{const[a,n]=f.useState(new Set(g)),d=f.useMemo(()=>x.filter(s=>{if(s.type==="ai_summary")return!1;const r=u[s.id];return!(r==null||r===""||Array.isArray(r)&&r.length===0)}),[x,u]),p=s=>{n(r=>{const l=new Set(r);return l.has(s)?l.delete(s):l.add(s),l})},j=()=>{n(new Set(d.map(s=>s.id)))},S=()=>{n(new Set)},i=()=>{const s=Array.from(a),r={};s.forEach(l=>{r[l]=u[l]}),y(s,r)},c=s=>{const r=u[s.id];if(r==null)return"";switch(s.type){case"checkbox":return Array.isArray(r)?r.join(", "):r.toString();case"select":case"radio":return r.toString();case"date":return new Date(r).toLocaleDateString();case"number":case"scale":return r.toString();case"text_input":case"textarea":return r.length>50?`${r.substring(0,50)}...`:r;default:return typeof r=="object"?"Complex data":r.toString()}};return e.jsx(M,{open:t,onOpenChange:m,children:e.jsxs(O,{className:"max-w-2xl",children:[e.jsxs(E,{children:[e.jsx(_,{children:"Select Fields for AI Summary"}),e.jsx(B,{children:"Choose which form fields should be included in the AI-generated summary. Only fields with data are shown."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[a.size," of ",d.length," fields selected"]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:j,disabled:a.size===d.length,children:"Select All"}),e.jsx(h,{variant:"outline",size:"sm",onClick:S,disabled:a.size===0,children:"Deselect All"})]})]}),d.length===0?e.jsxs(N,{children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx(C,{children:"No fields with data available. Please fill out some form fields before generating a summary."})]}):e.jsx("div",{className:"h-[400px] rounded-md border p-4 overflow-y-auto",children:e.jsx("div",{className:"space-y-4",children:d.map(s=>{const r=a.has(s.id),l=c(s);return e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsx(V,{id:s.id,checked:r,onCheckedChange:()=>p(s.id)}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(P,{htmlFor:s.id,className:"text-sm font-medium cursor-pointer",children:s.label}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Type: ",s.type.replace(/_/g," ").replace(/\b\w/g,o=>o.toUpperCase())]}),l&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Preview: ",l]})]})]},s.id)})})})]}),e.jsxs(R,{children:[e.jsx(h,{variant:"outline",onClick:m,children:"Cancel"}),e.jsxs(h,{onClick:i,disabled:a.size===0,children:["Generate Summary (",a.size," field",a.size!==1?"s":"",")"]})]})]})})},le=({component:t,formData:m={},allComponents:x,onUpdate:u,isLiveForm:g=!1,isEditing:y=!1})=>{const[a,n]=f.useState({summary:t.props?.aiSummaryData?.content||null,generatedAt:t.props?.aiSummaryData?.generatedAt?new Date(t.props.aiSummaryData.generatedAt):null,sourceFields:t.props?.aiSummaryData?.sourceFields||[],isGenerating:!1,showFieldSelector:!1,error:null,isStale:!1});f.useEffect(()=>{a.sourceFields.length>0&&a.summary&&a.sourceFields.some(c=>{const s=t.props?.aiSummaryData?.sourceData?.[c],r=m[c];return JSON.stringify(s)!==JSON.stringify(r)})&&!a.isStale&&n(c=>({...c,isStale:!0}))},[m,a.sourceFields,a.summary,t.props?.aiSummaryData?.sourceData]);const d=async()=>{n(i=>({...i,showFieldSelector:!0}))},p=async(i,c)=>{n(s=>({...s,isGenerating:!0,showFieldSelector:!1,error:null}));try{const s=window.location.origin,r=localStorage.getItem("apiToken")||"",l=await fetch(`${s}/api/form-summary-live`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({templateId:t.id,elementId:t.id,selectedFields:i,fieldData:c,summaryConfig:t.props?.aiSummaryConfig||{}})});if(!l.ok)throw new Error("Failed to generate summary");const o=await l.json();if(o.success&&o.summary){const v={content:o.summary,generatedAt:o.generatedAt||new Date().toISOString(),sourceFields:i,sourceData:c};n(I=>({...I,summary:o.summary||null,generatedAt:new Date(v.generatedAt),sourceFields:i,isGenerating:!1,isStale:!1})),u&&u({props:{...t.props,aiSummaryData:v}})}else throw new Error(o.error||"Failed to generate summary")}catch(s){n(r=>({...r,isGenerating:!1,error:s instanceof Error?s.message:"An error occurred"}))}},j=()=>e.jsxs(F,{className:"w-full",children:[e.jsx(b,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),t.label||"AI Summary"]})}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(N,{children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx(C,{children:"This AI Summary element will allow users to generate summaries from selected form fields. Configure the settings below to customize the summary generation."})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx("p",{className:"mb-2",children:"Configuration options:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:["Auto-select fields: ",t.props?.aiSummaryConfig?.autoSelectFields?"Yes":"No"]}),e.jsxs("li",{children:["Include medical context: ",t.props?.aiSummaryConfig?.includeMedicalContext?"Yes":"No"]}),e.jsxs("li",{children:["Max length: ",t.props?.aiSummaryConfig?.maxLength||"Unlimited"]}),e.jsxs("li",{children:["Show source field labels: ",t.props?.aiSummaryConfig?.sourceFieldLabels?"Yes":"No"]})]})]})]})})]}),S=()=>e.jsxs(F,{className:"w-full",children:[e.jsx(b,{children:e.jsxs(A,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),t.label||"AI Summary"]}),a.isStale&&e.jsx(T,{variant:"outline",className:"ml-2",children:"Data Changed"})]})}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[a.error&&e.jsxs(N,{variant:"destructive",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx(C,{children:a.error})]}),a.summary?e.jsxs(e.Fragment,{children:[e.jsx(L,{value:a.summary,readOnly:!0,className:"min-h-[150px] resize-none",placeholder:"AI-generated summary will appear here..."}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Generated ",a.generatedAt?.toLocaleString()]}),e.jsx(h,{variant:"outline",size:"sm",onClick:d,disabled:a.isGenerating,children:a.isGenerating?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"mr-2 h-4 w-4 animate-spin"}),"Regenerating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Regenerate"]})})]}),a.sourceFields.length>0&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Based on ",a.sourceFields.length," field",a.sourceFields.length>1?"s":""]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Click the button below to generate an AI summary from your form responses."}),e.jsx(h,{onClick:d,disabled:a.isGenerating,children:a.isGenerating?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mr-2 h-4 w-4"}),"Generate Summary"]})})]})]})}),a.showFieldSelector&&e.jsx(U,{isOpen:a.showFieldSelector,onClose:()=>n(i=>({...i,showFieldSelector:!1})),allComponents:x,formData:m,preselectedFields:t.props?.aiSummaryConfig?.autoSelectFields?x.filter(i=>i.type!=="ai_summary"&&m[i.id]).map(i=>i.id):a.sourceFields,onConfirm:p})]});return y||!g?j():S()};export{le as A,Y as R};
//# sourceMappingURL=AISummaryElement.P83xQOGl.js.map
