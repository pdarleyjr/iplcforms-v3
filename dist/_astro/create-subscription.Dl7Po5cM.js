import{j as e}from"./index.BDwUue4i.js";import{B as o}from"./button.BBqis-m9.js";import{D as S,a as D,b as E,c as P,d as T}from"./dialog.epzmHarR.js";import{o as N,g as B,n as I,s as c,u as V,a as k,F as L,b as u,c as x,d as l,e as h,f as j}from"./schemas.8s39zcMy.js";import{I as m}from"./input.DVIqiHmA.js";import{T as O}from"./textarea.Db7GML6A.js";import{r as f}from"./index.D4lIrffr.js";import{a as R}from"./api.BiPwSYRr.js";import{P as z}from"./plus.B0ra3a6p.js";import{X as A}from"./x.D5giPUq_.js";import"./index.CWpJmkEa.js";import"./index.C_ksqHmP.js";import"./index.7Xl9-Kly.js";import"./Combination.DEQktaGu.js";import"./index.BXhwHFWz.js";import"./label.DrpxMY44.js";const H=N({name:c().min(2,"Name must be at least 2 characters"),description:c().min(10,"Description must be at least 10 characters"),price:I().min(0,"Price must be a positive number"),features:B(N({name:c().min(2,"Feature name must be at least 2 characters"),description:c().optional()}))});function ae({apiToken:w}){const[v,b]=f.useState(!1),[i,d]=f.useState([]),[t,p]=f.useState({name:"",description:""}),a=V({resolver:k(H),defaultValues:{name:"",description:"",price:0,features:[]}}),C=s=>{const r=i.filter((n,F)=>F!==s);d(r),a.setValue("features",r)},g=async()=>t.name.trim()?new Promise(s=>{d(r=>{const n=[...r,t];return a.setValue("features",n),s(n),n}),p({name:"",description:""})}):i,y=async s=>{try{let r=i;t.name.trim()&&(r=await g());const n=new URL(window.location.href);if(!(await R(n.origin,w,{...s,features:r})).success)throw new Error("Failed to create subscription");a.reset(),d([]),b(!1),window.location.reload()}catch(r){console.error("Error creating subscription:",r)}};return e.jsxs(S,{open:v,onOpenChange:b,children:[e.jsx(D,{asChild:!0,children:e.jsxs(o,{children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Create New Subscription"]})}),e.jsxs(E,{className:"sm:max-w-[600px]",children:[e.jsx(P,{children:e.jsx(T,{children:"Create New Subscription"})}),e.jsx(L,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(y),className:"space-y-4",children:[e.jsx(u,{control:a.control,name:"name",render:({field:s})=>e.jsxs(x,{children:[e.jsx(l,{children:"Name"}),e.jsx(h,{children:e.jsx(m,{placeholder:"Enter subscription name",...s})}),e.jsx(j,{})]})}),e.jsx(u,{control:a.control,name:"description",render:({field:s})=>e.jsxs(x,{children:[e.jsx(l,{children:"Description"}),e.jsx(h,{children:e.jsx(O,{placeholder:"Enter subscription description",...s})}),e.jsx(j,{})]})}),e.jsx(u,{control:a.control,name:"price",render:({field:s})=>e.jsxs(x,{children:[e.jsx(l,{children:"Price"}),e.jsx(h,{children:e.jsx(m,{type:"number",placeholder:"Enter price",...s,onChange:r=>s.onChange(Number(r.target.value))})}),e.jsx(j,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{children:"Features"}),e.jsx("div",{className:"space-y-2",children:i.map((s,r)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-md",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.name}),s.description&&e.jsx("div",{className:"text-sm text-gray-500",children:s.description})]}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>C(r),children:e.jsx(A,{className:"h-4 w-4"})})]},r))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(m,{placeholder:"Feature name",value:t.name,onChange:s=>p({...t,name:s.target.value})}),e.jsx(m,{placeholder:"Feature description (optional)",value:t.description,onChange:s=>p({...t,description:s.target.value})})]}),e.jsx(o,{type:"button",onClick:g,className:"self-start",children:"Add Feature"})]})]}),e.jsx(o,{type:"submit",className:"w-full",children:"Create Subscription"})]})})]})]})}export{ae as CreateSubscriptionButton};
//# sourceMappingURL=create-subscription.Dl7Po5cM.js.map
