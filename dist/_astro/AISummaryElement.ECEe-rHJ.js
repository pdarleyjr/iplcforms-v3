import{r as g,j as e,aE as I,av as w,C as b,L as v,aF as T}from"./react-vendor.BA2wKBqg.js";import{B as h}from"./button.ByCdt4UQ.js";import{C as A,a as D,b as k,d as G}from"./card.Dz2pXIg4.js";import{T as E}from"./textarea.DYUaUl6i.js";import{A as N,a as C}from"./alert.Cgxt91Jd.js";import{B as L}from"./badge.B5VK528j.js";import{D as O,b as B,c as V,d as P,e as R,f as _}from"./dialog.BVVCI8f5.js";import{C as J}from"./checkbox.lranVfwg.js";import{L as M}from"./label.B1wjpwVS.js";const Y=({isOpen:t,onClose:m,allComponents:x,formData:u,preselectedFields:f=[],onConfirm:j})=>{const[a,n]=g.useState(new Set(f)),c=g.useMemo(()=>x.filter(s=>{if(s.type==="ai_summary")return!1;const r=u[s.id];return!(r==null||r===""||Array.isArray(r)&&r.length===0)}),[x,u]),y=s=>{n(r=>{const l=new Set(r);return l.has(s)?l.delete(s):l.add(s),l})},p=()=>{n(new Set(c.map(s=>s.id)))},S=()=>{n(new Set)},i=()=>{const s=Array.from(a),r={};s.forEach(l=>{r[l]=u[l]}),j(s,r)},d=s=>{const r=u[s.id];if(r==null)return"";switch(s.type){case"checkbox":return Array.isArray(r)?r.join(", "):r.toString();case"select":case"radio":return r.toString();case"date":return new Date(r).toLocaleDateString();case"number":case"scale":return r.toString();case"text_input":case"textarea":return r.length>50?`${r.substring(0,50)}...`:r;default:return typeof r=="object"?"Complex data":r.toString()}};return e.jsx(O,{open:t,onOpenChange:m,children:e.jsxs(B,{className:"max-w-2xl",children:[e.jsxs(V,{children:[e.jsx(P,{children:"Select Fields for AI Summary"}),e.jsx(R,{children:"Choose which form fields should be included in the AI-generated summary. Only fields with data are shown."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[a.size," of ",c.length," fields selected"]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:p,disabled:a.size===c.length,children:"Select All"}),e.jsx(h,{variant:"outline",size:"sm",onClick:S,disabled:a.size===0,children:"Deselect All"})]})]}),c.length===0?e.jsxs(N,{children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx(C,{children:"No fields with data available. Please fill out some form fields before generating a summary."})]}):e.jsx("div",{className:"h-[400px] rounded-md border p-4 overflow-y-auto",children:e.jsx("div",{className:"space-y-4",children:c.map(s=>{const r=a.has(s.id),l=d(s);return e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsx(J,{id:s.id,checked:r,onCheckedChange:()=>y(s.id)}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(M,{htmlFor:s.id,className:"text-sm font-medium cursor-pointer",children:s.label}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Type: ",s.type.replace(/_/g," ").replace(/\b\w/g,o=>o.toUpperCase())]}),l&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Preview: ",l]})]})]},s.id)})})})]}),e.jsxs(_,{children:[e.jsx(h,{variant:"outline",onClick:m,children:"Cancel"}),e.jsxs(h,{onClick:i,disabled:a.size===0,children:["Generate Summary (",a.size," field",a.size!==1?"s":"",")"]})]})]})})},ee=({component:t,formData:m={},allComponents:x,onUpdate:u,isLiveForm:f=!1,isEditing:j=!1})=>{const[a,n]=g.useState({summary:t.props?.aiSummaryData?.content||null,generatedAt:t.props?.aiSummaryData?.generatedAt?new Date(t.props.aiSummaryData.generatedAt):null,sourceFields:t.props?.aiSummaryData?.sourceFields||[],isGenerating:!1,showFieldSelector:!1,error:null,isStale:!1});g.useEffect(()=>{a.sourceFields.length>0&&a.summary&&a.sourceFields.some(d=>{const s=t.props?.aiSummaryData?.sourceData?.[d],r=m[d];return JSON.stringify(s)!==JSON.stringify(r)})&&!a.isStale&&n(d=>({...d,isStale:!0}))},[m,a.sourceFields,a.summary,t.props?.aiSummaryData?.sourceData]);const c=async()=>{n(i=>({...i,showFieldSelector:!0}))},y=async(i,d)=>{n(s=>({...s,isGenerating:!0,showFieldSelector:!1,error:null}));try{const s=window.location.origin,r=localStorage.getItem("apiToken")||"",l=await fetch(`${s}/api/form-summary-live`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({templateId:t.id,elementId:t.id,selectedFields:i,fieldData:d,summaryConfig:t.props?.aiSummaryConfig||{}})});if(!l.ok)throw new Error("Failed to generate summary");const o=await l.json();if(o.success&&o.summary){const F={content:o.summary,generatedAt:o.generatedAt||new Date().toISOString(),sourceFields:i,sourceData:d};n(z=>({...z,summary:o.summary||null,generatedAt:new Date(F.generatedAt),sourceFields:i,isGenerating:!1,isStale:!1})),u&&u({props:{...t.props,aiSummaryData:F}})}else throw new Error(o.error||"Failed to generate summary")}catch(s){n(r=>({...r,isGenerating:!1,error:s instanceof Error?s.message:"An error occurred"}))}},p=()=>e.jsxs(A,{className:"w-full",children:[e.jsx(D,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),t.label||"AI Summary"]})}),e.jsx(G,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(N,{children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(C,{children:"This AI Summary element will allow users to generate summaries from selected form fields. Configure the settings below to customize the summary generation."})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx("p",{className:"mb-2",children:"Configuration options:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:["Auto-select fields: ",t.props?.aiSummaryConfig?.autoSelectFields?"Yes":"No"]}),e.jsxs("li",{children:["Include medical context: ",t.props?.aiSummaryConfig?.includeMedicalContext?"Yes":"No"]}),e.jsxs("li",{children:["Max length: ",t.props?.aiSummaryConfig?.maxLength||"Unlimited"]}),e.jsxs("li",{children:["Show source field labels: ",t.props?.aiSummaryConfig?.sourceFieldLabels?"Yes":"No"]})]})]})]})})]}),S=()=>e.jsxs(A,{className:"w-full",children:[e.jsx(D,{children:e.jsxs(k,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),t.label||"AI Summary"]}),a.isStale&&e.jsx(L,{variant:"outline",className:"ml-2",children:"Data Changed"})]})}),e.jsx(G,{children:e.jsxs("div",{className:"space-y-4",children:[a.error&&e.jsxs(N,{variant:"destructive",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(C,{children:a.error})]}),a.summary?e.jsxs(e.Fragment,{children:[e.jsx(E,{value:a.summary,readOnly:!0,className:"min-h-[150px] resize-none",placeholder:"AI-generated summary will appear here..."}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Generated ",a.generatedAt?.toLocaleString()]}),e.jsx(h,{variant:"outline",size:"sm",onClick:c,disabled:a.isGenerating,children:a.isGenerating?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-2 h-4 w-4 animate-spin"}),"Regenerating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Regenerate"]})})]}),a.sourceFields.length>0&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Based on ",a.sourceFields.length," field",a.sourceFields.length>1?"s":""]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Click the button below to generate an AI summary from your form responses."}),e.jsx(h,{onClick:c,disabled:a.isGenerating,children:a.isGenerating?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mr-2 h-4 w-4"}),"Generate Summary"]})})]})]})}),a.showFieldSelector&&e.jsx(Y,{isOpen:a.showFieldSelector,onClose:()=>n(i=>({...i,showFieldSelector:!1})),allComponents:x,formData:m,preselectedFields:t.props?.aiSummaryConfig?.autoSelectFields?x.filter(i=>i.type!=="ai_summary"&&m[i.id]).map(i=>i.id):a.sourceFields,onConfirm:y})]});return j||!f?p():S()};export{ee as A};
//# sourceMappingURL=AISummaryElement.ECEe-rHJ.js.map
