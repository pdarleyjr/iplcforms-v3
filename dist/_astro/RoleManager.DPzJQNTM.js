import{r,j as e,L as U,e as E,C as R,U as I}from"./react-vendor.BA2wKBqg.js";import{C as z,a as A,b as B,c as k,d as _}from"./card.Dz2pXIg4.js";import{B as C}from"./button.ByCdt4UQ.js";import{S as D,a as O,b as H,c as M,d as V}from"./select.B4Tp57UL.js";import{T as F,a as X,b as d,c as n,d as J,e as t,R as P}from"./rbac.CCQ_H62o.js";import{I as $}from"./input.CGlmA2MW.js";import{B as S}from"./badge.B5VK528j.js";import{A as q,a as G}from"./alert.Cgxt91Jd.js";import"./ui-vendor.BQCqNqg0.js";import"./index.DFUPT9Yl.js";function ne(){const[m,h]=r.useState([]),[w,u]=r.useState(!0),[x,l]=r.useState(null),[v,i]=r.useState(null),[j,g]=r.useState(!1),[f,N]=r.useState("");r.useEffect(()=>{b()},[]);const b=async()=>{try{u(!0),l(null);const s=await fetch("/api/admin/users",{headers:{"X-Customer-ID":localStorage.getItem("customerId")||""}});if(!s.ok)throw new Error("Failed to fetch users");const a=await s.json();h(a.users)}catch(s){l(s instanceof Error?s.message:"An error occurred")}finally{u(!1)}},y=async(s,a)=>{try{if(g(!0),l(null),!(await fetch(`/api/admin/users/${s}/role`,{method:"PUT",headers:{"Content-Type":"application/json","X-Customer-ID":localStorage.getItem("customerId")||""},body:JSON.stringify({role:a})})).ok)throw new Error("Failed to update user role");h(m.map(o=>o.id===s?{...o,role:a}:o)),i(null)}catch(c){l(c instanceof Error?c.message:"An error occurred")}finally{g(!1)}},p=m.filter(s=>{const a=f.toLowerCase();return s.email.toLowerCase().includes(a)||s.name.toLowerCase().includes(a)||s.role.toLowerCase().includes(a)||s.organization&&s.organization.toLowerCase().includes(a)}),L=s=>{switch(s){case"admin":return"destructive";case"clinician":return"default";case"researcher":return"secondary";case"patient":return"outline";default:return"default"}},T=s=>{switch(s){case"active":return"secondary";case"suspended":return"destructive";case"pending":return"outline";default:return"default"}};return w?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(U,{className:"h-8 w-8 animate-spin"})}):e.jsxs(z,{children:[e.jsxs(A,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"Role Management"]}),e.jsx(k,{children:"Manage user roles and permissions across the system"})]}),e.jsxs(_,{children:[x&&e.jsxs(q,{variant:"destructive",className:"mb-4",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx(G,{children:x})]}),e.jsx("div",{className:"mb-4",children:e.jsx($,{placeholder:"Search users by email, name, role, or organization...",value:f,onChange:s=>N(s.target.value),className:"max-w-md"})}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(F,{children:[e.jsx(X,{children:e.jsxs(d,{children:[e.jsx(n,{children:"User"}),e.jsx(n,{children:"Role"}),e.jsx(n,{children:"Organization"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Last Login"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(J,{children:p.length===0?e.jsx(d,{children:e.jsx(t,{colSpan:6,className:"text-center text-muted-foreground",children:"No users found"})}):p.map(s=>e.jsxs(d,{children:[e.jsx(t,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email}),s.license_number&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["License: ",s.license_number]})]})}),e.jsx(t,{children:e.jsx(S,{variant:L(s.role),children:s.role})}),e.jsx(t,{children:s.organization||"-"}),e.jsx(t,{children:e.jsx(S,{variant:T(s.status),children:s.status})}),e.jsx(t,{children:s.last_login_at?new Date(s.last_login_at).toLocaleString():"Never"}),e.jsx(t,{children:v===s.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(D,{defaultValue:s.role,onValueChange:a=>y(s.id,a),disabled:j,children:[e.jsx(O,{className:"w-32",children:e.jsx(H,{})}),e.jsx(M,{children:Object.keys(P).map(a=>e.jsx(V,{value:a,children:a},a))})]}),e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>i(null),disabled:j,children:"Cancel"})]}):e.jsxs(C,{variant:"ghost",size:"sm",onClick:()=>i(s.id),className:"flex items-center gap-1",children:[e.jsx(I,{className:"h-4 w-4"}),"Change Role"]})})]},s.id))})]})})]})]})}export{ne as RoleManager};
//# sourceMappingURL=RoleManager.DPzJQNTM.js.map
