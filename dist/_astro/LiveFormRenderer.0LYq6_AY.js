import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as S}from"./index.7-fRwNhn.js";import"./card.mQZrHzSY.js";import{I as $}from"./input.BqLLRaLk.js";import{T as W}from"./textarea.BU_xJv7O.js";import{L as P}from"./label.CzLeOBg3.js";import{B as F}from"./button.DAHL7osy.js";import{B as se}from"./badge.3Ytt3Yux.js";import{A as G,a as H}from"./alert.CwyU3Sxv.js";import{P as te,e as re,S as ae,a as ne,T as ie}from"./evaluation-sections-config.De8uYn8d.js";import{A as oe}from"./AISummaryElement.CLyj9hCW.js";import{C as le}from"./circle-check-big.CvD-zSuY.js";import{C as O}from"./loader-circle.D8v-saPC.js";import{C as ce}from"./type.D9ycDPQ5.js";import{C as me}from"./chevron-right.fiaqyhhB.js";import{C as de}from"./calendar.CIQLlK-j.js";import"./index.CuufFikk.js";import"./index.DVFN_t0d.js";import"./index.AmEYgA8_.js";import"./index.BDInZWg7.js";import"./select.BaJeBjK0.js";import"./index.ZH8sIb6j.js";import"./index.BhDqio8u.js";import"./index.D8gVcfSW.js";import"./Combination.D1D1t5_V.js";import"./index.CCOBqHex.js";import"./chevron-down.DNnEHWwL.js";import"./settings.DirRpMhW.js";import"./dialog.CJQRyvNY.js";import"./index.D1rCwynp.js";import"./x.iTm9BFym.js";import"./checkbox.rwCCBHyW.js";import"./sparkles.BRTGHZTm.js";const ze=({template:l,onSubmit:V,className:K=""})=>{const[f,I]=S.useState({}),[_,M]=S.useState(!1),[L,D]=S.useState("idle"),[T,A]=S.useState({}),g=l.schema?.isMultiPage||!1,m=S.useMemo(()=>g&&l.schema?.pages?[...typeof l.schema.pages=="string"?JSON.parse(l.schema.pages):l.schema.pages].sort((s,r)=>s.order-r.order):[],[g,l.schema]),[c,R]=S.useState(0),C=S.useMemo(()=>{let i=[];if(g&&m.length>0){const s=m[c];s&&s.components&&(i=typeof s.components=="string"?JSON.parse(s.components):s.components)}else i=Array.isArray(l.schema?.components)?l.schema.components:typeof l.schema?.components=="string"?JSON.parse(l.schema.components):[];return[...i].sort((s,r)=>s.order-r.order)},[g,m,c,l.schema]),J=i=>{const s=i.props?.visibilityCondition;if(!s)return!0;const r=f[s.field],o=s.value;switch(s.operator){case"equals":return r==o;case"not_equals":return r!=o;case"contains":return String(r||"").includes(String(o));case"greater_than":return Number(r)>Number(o);case"less_than":return Number(r)<Number(o);default:return!0}},N=C.filter(J),h=(i,s)=>{I(r=>({...r,[i]:s})),T[i]&&A(r=>{const o={...r};return delete o[i],o})},Q=(i,s)=>{const r=C.findIndex(o=>o.id===i);r!==-1&&(C[r]={...C[r],props:{...C[r].props,...s}})},U=i=>{const s={};return(i||N).forEach(o=>{const{id:t,props:p={},label:d}=o,k=p.required||!1,b=f[t];if(k&&(!b||b==="")&&(s[t]=`${d} is required`),o.type==="number"&&b!==void 0&&b!==""){const u=Number(b);isNaN(u)?s[t]=`${d} must be a valid number`:(p.min!==void 0&&u<p.min&&(s[t]=`${d} must be at least ${p.min}`),p.max!==void 0&&u>p.max&&(s[t]=`${d} must be at most ${p.max}`))}}),A(s),Object.keys(s).length===0},X=()=>{c>0&&(R(c-1),A({}))},Y=()=>{U(N)&&c<m.length-1&&R(c+1)},Z=async i=>{if(i.preventDefault(),!!U()){M(!0),D("idle");try{const s={};N.forEach(t=>{t.type==="ai_summary"&&t.props?.aiSummaryData&&(s[t.id]=t.props.aiSummaryData)});const r={};g?m.forEach(t=>{(typeof t.components=="string"?JSON.parse(t.components):t.components).forEach(d=>{J(d)&&f[d.id]!==void 0&&(r[d.id]=f[d.id])})}):N.forEach(t=>{f[t.id]!==void 0&&(r[t.id]=f[t.id])});const o={template_id:l.id,responses:{...r,...s},metadata:{submitted_at:new Date().toISOString(),form_version:l.version,ai_summaries:Object.keys(s),is_multi_page:g,total_pages:g?m.length:1}};if(V)await V(o);else if(!(await fetch("/api/form-submissions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({template_id:o.template_id,form_data:o.responses,metadata:o.metadata,status:"submitted"})})).ok)throw new Error("Failed to submit form");D("success"),I({})}catch(s){console.error("Form submission error:",s),D("error")}finally{M(!1)}}},ee=i=>{const{id:s,type:r,label:o,props:t={}}=i,p=t.required||!1,d=t.placeholder||"",k=t.description||"",b=t.options||[],u=f[s]||"",v=!!T[s],j=e.jsxs(P,{className:`text-sm font-medium ${v?"text-red-700":"text-gray-700"}`,children:[o,p&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"}),k&&e.jsx("span",{className:"text-xs text-gray-500 font-normal block mt-1",children:k})]}),y=v&&e.jsxs("span",{className:"text-xs text-red-600 flex items-center gap-1",children:[e.jsx(O,{className:"h-3 w-3"}),T[s]]});switch(r){case"text_input":return e.jsxs("div",{className:"space-y-2",children:[j,e.jsx($,{value:u,onChange:a=>h(s,a.target.value),placeholder:d,className:v?"border-red-500 focus:border-red-500":""}),y]},s);case"textarea":return e.jsxs("div",{className:"space-y-2",children:[j,e.jsx(W,{value:u,onChange:a=>h(s,a.target.value),placeholder:d,className:`min-h-[100px] ${v?"border-red-500 focus:border-red-500":""}`}),y]},s);case"select":return e.jsxs("div",{className:"space-y-2",children:[j,e.jsxs("select",{value:u,onChange:a=>h(s,a.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${v?"border-red-500 focus:ring-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:d||"Select an option..."}),b.map((a,x)=>e.jsx("option",{value:a,children:a},x))]}),y]},s);case"radio":return e.jsxs("div",{className:"space-y-3",children:[j,e.jsx("div",{className:"space-y-2",children:b.map((a,x)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",value:a,checked:u===a,onChange:n=>h(s,n.target.value),className:"h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsx(P,{className:"text-sm text-gray-700",children:a})]},x))}),y]},s);case"checkbox":const B=Array.isArray(u)?u:[];return e.jsxs("div",{className:"space-y-3",children:[j,e.jsx("div",{className:"space-y-2",children:b.map((a,x)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:B.includes(a),onChange:n=>{const w=n.target.checked?[...B,a]:B.filter(E=>E!==a);h(s,w)},className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx(P,{className:"text-sm text-gray-700",children:a})]},x))}),y]},s);case"date":return e.jsxs("div",{className:"space-y-2",children:[j,e.jsxs("div",{className:"relative",children:[e.jsx($,{type:"date",value:u,onChange:a=>h(s,a.target.value),className:v?"border-red-500 focus:border-red-500":""}),e.jsx(de,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),y]},s);case"number":return e.jsxs("div",{className:"space-y-2",children:[j,e.jsx($,{type:"number",value:u,onChange:a=>h(s,a.target.value),placeholder:d,min:t.min,max:t.max,className:v?"border-red-500 focus:border-red-500":""}),(t.min!==void 0||t.max!==void 0)&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Range: ",t.min||0," - ",t.max||"âˆž"]}),y]},s);case"scale":return e.jsxs("div",{className:"space-y-3",children:[j,e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-500",children:t.min||1}),e.jsx("span",{className:"text-sm text-gray-500",children:t.max||10})]}),e.jsx("div",{className:"flex space-x-2",children:Array.from({length:(t.max||10)-(t.min||1)+1},(a,x)=>{const n=(t.min||1)+x;return e.jsx("button",{type:"button",onClick:()=>h(s,n),className:`w-8 h-8 rounded-full border-2 text-sm flex items-center justify-center transition-colors ${u===n?"border-blue-500 bg-blue-500 text-white":"border-gray-300 bg-white text-gray-600 hover:border-blue-300"}`,children:n},n)})})]}),y]},s);case"title_subtitle":return e.jsx("div",{children:e.jsx(ie,{component:i,isEditing:!1})},s);case"subtitle":return e.jsx("div",{children:e.jsx(ne,{props:{text:t.text||o||"Subtitle",level:t.level||"h3",fontFamily:t.fontFamily||"system",fontSize:t.fontSize||"lg",fontWeight:t.fontWeight||"medium",color:t.color||"#6B7280",alignment:t.alignment||"left",marginTop:t.marginTop||8,marginBottom:t.marginBottom||12,enableMarkdown:t.enableMarkdown||!1},isSelected:!1})},s);case"line_separator":return e.jsx("div",{children:e.jsx(ae,{props:{style:t.style||"solid",thickness:t.thickness||1,color:t.color||"#E5E7EB",width:t.width||100,marginTop:t.marginTop||16,marginBottom:t.marginBottom||16},isSelected:!1})},s);case"ai_summary":return e.jsx("div",{children:e.jsx(oe,{component:i,isEditing:!1,allComponents:N,onUpdate:a=>Q(s,a)})},s);case"evaluation_section":{const x=re.evaluationSections.find(n=>n.id===i.sectionId);return x?e.jsxs("div",{className:"space-y-4 p-4 border-2 border-blue-200 rounded-lg bg-blue-50/50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:o}),e.jsx(se,{variant:"outline",className:"text-xs",children:x.discipline})]}),x.description&&e.jsx("p",{className:"text-sm text-gray-600",children:x.description}),e.jsx("div",{className:"space-y-3 mt-4",children:x.fields.map((n,w)=>{const E=`${s}_${n.id}`,z=f[E]||"";switch(n.type){case"section_header":return e.jsx("div",{className:`mt-${n.level===1?"4":"3"} mb-2`,children:e.jsx("h4",{className:`text-${n.level===1?"lg":"md"} font-semibold text-gray-800`,children:n.label})},w);case"text":return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700",children:[n.label,n.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx($,{value:z,onChange:q=>h(E,q.target.value),placeholder:`Enter ${n.label.toLowerCase()}`,className:"text-sm"})]},w);case"textarea":return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700",children:[n.label,n.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(W,{value:z,onChange:q=>h(E,q.target.value),placeholder:`Enter ${n.label.toLowerCase()}`,rows:n.rows||3,className:"text-sm"})]},w);default:return e.jsxs("div",{className:"text-sm text-gray-500",children:[n.label," (",n.type,")"]},w)}})})]},s):e.jsx("div",{className:"p-4 border border-red-300 rounded bg-red-50",children:e.jsxs("p",{className:"text-sm text-red-600",children:["Evaluation section not found: ",i.sectionId]})},s)}default:return e.jsx("div",{className:"space-y-2",children:e.jsxs(P,{className:"text-sm text-gray-500",children:["Unknown Component Type: ",r]})},s)}};return e.jsx("div",{className:`bg-white border border-gray-200 rounded-lg ${K}`,children:e.jsx("form",{onSubmit:Z,children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:l.name||"Untitled Form"}),l.description&&e.jsx("p",{className:"text-gray-600",children:l.description}),g&&m.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Page ",c+1," of ",m.length,": ",m[c]?.title||"Untitled Page"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[Math.round((c+1)/m.length*100),"% Complete"]})]}),e.jsx(te,{value:(c+1)/m.length*100,className:"h-2"}),m[c]?.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:m[c].description})]})]}),L==="success"&&e.jsxs(G,{className:"mb-6 border-green-200 bg-green-50",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx(H,{className:"text-green-800",children:"Form submitted successfully!"})]}),L==="error"&&e.jsxs(G,{className:"mb-6 border-red-200 bg-red-50",children:[e.jsx(O,{className:"h-4 w-4 text-red-600"}),e.jsx(H,{className:"text-red-800",children:"There was an error submitting the form. Please try again."})]}),N.length>0?e.jsxs("div",{className:"space-y-6",children:[N.map(ee),e.jsx("div",{className:"pt-6 border-t border-gray-200",children:e.jsx("div",{className:"flex justify-between items-center",children:g?e.jsxs(e.Fragment,{children:[e.jsxs(F,{type:"button",onClick:X,disabled:c===0,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-2",children:Array.from({length:m.length},(i,s)=>e.jsx("div",{className:`h-2 w-2 rounded-full transition-colors ${s===c?"bg-blue-600":s<c?"bg-blue-300":"bg-gray-300"}`},s))}),c===m.length-1?e.jsx(F,{type:"submit",disabled:_,className:"bg-blue-600 hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:_?"Submitting...":"Submit Form"}):e.jsxs(F,{type:"button",onClick:Y,className:"bg-blue-600 hover:bg-blue-700 flex items-center gap-2",children:["Next",e.jsx(me,{className:"h-4 w-4"})]})]}):e.jsx(F,{type:"submit",disabled:_,className:"bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:_?"Submitting...":"Submit Form"})})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx(O,{className:"h-12 w-12 mx-auto"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-500 mb-2",children:"No form fields"}),e.jsx("p",{className:"text-gray-400",children:"This form doesn't have any fields configured yet."})]})]})})})})};export{ze as LiveFormRenderer};
//# sourceMappingURL=LiveFormRenderer.0LYq6_AY.js.map
