{"version":3,"file":"create-subscription.CiVdj_cK.js","sources":["../../src/components/admin/create-subscription.tsx"],"sourcesContent":["import { Button } from \"@/components/ui/button\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport {\r\n  Form,\r\n  FormControl,\r\n  FormField,\r\n  FormItem,\r\n  FormLabel,\r\n  FormMessage,\r\n} from \"@/components/ui/form\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport { Plus, X } from \"lucide-react\";\r\nimport { useState } from \"react\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { createSubscription } from \"@/lib/api\";\r\nimport * as z from \"zod\";\r\n\r\nconst formSchema = z.object({\r\n  name: z.string().min(2, \"Name must be at least 2 characters\"),\r\n  description: z.string().min(10, \"Description must be at least 10 characters\"),\r\n  price: z.number().min(0, \"Price must be a positive number\"),\r\n  features: z.array(\r\n    z.object({\r\n      name: z.string().min(2, \"Feature name must be at least 2 characters\"),\r\n      description: z.string().optional(),\r\n    }),\r\n  ),\r\n});\r\n\r\ntype FormValues = z.infer<typeof formSchema>;\r\n\r\ntype Feature = {\r\n  name: string;\r\n  description?: string;\r\n};\r\n\r\nexport function CreateSubscriptionButton({ apiToken }: { apiToken: string }) {\r\n  const [open, setOpen] = useState(false);\r\n  const [features, setFeatures] = useState<Feature[]>([]);\r\n  const [newFeature, setNewFeature] = useState<Feature>({\r\n    name: \"\",\r\n    description: \"\",\r\n  });\r\n\r\n  const form = useForm<FormValues>({\r\n    resolver: zodResolver(formSchema),\r\n    defaultValues: {\r\n      name: \"\",\r\n      description: \"\",\r\n      price: 0,\r\n      features: [],\r\n    },\r\n  });\r\n\r\n  const removeFeature = (index: number) => {\r\n    const updatedFeatures = features.filter((_, i) => i !== index);\r\n    setFeatures(updatedFeatures);\r\n    form.setValue(\"features\", updatedFeatures);\r\n  };\r\n\r\n  const addFeature = async () => {\r\n    if (newFeature.name.trim()) {\r\n      return new Promise<Feature[]>((resolve) => {\r\n        setFeatures((prevFeatures) => {\r\n          const updatedFeatures = [...prevFeatures, newFeature];\r\n          form.setValue(\"features\", updatedFeatures);\r\n          resolve(updatedFeatures);\r\n          return updatedFeatures;\r\n        });\r\n        setNewFeature({ name: \"\", description: \"\" });\r\n      });\r\n    }\r\n    return features;\r\n  };\r\n\r\n  const onSubmit = async (data: FormValues) => {\r\n    try {\r\n      let currentFeatures = features;\r\n      if (newFeature.name.trim()) {\r\n        currentFeatures = await addFeature();\r\n      }\r\n      const url = new URL(window.location.href);\r\n      const response = await createSubscription(url.origin, apiToken, {\r\n        ...data,\r\n        features: currentFeatures, // Use the up-to-date features\r\n      });\r\n      if (!response.success) {\r\n        throw new Error(\"Failed to create subscription\");\r\n      }\r\n      form.reset();\r\n      setFeatures([]);\r\n      setOpen(false);\r\n      window.location.reload();\r\n    } catch (error) {\r\n      console.error(\"Error creating subscription:\", error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={setOpen}>\r\n      <DialogTrigger asChild>\r\n        <Button>\r\n          <Plus className=\"mr-2 h-4 w-4\" />\r\n          Create New Subscription\r\n        </Button>\r\n      </DialogTrigger>\r\n      <DialogContent className=\"sm:max-w-[600px]\">\r\n        <DialogHeader>\r\n          <DialogTitle>Create New Subscription</DialogTitle>\r\n        </DialogHeader>\r\n        <Form {...form}>\r\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\r\n            <FormField\r\n              control={form.control}\r\n              name=\"name\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>Name</FormLabel>\r\n                  <FormControl>\r\n                    <Input placeholder=\"Enter subscription name\" {...field} />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n\r\n            <FormField\r\n              control={form.control}\r\n              name=\"description\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>Description</FormLabel>\r\n                  <FormControl>\r\n                    <Textarea\r\n                      placeholder=\"Enter subscription description\"\r\n                      {...field}\r\n                    />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n\r\n            <FormField\r\n              control={form.control}\r\n              name=\"price\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>Price</FormLabel>\r\n                  <FormControl>\r\n                    <Input\r\n                      type=\"number\"\r\n                      placeholder=\"Enter price\"\r\n                      {...field}\r\n                      onChange={(e) => field.onChange(Number(e.target.value))}\r\n                    />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n\r\n            <div className=\"space-y-4\">\r\n              <FormLabel>Features</FormLabel>\r\n\r\n              <div className=\"space-y-2\">\r\n                {features.map((feature, index) => (\r\n                  <div\r\n                    key={index}\r\n                    className=\"flex items-center gap-2 p-2 border rounded-md\"\r\n                  >\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"font-medium\">{feature.name}</div>\r\n                      {feature.description && (\r\n                        <div className=\"text-sm text-gray-500\">\r\n                          {feature.description}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <Button\r\n                      type=\"button\"\r\n                      variant=\"ghost\"\r\n                      size=\"sm\"\r\n                      onClick={() => removeFeature(index)}\r\n                    >\r\n                      <X className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n\r\n              <div className=\"flex gap-2\">\r\n                <div className=\"flex-1 space-y-2\">\r\n                  <Input\r\n                    placeholder=\"Feature name\"\r\n                    value={newFeature.name}\r\n                    onChange={(e) =>\r\n                      setNewFeature({ ...newFeature, name: e.target.value })\r\n                    }\r\n                  />\r\n                  <Input\r\n                    placeholder=\"Feature description (optional)\"\r\n                    value={newFeature.description}\r\n                    onChange={(e) =>\r\n                      setNewFeature({\r\n                        ...newFeature,\r\n                        description: e.target.value,\r\n                      })\r\n                    }\r\n                  />\r\n                </div>\r\n                <Button\r\n                  type=\"button\"\r\n                  onClick={addFeature}\r\n                  className=\"self-start\"\r\n                >\r\n                  Add Feature\r\n                </Button>\r\n              </div>\r\n            </div>\r\n\r\n            <Button type=\"submit\" className=\"w-full\">\r\n              Create Subscription\r\n            </Button>\r\n          </form>\r\n        </Form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n"],"names":["formSchema","z.object","z.string","z.number","z.array","CreateSubscriptionButton","apiToken","open","setOpen","useState","features","setFeatures","newFeature","setNewFeature","form","useForm","zodResolver","removeFeature","index","updatedFeatures","_","i","addFeature","resolve","prevFeatures","onSubmit","data","currentFeatures","url","createSubscription","error","jsxs","Dialog","jsx","DialogTrigger","Button","Plus","DialogContent","DialogHeader","DialogTitle","Form","FormField","field","FormItem","FormLabel","FormControl","Input","FormMessage","Textarea","e","feature","X"],"mappings":"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"}