import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as a}from"./index.7-fRwNhn.js";import{C as k,a as U,b as E,c as I,d as R}from"./card.mQZrHzSY.js";import{B as C}from"./button.DAHL7osy.js";import{S as _,a as z,b as A,c as B,d as D}from"./select.BaJeBjK0.js";import{T as H,a as M,b as d,c as n,d as O,e as t,R as V}from"./rbac.BFDT_RO-.js";import{I as q}from"./input.BqLLRaLk.js";import{B as S}from"./badge.3Ytt3Yux.js";import{A as F,a as X}from"./alert.CwyU3Sxv.js";import{L as J,C as P}from"./loader-circle.D8v-saPC.js";import{S as $}from"./shield.BZ-jpHJL.js";import{c as G}from"./index.CuufFikk.js";import"./index.AmEYgA8_.js";import"./index.BDInZWg7.js";import"./index.ZH8sIb6j.js";import"./index.DVFN_t0d.js";import"./index.BhDqio8u.js";import"./index.D8gVcfSW.js";import"./Combination.D1D1t5_V.js";import"./index.CCOBqHex.js";import"./chevron-down.DNnEHWwL.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Q=G("user-check",K);function ge(){const[m,h]=a.useState([]),[v,u]=a.useState(!0),[x,i]=a.useState(null),[w,o]=a.useState(null),[p,j]=a.useState(!1),[f,y]=a.useState("");a.useEffect(()=>{N()},[]);const N=async()=>{try{u(!0),i(null);const s=await fetch("/api/admin/users",{headers:{"X-Customer-ID":localStorage.getItem("customerId")||""}});if(!s.ok)throw new Error("Failed to fetch users");const r=await s.json();h(r.users)}catch(s){i(s instanceof Error?s.message:"An error occurred")}finally{u(!1)}},b=async(s,r)=>{try{if(j(!0),i(null),!(await fetch(`/api/admin/users/${s}/role`,{method:"PUT",headers:{"Content-Type":"application/json","X-Customer-ID":localStorage.getItem("customerId")||""},body:JSON.stringify({role:r})})).ok)throw new Error("Failed to update user role");h(m.map(l=>l.id===s?{...l,role:r}:l)),o(null)}catch(c){i(c instanceof Error?c.message:"An error occurred")}finally{j(!1)}},g=m.filter(s=>{const r=f.toLowerCase();return s.email.toLowerCase().includes(r)||s.name.toLowerCase().includes(r)||s.role.toLowerCase().includes(r)||s.organization&&s.organization.toLowerCase().includes(r)}),L=s=>{switch(s){case"admin":return"destructive";case"clinician":return"default";case"researcher":return"secondary";case"patient":return"outline";default:return"default"}},T=s=>{switch(s){case"active":return"secondary";case"suspended":return"destructive";case"pending":return"outline";default:return"default"}};return v?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(J,{className:"h-8 w-8 animate-spin"})}):e.jsxs(k,{children:[e.jsxs(U,{children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Role Management"]}),e.jsx(I,{children:"Manage user roles and permissions across the system"})]}),e.jsxs(R,{children:[x&&e.jsxs(F,{variant:"destructive",className:"mb-4",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx(X,{children:x})]}),e.jsx("div",{className:"mb-4",children:e.jsx(q,{placeholder:"Search users by email, name, role, or organization...",value:f,onChange:s=>y(s.target.value),className:"max-w-md"})}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(H,{children:[e.jsx(M,{children:e.jsxs(d,{children:[e.jsx(n,{children:"User"}),e.jsx(n,{children:"Role"}),e.jsx(n,{children:"Organization"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Last Login"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(O,{children:g.length===0?e.jsx(d,{children:e.jsx(t,{colSpan:6,className:"text-center text-muted-foreground",children:"No users found"})}):g.map(s=>e.jsxs(d,{children:[e.jsx(t,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email}),s.license_number&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["License: ",s.license_number]})]})}),e.jsx(t,{children:e.jsx(S,{variant:L(s.role),children:s.role})}),e.jsx(t,{children:s.organization||"-"}),e.jsx(t,{children:e.jsx(S,{variant:T(s.status),children:s.status})}),e.jsx(t,{children:s.last_login_at?new Date(s.last_login_at).toLocaleString():"Never"}),e.jsx(t,{children:w===s.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(_,{defaultValue:s.role,onValueChange:r=>b(s.id,r),disabled:p,children:[e.jsx(z,{className:"w-32",children:e.jsx(A,{})}),e.jsx(B,{children:Object.keys(V).map(r=>e.jsx(D,{value:r,children:r},r))})]}),e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>o(null),disabled:p,children:"Cancel"})]}):e.jsxs(C,{variant:"ghost",size:"sm",onClick:()=>o(s.id),className:"flex items-center gap-1",children:[e.jsx(Q,{className:"h-4 w-4"}),"Change Role"]})})]},s.id))})]})})]})]})}export{ge as RoleManager};
//# sourceMappingURL=RoleManager.B7G7lQ0g.js.map
