import{r,j as s,L as N,d as R,C as T,R as O,S as I}from"./react-vendor.BA2wKBqg.js";import{C as $,a as A,b as D,c as L,d as B}from"./card.Dz2pXIg4.js";import{T as M,a as H,b as m,c as C,P as x,d as U,R as F,e as f,f as _}from"./rbac.CCQ_H62o.js";import{C as z}from"./checkbox.lranVfwg.js";import{B as X}from"./badge.B5VK528j.js";import{B as J}from"./button.ByCdt4UQ.js";import{A as q,a as G}from"./alert.Cgxt91Jd.js";import"./ui-vendor.BQCqNqg0.js";import"./index.DFUPT9Yl.js";function ts(){const[d,p]=r.useState([]),[w,h]=r.useState(!0),[j,u]=r.useState(!1),[g,c]=r.useState(null),[o,b]=r.useState(new Set);r.useEffect(()=>{S()},[]);const S=async()=>{try{h(!0),c(null);const e=await fetch("/api/admin/permissions",{headers:{"X-Customer-ID":localStorage.getItem("customerId")||""}});if(!e.ok)throw new Error("Failed to fetch permissions");const a=await e.json();p(a.permissions)}catch(e){c(e instanceof Error?e.message:"An error occurred")}finally{h(!1)}},y=(e,a,t)=>d.find(i=>i.role===e)?.permissions[a]?.includes(t)||!1,v=(e,a,t)=>{const l=d.map(i=>{if(i.role===e){const n=i.permissions[a]||[],P=n.includes(t);return{...i,permissions:{...i.permissions,[a]:P?n.filter(E=>E!==t):[...n,t]}}}return i});p(l),b(new Set([...o,`${e}-${a}-${t}`]))},k=async()=>{try{if(u(!0),c(null),!(await fetch("/api/admin/permissions",{method:"PUT",headers:{"Content-Type":"application/json","X-Customer-ID":localStorage.getItem("customerId")||""},body:JSON.stringify({permissions:d})})).ok)throw new Error("Failed to save permissions");b(new Set)}catch(e){c(e instanceof Error?e.message:"An error occurred")}finally{u(!1)}};return w?s.jsx("div",{className:"flex items-center justify-center p-8",children:s.jsx(N,{className:"h-8 w-8 animate-spin"})}):s.jsxs($,{children:[s.jsxs(A,{children:[s.jsxs(D,{className:"flex items-center gap-2",children:[s.jsx(R,{className:"h-5 w-5"}),"Permission Matrix"]}),s.jsx(L,{children:"Configure permissions for each role across different resources"})]}),s.jsxs(B,{children:[g&&s.jsxs(q,{variant:"destructive",className:"mb-4",children:[s.jsx(T,{className:"h-4 w-4"}),s.jsx(G,{children:g})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(M,{className:"min-w-[800px]",children:[s.jsx(H,{children:s.jsxs(m,{children:[s.jsx(C,{className:"sticky left-0 bg-background",children:"Resource"}),Object.keys(x).map(e=>s.jsx(C,{className:"text-center",children:s.jsx("div",{className:"flex flex-col items-center gap-1",children:s.jsx("span",{className:"text-xs font-medium uppercase",children:e})})},e))]})}),s.jsx(U,{children:Object.keys(F).map(e=>s.jsxs(O.Fragment,{children:[s.jsx(m,{className:"bg-muted/50",children:s.jsx(f,{colSpan:Object.keys(x).length+1,children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(X,{variant:e==="admin"?"destructive":"default",children:e.toUpperCase()}),s.jsxs("span",{className:"text-sm text-muted-foreground",children:[e==="admin"&&"(Has all permissions)",e==="patient"&&"(Limited to own data)"]})]})})}),Object.keys(_).map(a=>s.jsxs(m,{children:[s.jsx(f,{className:"sticky left-0 bg-background font-medium",children:a.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}),Object.keys(x).map(t=>{const l=y(e,a,t),i=o.has(`${e}-${a}-${t}`),n=e==="admin"||e==="patient"&&!["own_submissions","own_profile"].includes(a);return s.jsx(f,{className:"text-center",children:s.jsx("div",{className:"flex justify-center",children:s.jsx(z,{checked:l,disabled:n,onCheckedChange:()=>v(e,a,t),className:i?"border-blue-500":""})})},t)})]},`${e}-${a}`))]},e))})]})}),o.size>0&&s.jsx("div",{className:"mt-4 flex justify-end",children:s.jsxs(J,{onClick:k,disabled:j,className:"flex items-center gap-2",children:[j?s.jsx(N,{className:"h-4 w-4 animate-spin"}):s.jsx(I,{className:"h-4 w-4"}),"Save Changes (",o.size,")"]})})]})]})}export{ts as PermissionMatrix};
//# sourceMappingURL=PermissionMatrix.DwjOWUcf.js.map
