import{j as s}from"./jsx-runtime.D_zvdyIk.js";import{r,R}from"./index.7-fRwNhn.js";import{C as T,a as O,b as I,c as $,d as A}from"./card.mQZrHzSY.js";import{T as L,a as D,b as d,c as N,P as p,d as B,R as M,e as f,f as H}from"./rbac.BFDT_RO-.js";import{C as U}from"./checkbox.rwCCBHyW.js";import{B as F}from"./badge.3Ytt3Yux.js";import{B as _}from"./button.DAHL7osy.js";import{A as z,a as X}from"./alert.CwyU3Sxv.js";import{L as C,C as J}from"./loader-circle.D8v-saPC.js";import{L as q,S as G}from"./save.BneFxCGV.js";import"./index.CuufFikk.js";import"./index.DVFN_t0d.js";import"./index.AmEYgA8_.js";import"./index.BDInZWg7.js";import"./index.CCOBqHex.js";import"./index.D1rCwynp.js";function ms(){const[m,x]=r.useState([]),[w,h]=r.useState(!0),[j,u]=r.useState(!1),[g,c]=r.useState(null),[o,b]=r.useState(new Set);r.useEffect(()=>{S()},[]);const S=async()=>{try{h(!0),c(null);const e=await fetch("/api/admin/permissions",{headers:{"X-Customer-ID":localStorage.getItem("customerId")||""}});if(!e.ok)throw new Error("Failed to fetch permissions");const a=await e.json();x(a.permissions)}catch(e){c(e instanceof Error?e.message:"An error occurred")}finally{h(!1)}},y=(e,a,t)=>m.find(i=>i.role===e)?.permissions[a]?.includes(t)||!1,v=(e,a,t)=>{const l=m.map(i=>{if(i.role===e){const n=i.permissions[a]||[],P=n.includes(t);return{...i,permissions:{...i.permissions,[a]:P?n.filter(E=>E!==t):[...n,t]}}}return i});x(l),b(new Set([...o,`${e}-${a}-${t}`]))},k=async()=>{try{if(u(!0),c(null),!(await fetch("/api/admin/permissions",{method:"PUT",headers:{"Content-Type":"application/json","X-Customer-ID":localStorage.getItem("customerId")||""},body:JSON.stringify({permissions:m})})).ok)throw new Error("Failed to save permissions");b(new Set)}catch(e){c(e instanceof Error?e.message:"An error occurred")}finally{u(!1)}};return w?s.jsx("div",{className:"flex items-center justify-center p-8",children:s.jsx(C,{className:"h-8 w-8 animate-spin"})}):s.jsxs(T,{children:[s.jsxs(O,{children:[s.jsxs(I,{className:"flex items-center gap-2",children:[s.jsx(q,{className:"h-5 w-5"}),"Permission Matrix"]}),s.jsx($,{children:"Configure permissions for each role across different resources"})]}),s.jsxs(A,{children:[g&&s.jsxs(z,{variant:"destructive",className:"mb-4",children:[s.jsx(J,{className:"h-4 w-4"}),s.jsx(X,{children:g})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(L,{className:"min-w-[800px]",children:[s.jsx(D,{children:s.jsxs(d,{children:[s.jsx(N,{className:"sticky left-0 bg-background",children:"Resource"}),Object.keys(p).map(e=>s.jsx(N,{className:"text-center",children:s.jsx("div",{className:"flex flex-col items-center gap-1",children:s.jsx("span",{className:"text-xs font-medium uppercase",children:e})})},e))]})}),s.jsx(B,{children:Object.keys(M).map(e=>s.jsxs(R.Fragment,{children:[s.jsx(d,{className:"bg-muted/50",children:s.jsx(f,{colSpan:Object.keys(p).length+1,children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(F,{variant:e==="admin"?"destructive":"default",children:e.toUpperCase()}),s.jsxs("span",{className:"text-sm text-muted-foreground",children:[e==="admin"&&"(Has all permissions)",e==="patient"&&"(Limited to own data)"]})]})})}),Object.keys(H).map(a=>s.jsxs(d,{children:[s.jsx(f,{className:"sticky left-0 bg-background font-medium",children:a.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}),Object.keys(p).map(t=>{const l=y(e,a,t),i=o.has(`${e}-${a}-${t}`),n=e==="admin"||e==="patient"&&!["own_submissions","own_profile"].includes(a);return s.jsx(f,{className:"text-center",children:s.jsx("div",{className:"flex justify-center",children:s.jsx(U,{checked:l,disabled:n,onCheckedChange:()=>v(e,a,t),className:i?"border-blue-500":""})})},t)})]},`${e}-${a}`))]},e))})]})}),o.size>0&&s.jsx("div",{className:"mt-4 flex justify-end",children:s.jsxs(_,{onClick:k,disabled:j,className:"flex items-center gap-2",children:[j?s.jsx(C,{className:"h-4 w-4 animate-spin"}):s.jsx(G,{className:"h-4 w-4"}),"Save Changes (",o.size,")"]})})]})]})}export{ms as PermissionMatrix};
//# sourceMappingURL=PermissionMatrix.Bvm09D9P.js.map
