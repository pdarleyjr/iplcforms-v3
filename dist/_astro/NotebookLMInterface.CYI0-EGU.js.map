{"version":3,"file":"NotebookLMInterface.CYI0-EGU.js","sources":["../../src/components/ui/dropdown-menu.tsx","../../src/components/chat/NotebookLMInterface.tsx"],"sourcesContent":["import * as React from \"react\";\r\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\";\r\nimport { Check, ChevronRight, Circle } from \"lucide-react\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst DropdownMenu = DropdownMenuPrimitive.Root;\r\n\r\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger;\r\n\r\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group;\r\n\r\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal;\r\n\r\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub;\r\n\r\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup;\r\n\r\nconst DropdownMenuSubTrigger = React.forwardRef<\r\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\r\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\r\n    inset?: boolean;\r\n  }\r\n>(({ className, inset, children, ...props }, ref) => (\r\n  <DropdownMenuPrimitive.SubTrigger\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent\",\r\n      inset && \"pl-8\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  >\r\n    {children}\r\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\r\n  </DropdownMenuPrimitive.SubTrigger>\r\n));\r\nDropdownMenuSubTrigger.displayName =\r\n  DropdownMenuPrimitive.SubTrigger.displayName;\r\n\r\nconst DropdownMenuSubContent = React.forwardRef<\r\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\r\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\r\n>(({ className, ...props }, ref) => (\r\n  <DropdownMenuPrimitive.SubContent\r\n    ref={ref}\r\n    className={cn(\r\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nDropdownMenuSubContent.displayName =\r\n  DropdownMenuPrimitive.SubContent.displayName;\r\n\r\nconst DropdownMenuContent = React.forwardRef<\r\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\r\n>(({ className, sideOffset = 4, ...props }, ref) => (\r\n  <DropdownMenuPrimitive.Portal>\r\n    <DropdownMenuPrimitive.Content\r\n      ref={ref}\r\n      sideOffset={sideOffset}\r\n      className={cn(\r\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  </DropdownMenuPrimitive.Portal>\r\n));\r\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName;\r\n\r\nconst DropdownMenuItem = React.forwardRef<\r\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\r\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\r\n    inset?: boolean;\r\n  }\r\n>(({ className, inset, ...props }, ref) => (\r\n  <DropdownMenuPrimitive.Item\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\r\n      inset && \"pl-8\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName;\r\n\r\nconst DropdownMenuCheckboxItem = React.forwardRef<\r\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\r\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\r\n>(({ className, children, checked, ...props }, ref) => (\r\n  <DropdownMenuPrimitive.CheckboxItem\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\r\n      className,\r\n    )}\r\n    checked={checked}\r\n    {...props}\r\n  >\r\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\r\n      <DropdownMenuPrimitive.ItemIndicator>\r\n        <Check className=\"h-4 w-4\" />\r\n      </DropdownMenuPrimitive.ItemIndicator>\r\n    </span>\r\n    {children}\r\n  </DropdownMenuPrimitive.CheckboxItem>\r\n));\r\nDropdownMenuCheckboxItem.displayName =\r\n  DropdownMenuPrimitive.CheckboxItem.displayName;\r\n\r\nconst DropdownMenuRadioItem = React.forwardRef<\r\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\r\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\r\n>(({ className, children, ...props }, ref) => (\r\n  <DropdownMenuPrimitive.RadioItem\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  >\r\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\r\n      <DropdownMenuPrimitive.ItemIndicator>\r\n        <Circle className=\"h-2 w-2 fill-current\" />\r\n      </DropdownMenuPrimitive.ItemIndicator>\r\n    </span>\r\n    {children}\r\n  </DropdownMenuPrimitive.RadioItem>\r\n));\r\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName;\r\n\r\nconst DropdownMenuLabel = React.forwardRef<\r\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\r\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\r\n    inset?: boolean;\r\n  }\r\n>(({ className, inset, ...props }, ref) => (\r\n  <DropdownMenuPrimitive.Label\r\n    ref={ref}\r\n    className={cn(\r\n      \"px-2 py-1.5 text-sm font-semibold\",\r\n      inset && \"pl-8\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName;\r\n\r\nconst DropdownMenuSeparator = React.forwardRef<\r\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\r\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\r\n>(({ className, ...props }, ref) => (\r\n  <DropdownMenuPrimitive.Separator\r\n    ref={ref}\r\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\r\n    {...props}\r\n  />\r\n));\r\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName;\r\n\r\nconst DropdownMenuShortcut = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLSpanElement>) => {\r\n  return (\r\n    <span\r\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n};\r\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\";\r\n\r\nexport {\r\n  DropdownMenu,\r\n  DropdownMenuTrigger,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuCheckboxItem,\r\n  DropdownMenuRadioItem,\r\n  DropdownMenuLabel,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuShortcut,\r\n  DropdownMenuGroup,\r\n  DropdownMenuPortal,\r\n  DropdownMenuSub,\r\n  DropdownMenuSubContent,\r\n  DropdownMenuSubTrigger,\r\n  DropdownMenuRadioGroup,\r\n};","import React, { useState, useRef, useEffect } from 'react';\r\nimport { Button } from '../ui/button';\r\nimport { Input } from '../ui/input';\r\nimport { Card } from '../ui/card';\r\nimport { ScrollArea } from '../ui/scroll-area';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '../ui/dialog';\r\nimport { Alert, AlertDescription, AlertTitle } from '../ui/alert';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '../ui/tabs';\r\nimport {\r\n  Send,\r\n  Upload,\r\n  FileText,\r\n  Trash2,\r\n  Loader2,\r\n  MessageSquare,\r\n  Bot,\r\n  User,\r\n  Plus,\r\n  Clock,\r\n  Paperclip,\r\n  ChevronRight,\r\n  Eye,\r\n  EyeOff,\r\n  X,\r\n  Share2,\r\n  Check,\r\n  Copy,\r\n  Download,\r\n  AlertCircle,\r\n  Search,\r\n  FolderOpen,\r\n  FileImage,\r\n  FileCode,\r\n  FilePlus,\r\n  BookOpen,\r\n  Brain,\r\n  Sparkles,\r\n  SplitSquareVertical\r\n} from 'lucide-react';\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuTrigger,\r\n} from '../ui/dropdown-menu';\r\n\r\ninterface Message {\r\n  id: string;\r\n  role: 'user' | 'assistant';\r\n  content: string;\r\n  timestamp: Date;\r\n  streaming?: boolean;\r\n  citations?: Citation[];\r\n}\r\n\r\ninterface Document {\r\n  id: string;\r\n  name: string;\r\n  size: number;\r\n  type: string;\r\n  uploadedAt: Date;\r\n  chunks?: number;\r\n  enabled?: boolean;\r\n  preview?: string;\r\n}\r\n\r\ninterface Citation {\r\n  id: number;\r\n  documentName: string;\r\n  text: string;\r\n  score: number;\r\n}\r\n\r\ninterface Chunk {\r\n  id: number;\r\n  documentName: string;\r\n  text: string;\r\n  score: number;\r\n}\r\n\r\ninterface Conversation {\r\n  id: string;\r\n  title: string;\r\n  lastMessage: string;\r\n  timestamp: Date;\r\n}\r\n\r\nexport function NotebookLMInterface() {\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [documents, setDocuments] = useState<Document[]>([]);\r\n  const [conversations, setConversations] = useState<Conversation[]>([]);\r\n  const [currentConversationId, setCurrentConversationId] = useState<string | null>(null);\r\n  const [inputValue, setInputValue] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [isUploading, setIsUploading] = useState(false);\r\n  const [selectedDocument, setSelectedDocument] = useState<Document | null>(null);\r\n  const [highlightedChunk, setHighlightedChunk] = useState<Chunk | null>(null);\r\n  const [showChunkModal, setShowChunkModal] = useState(false);\r\n  const [currentChunks, setCurrentChunks] = useState<Chunk[]>([]);\r\n  const [shareModalOpen, setShareModalOpen] = useState(false);\r\n  const [shareUrl, setShareUrl] = useState('');\r\n  const [sharingMessageId, setSharingMessageId] = useState<string | null>(null);\r\n  const [copySuccess, setCopySuccess] = useState(false);\r\n  const [aiError, setAiError] = useState<string | null>(null);\r\n  const [isStreaming, setIsStreaming] = useState(false);\r\n  const [activeTab, setActiveTab] = useState('sources');\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [showDocumentPreview, setShowDocumentPreview] = useState(false);\r\n  const [documentContent, setDocumentContent] = useState<string>('');\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Auto-scroll to bottom when new messages arrive\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  };\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n\r\n  // Load conversations on mount\r\n  useEffect(() => {\r\n    loadConversations();\r\n    loadDocuments();\r\n  }, []);\r\n\r\n  // Type guards for unknown JSON payloads\r\n  function isConversationList(data: unknown): data is { conversations: Conversation[] } {\r\n    return !!data && typeof data === 'object' && Array.isArray((data as any).conversations);\r\n  }\r\n  function isDocumentsList(data: unknown): data is { documents: Document[] } {\r\n    return !!data && typeof data === 'object' && Array.isArray((data as any).documents);\r\n  }\r\n  function isConversationDetail(data: unknown): data is { messages: Message[]; documents: Document[] } {\r\n    return !!data && typeof data === 'object' && Array.isArray((data as any).messages) && Array.isArray((data as any).documents);\r\n  }\r\n  function isUploadResponse(data: unknown): data is { documents: Document[]; conversationId?: string } {\r\n    return !!data && typeof data === 'object' && Array.isArray((data as any).documents);\r\n  }\r\n\r\n  const loadConversations = async () => {\r\n    try {\r\n      const response = await fetch('/api/chat/conversations');\r\n      if (response.ok) {\r\n        const data: unknown = await response.json();\r\n        if (isConversationList(data)) {\r\n          setConversations(data.conversations);\r\n        } else {\r\n          console.warn('Unexpected conversations payload');\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load conversations:', error);\r\n    }\r\n  };\r\n\r\n  const loadDocuments = async () => {\r\n    try {\r\n      const response = await fetch('/api/chat/documents');\r\n      if (response.ok) {\r\n        const data: unknown = await response.json();\r\n        if (isDocumentsList(data)) {\r\n          setDocuments(data.documents);\r\n        } else {\r\n          console.warn('Unexpected documents payload');\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load documents:', error);\r\n    }\r\n  };\r\n\r\n  const loadConversation = async (conversationId: string) => {\r\n    try {\r\n      const response = await fetch(`/api/chat/conversations/${conversationId}`);\r\n      if (response.ok) {\r\n        const data: unknown = await response.json();\r\n        if (isConversationDetail(data)) {\r\n          setMessages(data.messages);\r\n          setDocuments(data.documents);\r\n          setCurrentConversationId(conversationId);\r\n        } else {\r\n          console.warn('Unexpected conversation detail payload');\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load conversation:', error);\r\n    }\r\n  };\r\n\r\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = event.target.files;\r\n    if (!files || files.length === 0) return;\r\n\r\n    setIsUploading(true);\r\n    const formData = new FormData();\r\n    \r\n    Array.from(files).forEach(file => {\r\n      formData.append('files', file);\r\n    });\r\n\r\n    if (currentConversationId) {\r\n      formData.append('conversationId', currentConversationId);\r\n    }\r\n\r\n    try {\r\n      const response = await fetch('/api/chat/upload', {\r\n        method: 'POST',\r\n        body: formData,\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data: unknown = await response.json();\r\n        if (isUploadResponse(data)) {\r\n          // Add documents with enabled flag set to true by default\r\n          const newDocs = data.documents.map((doc) => ({ ...doc, enabled: true }));\r\n          setDocuments(prev => [...prev, ...newDocs]);\r\n\r\n          // Create new conversation if needed\r\n          if (!currentConversationId && data.conversationId) {\r\n            setCurrentConversationId(data.conversationId);\r\n            await loadConversations();\r\n          }\r\n        } else {\r\n          console.warn('Unexpected upload response payload');\r\n        }\r\n      } else {\r\n        console.error('Upload failed:', await response.text());\r\n      }\r\n    } catch (error) {\r\n      console.error('Upload error:', error);\r\n    } finally {\r\n      setIsUploading(false);\r\n      if (fileInputRef.current) {\r\n        fileInputRef.current.value = '';\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleSendMessage = async () => {\r\n    // Prevent sending if already loading or streaming\r\n    if (!inputValue.trim() || isLoading || isStreaming) return;\r\n\r\n    // Store the message before clearing the input\r\n    const messageToSend = inputValue.trim();\r\n\r\n    const userMessage: Message = {\r\n      id: Date.now().toString(),\r\n      role: 'user',\r\n      content: messageToSend,\r\n      timestamp: new Date(),\r\n    };\r\n\r\n    setMessages(prev => [...prev, userMessage]);\r\n    setInputValue('');\r\n    setIsLoading(true);\r\n    setIsStreaming(true);\r\n    setAiError(null); // Clear any previous errors\r\n\r\n    const assistantMessage: Message = {\r\n      id: (Date.now() + 1).toString(),\r\n      role: 'assistant',\r\n      content: '',\r\n      timestamp: new Date(),\r\n      streaming: true,\r\n    };\r\n\r\n    setMessages(prev => [...prev, assistantMessage]);\r\n\r\n    try {\r\n      // Only send enabled documents\r\n      const enabledDocumentIds = documents\r\n        .filter(doc => doc.enabled !== false)\r\n        .map(doc => doc.id);\r\n\r\n      const response = await fetch('/api/chat/query', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          message: messageToSend,\r\n          conversationId: currentConversationId,\r\n          documentIds: enabledDocumentIds,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      // Handle streaming response\r\n      const reader = response.body?.getReader();\r\n      const decoder = new TextDecoder();\r\n\r\n      if (reader) {\r\n        let accumulatedContent = '';\r\n        let citations: Citation[] = [];\r\n        let buffer = '';\r\n\r\n        while (true) {\r\n          const { done, value } = await reader.read();\r\n          if (done) break;\r\n\r\n          // Decode the chunk and add to buffer\r\n          buffer += decoder.decode(value, { stream: true });\r\n          \r\n          // Split by double newline (SSE message separator)\r\n          const messages = buffer.split('\\n\\n');\r\n          \r\n          // Keep the last part in buffer (might be incomplete)\r\n          buffer = messages.pop() || '';\r\n\r\n          for (const message of messages) {\r\n            // Skip empty messages\r\n            if (!message.trim()) continue;\r\n            \r\n            // Process each line in the message\r\n            const lines = message.split('\\n');\r\n            for (const line of lines) {\r\n              if (line.startsWith('data: ')) {\r\n                const dataStr = line.slice(6).trim();\r\n                \r\n                // Skip empty data or ping messages\r\n                if (!dataStr || dataStr === '[DONE]') continue;\r\n                \r\n                try {\r\n                  const data = JSON.parse(dataStr);\r\n                  \r\n                  if (data.chunks) {\r\n                    // Store chunks for citation references\r\n                    setCurrentChunks(data.chunks);\r\n                    citations = data.chunks;\r\n                  }\r\n                  \r\n                  if (data.content) {\r\n                    accumulatedContent += data.content;\r\n                    setMessages(prev =>\r\n                      prev.map(msg =>\r\n                        msg.id === assistantMessage.id\r\n                          ? { ...msg, content: accumulatedContent, citations }\r\n                          : msg\r\n                      )\r\n                    );\r\n                  }\r\n\r\n                  if (data.conversationId && !currentConversationId) {\r\n                    setCurrentConversationId(data.conversationId);\r\n                    await loadConversations();\r\n                  }\r\n                  \r\n                  if (data.error) {\r\n                    console.error('SSE Error:', data.error);\r\n                    setMessages(prev =>\r\n                      prev.map(msg =>\r\n                        msg.id === assistantMessage.id\r\n                          ? { ...msg, content: data.error || 'An error occurred', streaming: false }\r\n                          : msg\r\n                      )\r\n                    );\r\n                    return;\r\n                  }\r\n                } catch (e) {\r\n                  console.error('Failed to parse SSE data:', e, 'Data:', dataStr);\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        // Process any remaining buffer\r\n        if (buffer.trim()) {\r\n          const lines = buffer.split('\\n');\r\n          for (const line of lines) {\r\n            if (line.startsWith('data: ')) {\r\n              const dataStr = line.slice(6).trim();\r\n              if (dataStr && dataStr !== '[DONE]') {\r\n                try {\r\n                  const data = JSON.parse(dataStr);\r\n                  if (data.content) {\r\n                    accumulatedContent += data.content;\r\n                  }\r\n                } catch (e) {\r\n                  console.error('Failed to parse final SSE data:', e);\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        // Mark streaming as complete\r\n        setMessages(prev =>\r\n          prev.map(msg =>\r\n            msg.id === assistantMessage.id\r\n              ? { ...msg, content: accumulatedContent || 'No response received', streaming: false }\r\n              : msg\r\n          )\r\n        );\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Chat error:', error);\r\n      \r\n      let errorMessage = 'Sorry, an error occurred. Please try again.';\r\n      let showErrorBanner = false;\r\n      \r\n      // Check for specific AI service errors\r\n      if (error instanceof Error) {\r\n        if (error.message.includes('workers-ai-failed') ||\r\n            error.message.includes('AI service is at capacity') ||\r\n            error.message.includes('Rate limit exceeded') ||\r\n            error.message.includes('rate limit') ||\r\n            error.message.includes('Daily quota limit reached') ||\r\n            error.message.includes('AI service access denied') ||\r\n            error.message.includes('AI service is temporarily unavailable') ||\r\n            error.message.includes('AI service is not properly configured') ||\r\n            error.message.includes('Concurrency limit') ||\r\n            error.message.includes('concurrent')) {\r\n          // Extract the user-friendly message part (before the dash)\r\n          const parts = error.message.split(' - ');\r\n          errorMessage = parts[0] || error.message;\r\n          showErrorBanner = true;\r\n          setAiError(errorMessage);\r\n        }\r\n      }\r\n      \r\n      setMessages(prev =>\r\n        prev.map(msg =>\r\n          msg.id === assistantMessage.id\r\n            ? { ...msg, content: showErrorBanner ? '' : errorMessage, streaming: false }\r\n            : msg\r\n        )\r\n      );\r\n      \r\n      // Remove empty assistant message if we're showing the banner\r\n      if (showErrorBanner) {\r\n        setMessages(prev => prev.filter(msg => msg.id !== assistantMessage.id));\r\n      }\r\n    } finally {\r\n      setIsLoading(false);\r\n      setIsStreaming(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteDocument = async (documentId: string) => {\r\n    try {\r\n      const response = await fetch(`/api/chat/documents/${documentId}`, {\r\n        method: 'DELETE',\r\n      });\r\n\r\n      if (response.ok) {\r\n        setDocuments(prev => prev.filter(doc => doc.id !== documentId));\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to delete document:', error);\r\n    }\r\n  };\r\n\r\n  const handleNewConversation = () => {\r\n    setCurrentConversationId(null);\r\n    setMessages([]);\r\n    setDocuments([]);\r\n  };\r\n\r\n  const formatFileSize = (bytes: number): string => {\r\n    if (bytes < 1024) return bytes + ' B';\r\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\r\n    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\r\n  };\r\n\r\n  const toggleDocumentEnabled = (documentId: string) => {\r\n    setDocuments(prev =>\r\n      prev.map(doc =>\r\n        doc.id === documentId\r\n          ? { ...doc, enabled: !doc.enabled }\r\n          : doc\r\n      )\r\n    );\r\n  };\r\n\r\n  const handleCitationClick = (citationNumber: number) => {\r\n    const chunk = currentChunks.find(c => c.id === citationNumber);\r\n    if (chunk) {\r\n      setHighlightedChunk(chunk);\r\n      setShowChunkModal(true);\r\n    }\r\n  };\r\n\r\n  const renderMessageWithCitations = (content: string, citations?: Citation[]) => {\r\n    if (!citations || citations.length === 0) {\r\n      return <span className=\"whitespace-pre-wrap\">{content}</span>;\r\n    }\r\n\r\n    // Parse content for citation markers ^[n]\r\n    const parts = content.split(/(\\^\\[\\d+\\])/g);\r\n    \r\n    return (\r\n      <span className=\"whitespace-pre-wrap\">\r\n        {parts.map((part, index) => {\r\n          const citationMatch = part.match(/\\^\\[(\\d+)\\]/);\r\n          if (citationMatch) {\r\n            const citationNumber = parseInt(citationMatch[1]);\r\n            return (\r\n              <button\r\n                key={index}\r\n                onClick={() => handleCitationClick(citationNumber)}\r\n                className=\"inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-primary/20 text-primary hover:bg-primary/30 transition-colors align-super ml-0.5\"\r\n                title={`View source ${citationNumber}`}\r\n              >\r\n                {citationNumber}\r\n              </button>\r\n            );\r\n          }\r\n          return <span key={index}>{part}</span>;\r\n        })}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  const handleShareMessage = async (messageId: string) => {\r\n    const messageIndex = messages.findIndex(m => m.id === messageId);\r\n    if (messageIndex === -1) return;\r\n\r\n    // Find the user message (question) for this assistant response\r\n    let questionIndex = messageIndex;\r\n    if (messages[messageIndex].role === 'assistant') {\r\n      // Look backwards for the nearest user message\r\n      for (let i = messageIndex - 1; i >= 0; i--) {\r\n        if (messages[i].role === 'user') {\r\n          questionIndex = i;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    const question = messages[questionIndex].content;\r\n    const answer = messages[messageIndex].role === 'assistant'\r\n      ? messages[messageIndex].content\r\n      : messages[messageIndex + 1]?.content || '';\r\n\r\n    setSharingMessageId(messageId);\r\n\r\n    try {\r\n      const response = await fetch('/api/chat/share', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          question,\r\n          answer,\r\n          citations: messages[messageIndex].citations || currentChunks\r\n        })\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data: unknown = await response.json();\r\n        const isShare = (v: unknown): v is { shareUrl: string } =>\r\n          !!v && typeof v === 'object' && typeof (v as any).shareUrl === 'string';\r\n        if (isShare(data)) {\r\n          setShareUrl(data.shareUrl);\r\n          setShareModalOpen(true);\r\n        } else {\r\n          console.warn('Unexpected share payload');\r\n        }\r\n      } else {\r\n        console.error('Failed to create share link');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error sharing message:', error);\r\n    } finally {\r\n      setSharingMessageId(null);\r\n    }\r\n  };\r\n\r\n  const handleCopyShareLink = async () => {\r\n    try {\r\n      await navigator.clipboard.writeText(shareUrl);\r\n      setCopySuccess(true);\r\n      setTimeout(() => setCopySuccess(false), 2000);\r\n    } catch (error) {\r\n      console.error('Failed to copy:', error);\r\n    }\r\n  };\r\n\r\n  const handleExportConversation = async (format: 'markdown' | 'json') => {\r\n    if (!currentConversationId || messages.length === 0) return;\r\n\r\n    try {\r\n      const response = await fetch('/api/chat/export', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          conversationId: currentConversationId,\r\n          format\r\n        })\r\n      });\r\n\r\n      if (response.ok) {\r\n        const blob = await response.blob();\r\n        const url = window.URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = `conversation-${currentConversationId}.${format === 'markdown' ? 'md' : 'json'}`;\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        window.URL.revokeObjectURL(url);\r\n        document.body.removeChild(a);\r\n      } else {\r\n        console.error('Failed to export conversation');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error exporting conversation:', error);\r\n    }\r\n  };\r\n\r\n  const handleDocumentClick = async (document: Document) => {\r\n    setSelectedDocument(document);\r\n    setShowDocumentPreview(true);\r\n    \r\n    // Fetch document content for preview\r\n    try {\r\n      const response = await fetch(`/api/chat/documents/${document.id}`);\r\n      if (response.ok) {\r\n        const data: unknown = await response.json();\r\n        const isDocContent = (v: unknown): v is { content?: string } =>\r\n          !!v && typeof v === 'object' && ('content' in (v as any) ? typeof (v as any).content === 'string' || typeof (v as any).content === 'undefined' : true);\r\n        if (isDocContent(data)) {\r\n          setDocumentContent((data as any).content || 'No preview available');\r\n        } else {\r\n          console.warn('Unexpected document content payload');\r\n          setDocumentContent('No preview available');\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load document content:', error);\r\n      setDocumentContent('Failed to load document content');\r\n    }\r\n  };\r\n\r\n  const getFileIcon = (fileType: string) => {\r\n    if (fileType.includes('image')) return FileImage;\r\n    if (fileType.includes('code') || fileType.includes('json')) return FileCode;\r\n    return FileText;\r\n  };\r\n\r\n  const filteredDocuments = documents.filter(doc =>\r\n    doc.name.toLowerCase().includes(searchQuery.toLowerCase())\r\n  );\r\n\r\n  return (\r\n    <div className=\"flex h-full\">\r\n      {/* Left Panel - Sources & Documents */}\r\n      <div className=\"w-96 border-r bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 flex flex-col\">\r\n        <div className=\"p-4 border-b\">\r\n          <div className=\"flex items-center gap-2 mb-4\">\r\n            <BookOpen className=\"w-5 h-5 text-primary\" />\r\n            <h2 className=\"font-semibold\">NotebookLM</h2>\r\n          </div>\r\n          \r\n          <Tabs value={activeTab} onValueChange={setActiveTab}>\r\n            <TabsList className=\"grid w-full grid-cols-3\">\r\n              <TabsTrigger value=\"sources\">Sources</TabsTrigger>\r\n              <TabsTrigger value=\"notebook\">Notebook</TabsTrigger>\r\n              <TabsTrigger value=\"history\">History</TabsTrigger>\r\n            </TabsList>\r\n\r\n            <TabsContent value=\"sources\" className=\"mt-4\">\r\n              <div className=\"space-y-3\">\r\n                <div className=\"relative\">\r\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n                  <Input\r\n                    placeholder=\"Search documents...\"\r\n                    value={searchQuery}\r\n                    onChange={(e) => setSearchQuery(e.target.value)}\r\n                    className=\"pl-9\"\r\n                  />\r\n                </div>\r\n\r\n                <Button\r\n                  className=\"w-full gradient-metallic-primary\"\r\n                  onClick={() => fileInputRef.current?.click()}\r\n                  disabled={isUploading}\r\n                >\r\n                  {isUploading ? (\r\n                    <>\r\n                      <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                      Uploading...\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <FilePlus className=\"w-4 h-4 mr-2\" />\r\n                      Add Sources\r\n                    </>\r\n                  )}\r\n                </Button>\r\n\r\n                <ScrollArea className=\"h-[calc(100vh-250px)]\">\r\n                  <div className=\"space-y-2\">\r\n                    {filteredDocuments.length === 0 ? (\r\n                      <div className=\"text-center text-muted-foreground py-8\">\r\n                        <FolderOpen className=\"w-8 h-8 mx-auto mb-3 opacity-50\" />\r\n                        <p className=\"text-sm\">No sources uploaded</p>\r\n                        <p className=\"text-xs mt-1\">Add documents to get started</p>\r\n                      </div>\r\n                    ) : (\r\n                      filteredDocuments.map((doc) => {\r\n                        const FileIcon = getFileIcon(doc.type);\r\n                        return (\r\n                          <Card\r\n                            key={doc.id}\r\n                            className={`p-3 cursor-pointer transition-all hover:shadow-md ${\r\n                              selectedDocument?.id === doc.id ? 'ring-2 ring-primary' : ''\r\n                            }`}\r\n                            onClick={() => handleDocumentClick(doc)}\r\n                          >\r\n                            <div className=\"flex items-start gap-3\">\r\n                              <FileIcon className=\"w-5 h-5 text-muted-foreground flex-shrink-0 mt-0.5\" />\r\n                              <div className=\"flex-1 min-w-0\">\r\n                                <div className=\"flex items-start justify-between gap-2\">\r\n                                  <div className=\"flex-1 min-w-0\">\r\n                                    <p className=\"font-medium text-sm truncate\">{doc.name}</p>\r\n                                    <p className=\"text-xs text-muted-foreground\">\r\n                                      {formatFileSize(doc.size)} â€¢ {doc.chunks} chunks\r\n                                    </p>\r\n                                    <p className=\"text-xs text-muted-foreground mt-1\">\r\n                                      Uploaded {new Date(doc.uploadedAt).toLocaleDateString()}\r\n                                    </p>\r\n                                  </div>\r\n                                  <div className=\"flex items-center gap-1\">\r\n                                    <Button\r\n                                      variant=\"ghost\"\r\n                                      size=\"icon\"\r\n                                      className=\"w-8 h-8\"\r\n                                      onClick={(e) => {\r\n                                        e.stopPropagation();\r\n                                        toggleDocumentEnabled(doc.id);\r\n                                      }}\r\n                                      title={doc.enabled ? 'Disable document' : 'Enable document'}\r\n                                    >\r\n                                      {doc.enabled ? (\r\n                                        <Eye className=\"w-4 h-4\" />\r\n                                      ) : (\r\n                                        <EyeOff className=\"w-4 h-4 text-muted-foreground\" />\r\n                                      )}\r\n                                    </Button>\r\n                                    <Button\r\n                                      variant=\"ghost\"\r\n                                      size=\"icon\"\r\n                                      className=\"w-8 h-8 hover:text-destructive\"\r\n                                      onClick={(e) => {\r\n                                        e.stopPropagation();\r\n                                        handleDeleteDocument(doc.id);\r\n                                      }}\r\n                                    >\r\n                                      <Trash2 className=\"w-4 h-4\" />\r\n                                    </Button>\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          </Card>\r\n                        );\r\n                      })\r\n                    )}\r\n                  </div>\r\n                </ScrollArea>\r\n              </div>\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"notebook\" className=\"mt-4\">\r\n              <div className=\"text-center text-muted-foreground py-8\">\r\n                <Brain className=\"w-8 h-8 mx-auto mb-3 opacity-50\" />\r\n                <p className=\"text-sm\">Notebook coming soon</p>\r\n                <p className=\"text-xs mt-1\">Your AI-generated notes and insights</p>\r\n              </div>\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"history\" className=\"mt-4\">\r\n              <ScrollArea className=\"h-[calc(100vh-250px)]\">\r\n                <div className=\"space-y-2\">\r\n                  {conversations.length === 0 ? (\r\n                    <div className=\"text-center text-muted-foreground py-8\">\r\n                      <MessageSquare className=\"w-8 h-8 mx-auto mb-3 opacity-50\" />\r\n                      <p className=\"text-sm\">No conversations yet</p>\r\n                    </div>\r\n                  ) : (\r\n                    conversations.map((conv) => (\r\n                      <button\r\n                        key={conv.id}\r\n                        onClick={() => loadConversation(conv.id)}\r\n                        className={`w-full text-left p-3 rounded-lg transition-all group relative ${\r\n                          conv.id === currentConversationId\r\n                            ? 'bg-gradient-to-r from-gradient-metal-start to-gradient-metal-end text-white shadow-sm'\r\n                            : 'hover:bg-muted/80'\r\n                        }`}\r\n                      >\r\n                        <p className={`font-medium text-sm truncate ${\r\n                          conv.id === currentConversationId ? 'text-white' : ''\r\n                        }`}>\r\n                          {conv.title}\r\n                        </p>\r\n                        <p className={`text-xs truncate mt-1 ${\r\n                          conv.id === currentConversationId\r\n                            ? 'text-white/80'\r\n                            : 'text-muted-foreground'\r\n                        }`}>\r\n                          {conv.lastMessage}\r\n                        </p>\r\n                        <div className={`flex items-center gap-1 mt-1 text-xs ${\r\n                          conv.id === currentConversationId\r\n                            ? 'text-white/60'\r\n                            : 'text-muted-foreground'\r\n                        }`}>\r\n                          <Clock className=\"w-3 h-3\" />\r\n                          {new Date(conv.timestamp).toLocaleDateString()}\r\n                        </div>\r\n                      </button>\r\n                    ))\r\n                  )}\r\n                </div>\r\n              </ScrollArea>\r\n            </TabsContent>\r\n          </Tabs>\r\n        </div>\r\n\r\n        <input\r\n          ref={fileInputRef}\r\n          type=\"file\"\r\n          multiple\r\n          accept=\".txt,.pdf,.doc,.docx,.md,.json,.csv\"\r\n          onChange={handleFileUpload}\r\n          className=\"hidden\"\r\n        />\r\n      </div>\r\n\r\n      {/* Main Chat Area */}\r\n      <div className=\"flex-1 flex flex-col\">\r\n        {/* Header Bar */}\r\n        <div className=\"border-b px-6 py-3 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <Sparkles className=\"w-5 h-5 text-primary\" />\r\n              <h2 className=\"font-semibold\">AI Assistant</h2>\r\n              {documents.filter(d => d.enabled).length > 0 && (\r\n                <span className=\"text-sm text-muted-foreground\">\r\n                  ({documents.filter(d => d.enabled).length} sources active)\r\n                </span>\r\n              )}\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Button\r\n                onClick={handleNewConversation}\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n              >\r\n                <Plus className=\"w-4 h-4 mr-2\" />\r\n                New Chat\r\n              </Button>\r\n              \r\n              {/* Export dropdown */}\r\n              {currentConversationId && messages.length > 0 && (\r\n                <DropdownMenu>\r\n                  <DropdownMenuTrigger asChild>\r\n                    <Button variant=\"ghost\" size=\"icon\">\r\n                      <Download className=\"w-4 h-4\" />\r\n                    </Button>\r\n                  </DropdownMenuTrigger>\r\n                  <DropdownMenuContent align=\"end\">\r\n                    <DropdownMenuItem onClick={() => handleExportConversation('markdown')}>\r\n                      <FileText className=\"w-4 h-4 mr-2\" />\r\n                      Export as Markdown\r\n                    </DropdownMenuItem>\r\n                    <DropdownMenuItem onClick={() => handleExportConversation('json')}>\r\n                      <FileText className=\"w-4 h-4 mr-2\" />\r\n                      Export as JSON\r\n                    </DropdownMenuItem>\r\n                  </DropdownMenuContent>\r\n                </DropdownMenu>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Chat Messages */}\r\n        <ScrollArea className=\"flex-1 px-6\">\r\n          <div className=\"max-w-3xl mx-auto py-6\">\r\n            {/* AI Error Banner */}\r\n            {aiError && (\r\n              <Alert variant=\"warning\" className=\"mb-4\">\r\n                <AlertCircle className=\"h-4 w-4\" />\r\n                <AlertTitle>AI Service Issue</AlertTitle>\r\n                <AlertDescription>\r\n                  {aiError}\r\n                  {(aiError.includes('quota') || aiError.toLowerCase().includes('rate limit')) && (\r\n                    <p className=\"mt-2 text-sm\">\r\n                      Free tier limits: 100k requests/day, 20 requests/minute, 2 concurrent GPU jobs. Consider upgrading for better performance.\r\n                    </p>\r\n                  )}\r\n                  {aiError.includes('capacity') && (\r\n                    <p className=\"mt-2 text-sm\">\r\n                      The AI service is experiencing high demand. Please wait a moment and try again.\r\n                    </p>\r\n                  )}\r\n                  {(aiError.toLowerCase().includes('concurrent') || aiError.includes('Concurrency limit')) && (\r\n                    <p className=\"mt-2 text-sm\">\r\n                      The free tier allows only 2 concurrent AI requests. Your request has been queued and will process when a slot becomes available.\r\n                    </p>\r\n                  )}\r\n                </AlertDescription>\r\n              </Alert>\r\n            )}\r\n            \r\n            {messages.length === 0 ? (\r\n              <div className=\"text-center py-12\">\r\n                <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-r from-gradient-metal-start to-gradient-metal-end mb-4\">\r\n                  <Bot className=\"w-8 h-8 text-white\" />\r\n                </div>\r\n                <h3 className=\"text-xl font-semibold mb-2\">How can I help you today?</h3>\r\n                <p className=\"text-muted-foreground mb-6\">\r\n                  Upload documents and ask questions to get started\r\n                </p>\r\n                <div className=\"space-y-4 max-w-md mx-auto\">\r\n                  <Card className=\"p-4 cursor-pointer hover:shadow-md transition-all\" onClick={() => setInputValue(\"Summarize the key points from my documents\")}>\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <BookOpen className=\"w-5 h-5 text-primary\" />\r\n                      <div className=\"text-left\">\r\n                        <p className=\"font-medium text-sm\">Summarize documents</p>\r\n                        <p className=\"text-xs text-muted-foreground\">Get key insights from your sources</p>\r\n                      </div>\r\n                    </div>\r\n                  </Card>\r\n                  <Card className=\"p-4 cursor-pointer hover:shadow-md transition-all\" onClick={() => setInputValue(\"Create an outline based on the main topics\")}>\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <Brain className=\"w-5 h-5 text-primary\" />\r\n                      <div className=\"text-left\">\r\n                        <p className=\"font-medium text-sm\">Generate outline</p>\r\n                        <p className=\"text-xs text-muted-foreground\">Structure your content logically</p>\r\n                      </div>\r\n                    </div>\r\n                  </Card>\r\n                  <Card className=\"p-4 cursor-pointer hover:shadow-md transition-all\" onClick={() => setInputValue(\"What are the most important findings?\")}>\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <Sparkles className=\"w-5 h-5 text-primary\" />\r\n                      <div className=\"text-left\">\r\n                        <p className=\"font-medium text-sm\">Extract insights</p>\r\n                        <p className=\"text-xs text-muted-foreground\">Discover key findings and patterns</p>\r\n                      </div>\r\n                    </div>\r\n                  </Card>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-6\">\r\n                {messages.map((message) => (\r\n                  <div\r\n                    key={message.id}\r\n                    className={`flex gap-4 ${\r\n                      message.role === 'assistant' ? '' : 'justify-end'\r\n                    }`}\r\n                  >\r\n                    {message.role === 'assistant' && (\r\n                      <>\r\n                        <div className=\"w-8 h-8 rounded-full bg-gradient-to-r from-gradient-metal-start to-gradient-metal-end flex items-center justify-center flex-shrink-0\">\r\n                          <Bot className=\"w-5 h-5 text-white\" />\r\n                        </div>\r\n                        <div\r\n                          className={`relative rounded-2xl px-4 py-3 max-w-[80%] group ${\r\n                            'assistant' === 'assistant'\r\n                              ? 'bg-muted'\r\n                              : 'bg-gradient-to-r from-gradient-metal-start to-gradient-metal-end text-white'\r\n                          }`}\r\n                        >\r\n                          <div className=\"text-sm leading-relaxed\">\r\n                            {renderMessageWithCitations(message.content, message.citations)}\r\n                          </div>\r\n                          {message.streaming && (\r\n                            <div className=\"flex items-center gap-2 mt-2\">\r\n                              <Loader2 className=\"w-3 h-3 animate-spin text-muted-foreground\" />\r\n                              <span className=\"text-xs text-muted-foreground\">AI is typing...</span>\r\n                            </div>\r\n                          )}\r\n                          \r\n                          {/* Share button for assistant messages */}\r\n                          {message.role === 'assistant' && !message.streaming && (\r\n                            <button\r\n                              onClick={() => handleShareMessage(message.id)}\r\n                              disabled={sharingMessageId === message.id}\r\n                              className={`absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity ${\r\n                                message.role === 'assistant'\r\n                                  ? 'text-muted-foreground hover:text-foreground'\r\n                                  : 'text-white/70 hover:text-white'\r\n                              }`}\r\n                              title=\"Share this Q&A\"\r\n                            >\r\n                              {sharingMessageId === message.id ? (\r\n                                <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                              ) : (\r\n                                <Share2 className=\"w-4 h-4\" />\r\n                              )}\r\n                            </button>\r\n                          )}\r\n                        </div>\r\n                      </>\r\n                    )}\r\n                    {message.role === 'user' && (\r\n                      <>\r\n                        <div\r\n                          className={`relative rounded-2xl px-4 py-3 max-w-[80%] group ${\r\n                            'assistant' === 'assistant'\r\n                              ? 'bg-muted'\r\n                              : 'bg-gradient-to-r from-gradient-metal-start to-gradient-metal-end text-white'\r\n                          }`}\r\n                        >\r\n                          <div className=\"text-sm leading-relaxed\">\r\n                            {message.content}\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"w-8 h-8 rounded-full bg-muted flex items-center justify-center flex-shrink-0\">\r\n                          <User className=\"w-5 h-5\" />\r\n                        </div>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                ))}\r\n                <div ref={messagesEndRef} />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </ScrollArea>\r\n\r\n        {/* Input Area */}\r\n        <div className=\"border-t bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\r\n          <div className=\"px-6 py-4\">\r\n            <div className=\"max-w-3xl mx-auto\">\r\n              <div className=\"flex gap-2\">\r\n                <Input\r\n                  value={inputValue}\r\n                  onChange={(e) => setInputValue(e.target.value)}\r\n                  onKeyPress={(e) => {\r\n                    if (e.key === 'Enter' && !e.shiftKey) {\r\n                      e.preventDefault();\r\n                      handleSendMessage();\r\n                    }\r\n                  }}\r\n                  placeholder={isStreaming ? \"AI is responding...\" : \"Ask a question about your documents...\"}\r\n                  disabled={isLoading || isStreaming}\r\n                  className=\"flex-1\"\r\n                />\r\n                <Button\r\n                  onClick={handleSendMessage}\r\n                  disabled={isLoading || isStreaming || !inputValue.trim()}\r\n                  className=\"gradient-metallic-primary flex-shrink-0\"\r\n                  title={isStreaming ? \"Please wait for the current response to complete\" : \"Send message\"}\r\n                >\r\n                  {isLoading || isStreaming ? (\r\n                    <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                  ) : (\r\n                    <Send className=\"w-4 h-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Document Preview Modal */}\r\n      <Dialog open={showDocumentPreview} onOpenChange={setShowDocumentPreview}>\r\n        <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-hidden flex flex-col\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-2\">\r\n              <FileText className=\"w-5 h-5\" />\r\n              {selectedDocument?.name}\r\n            </DialogTitle>\r\n          </DialogHeader>\r\n          <ScrollArea className=\"flex-1 mt-4\">\r\n            <div className=\"p-4 bg-muted rounded-lg\">\r\n              <pre className=\"whitespace-pre-wrap text-sm font-mono\">\r\n                {documentContent}\r\n              </pre>\r\n            </div>\r\n          </ScrollArea>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Citation Modal */}\r\n      <Dialog open={showChunkModal} onOpenChange={setShowChunkModal}>\r\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-hidden flex flex-col\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-2\">\r\n              <FileText className=\"w-5 h-5\" />\r\n              Source: {highlightedChunk?.documentName}\r\n            </DialogTitle>\r\n          </DialogHeader>\r\n          <ScrollArea className=\"flex-1 mt-4\">\r\n            <div className=\"space-y-3\">\r\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n                <span className=\"font-medium\">Relevance:</span>\r\n                <span>{highlightedChunk ? (highlightedChunk.score * 100).toFixed(1) : 0}%</span>\r\n              </div>\r\n              <div className=\"p-4 bg-muted rounded-lg\">\r\n                <pre className=\"whitespace-pre-wrap text-sm font-mono\">\r\n                  {highlightedChunk?.text}\r\n                </pre>\r\n              </div>\r\n            </div>\r\n          </ScrollArea>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Share Modal */}\r\n      <Dialog open={shareModalOpen} onOpenChange={setShareModalOpen}>\r\n        <DialogContent className=\"max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-2\">\r\n              <Share2 className=\"w-5 h-5\" />\r\n              Share This Conversation\r\n            </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4 mt-4\">\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              Anyone with this link can view this Q&A snippet. The link will expire in 30 days.\r\n            </p>\r\n            <div className=\"flex gap-2\">\r\n              <Input\r\n                value={shareUrl}\r\n                readOnly\r\n                className=\"font-mono text-xs\"\r\n              />\r\n              <Button\r\n                onClick={handleCopyShareLink}\r\n                variant=\"outline\"\r\n                size=\"icon\"\r\n                className=\"flex-shrink-0\"\r\n              >\r\n                {copySuccess ? (\r\n                  <Check className=\"w-4 h-4 text-green-600\" />\r\n                ) : (\r\n                  <Copy className=\"w-4 h-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n            {copySuccess && (\r\n              <p className=\"text-sm text-green-600\">Link copied to clipboard!</p>\r\n            )}\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}"],"names":["DropdownMenu","DropdownMenuPrimitive.Root","DropdownMenuTrigger","DropdownMenuPrimitive.Trigger","DropdownMenuSubTrigger","React.forwardRef","className","inset","children","props","ref","jsxs","DropdownMenuPrimitive.SubTrigger","cn","jsx","ChevronRight","DropdownMenuSubContent","DropdownMenuPrimitive.SubContent","DropdownMenuContent","sideOffset","DropdownMenuPrimitive.Portal","DropdownMenuPrimitive.Content","DropdownMenuItem","DropdownMenuPrimitive.Item","DropdownMenuCheckboxItem","checked","DropdownMenuPrimitive.CheckboxItem","DropdownMenuPrimitive.ItemIndicator","Check","DropdownMenuRadioItem","DropdownMenuPrimitive.RadioItem","Circle","DropdownMenuLabel","DropdownMenuPrimitive.Label","DropdownMenuSeparator","DropdownMenuPrimitive.Separator","NotebookLMInterface","messages","setMessages","useState","documents","setDocuments","conversations","setConversations","currentConversationId","setCurrentConversationId","inputValue","setInputValue","isLoading","setIsLoading","isUploading","setIsUploading","selectedDocument","setSelectedDocument","highlightedChunk","setHighlightedChunk","showChunkModal","setShowChunkModal","currentChunks","setCurrentChunks","shareModalOpen","setShareModalOpen","shareUrl","setShareUrl","sharingMessageId","setSharingMessageId","copySuccess","setCopySuccess","aiError","setAiError","isStreaming","setIsStreaming","activeTab","setActiveTab","searchQuery","setSearchQuery","showDocumentPreview","setShowDocumentPreview","documentContent","setDocumentContent","fileInputRef","useRef","messagesEndRef","scrollToBottom","useEffect","loadConversations","loadDocuments","isConversationList","data","isDocumentsList","isConversationDetail","isUploadResponse","response","error","loadConversation","conversationId","handleFileUpload","event","files","formData","file","newDocs","doc","prev","handleSendMessage","messageToSend","userMessage","assistantMessage","enabledDocumentIds","reader","decoder","accumulatedContent","citations","buffer","done","value","message","lines","line","dataStr","msg","e","errorMessage","showErrorBanner","handleDeleteDocument","documentId","handleNewConversation","formatFileSize","bytes","toggleDocumentEnabled","handleCitationClick","citationNumber","chunk","c","renderMessageWithCitations","content","parts","part","index","citationMatch","handleShareMessage","messageId","messageIndex","m","questionIndex","i","question","answer","v","handleCopyShareLink","handleExportConversation","format","blob","url","a","handleDocumentClick","document","getFileIcon","fileType","FileImage","FileCode","FileText","filteredDocuments","BookOpen","Tabs","TabsList","TabsTrigger","TabsContent","Search","Input","Button","Fragment","Loader2","FilePlus","ScrollArea","FolderOpen","FileIcon","Card","Eye","EyeOff","Trash2","Brain","MessageSquare","conv","Clock","Sparkles","d","Plus","Download","Alert","AlertCircle","AlertTitle","AlertDescription","Bot","Share2","User","Send","Dialog","DialogContent","DialogHeader","DialogTitle","Copy"],"mappings":"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"}