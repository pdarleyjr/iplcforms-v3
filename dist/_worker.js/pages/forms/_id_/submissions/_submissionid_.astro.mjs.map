{"version":3,"file":"_submissionid_.astro.mjs","sources":["../../../../../../src/pages/forms/[id]/submissions/[submissionId].astro"],"sourcesContent":["---\r\nexport const prerender = false;\r\n\r\nimport Layout from '@/layouts/Layout.astro';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { FormOutput } from '@/components/form-builder/FormOutput';\r\nimport { FormTemplateService } from '@/lib/services/form_template';\r\nimport { FormSubmissionService } from '@/lib/services/form_submission';\r\n\r\nconst { id, submissionId } = Astro.params;\r\n\r\nif (!id || !submissionId) {\r\n  return Astro.redirect('/forms');\r\n}\r\n\r\nconst { DB } = Astro.locals.env || {};\r\nconst formTemplateService = new FormTemplateService(DB);\r\nconst formSubmissionService = new FormSubmissionService(DB);\r\n\r\nlet template;\r\nlet submission;\r\ntry {\r\n  template = await formTemplateService.getById(parseInt(id));\r\n  if (!template) {\r\n    return Astro.redirect('/forms');\r\n  }\r\n  \r\n  submission = await formSubmissionService.getById(parseInt(submissionId));\r\n  if (!submission || submission.template_id !== parseInt(id)) {\r\n    return Astro.redirect(`/forms/${id}/analytics`);\r\n  }\r\n} catch (error) {\r\n  console.error('Error loading form submission:', error);\r\n  return Astro.redirect('/forms');\r\n}\r\n\r\n// Format dates\r\nconst formatDate = (dateString: string) => {\r\n  return new Date(dateString).toLocaleDateString('en-US', {\r\n    year: 'numeric',\r\n    month: 'long',\r\n    day: 'numeric',\r\n    hour: '2-digit',\r\n    minute: '2-digit'\r\n  });\r\n};\r\n---\r\n\r\n<Layout title={`Submission #${submission.id} - ${template.name}`}>\r\n  <div class=\"space-y-8\">\r\n    <!-- Header -->\r\n    <div class=\"flex items-center justify-between\">\r\n      <div>\r\n        <h1 class=\"text-3xl font-bold tracking-tight\">Form Submission</h1>\r\n        <p class=\"text-muted-foreground\">\r\n          Viewing submission #{submission.id} for: <span class=\"font-medium\">{template.name}</span>\r\n        </p>\r\n      </div>\r\n      <div class=\"flex gap-2\">\r\n        <Button variant=\"outline\">\r\n          Export PDF\r\n        </Button>\r\n        <Button variant=\"outline\">\r\n          Print\r\n        </Button>\r\n        <Button variant=\"outline\">\r\n          <a href={`/forms/${id}/analytics`}>‚Üê Back to Analytics</a>\r\n        </Button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Submission Information -->\r\n    <Card>\r\n      <CardHeader>\r\n        <div class=\"flex items-center justify-between\">\r\n          <div>\r\n            <CardTitle>Submission Details</CardTitle>\r\n            <CardDescription>Information about this form submission</CardDescription>\r\n          </div>\r\n          <div class=\"flex items-center gap-2\">\r\n            <Badge variant={submission.status === 'completed' ? 'default' : 'secondary'}>\r\n              {submission.status}\r\n            </Badge>\r\n            {submission.calculated_score && (\r\n              <Badge variant=\"outline\">Score: {submission.calculated_score}</Badge>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent>\r\n        <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm\">\r\n          <div>\r\n            <strong>Submitted:</strong> {formatDate(submission.submitted_at)}\r\n          </div>\r\n          <div>\r\n            <strong>Submission ID:</strong> #{submission.id}\r\n          </div>\r\n          <div>\r\n            <strong>Form Version:</strong> {template.version}\r\n          </div>\r\n        </div>\r\n        {submission.submitted_by && (\r\n          <div class=\"mt-4 text-sm\">\r\n            <strong>Submitted by:</strong> {submission.submitted_by.name} ({submission.submitted_by.email})\r\n          </div>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n\r\n    <!-- Form Submission Content -->\r\n    <Card>\r\n      <CardHeader>\r\n        <CardTitle>Submitted Form</CardTitle>\r\n        <CardDescription>\r\n          Complete form submission as submitted by the user\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent class=\"p-0\">\r\n        <FormOutput\r\n          client:only=\"react\"\r\n          template={template}\r\n          submissionData={submission.form_data}\r\n          mode=\"submission\"\r\n          className=\"border-0\"\r\n        />\r\n      </CardContent>\r\n    </Card>\r\n\r\n    <!-- Form Actions -->\r\n    <Card>\r\n      <CardHeader>\r\n        <CardTitle>Actions</CardTitle>\r\n        <CardDescription>\r\n          Available actions for this submission\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent>\r\n        <div class=\"flex flex-wrap gap-4\">\r\n          <Button variant=\"outline\">\r\n            Download PDF\r\n          </Button>\r\n          <Button variant=\"outline\">\r\n            Email Copy\r\n          </Button>\r\n          <Button variant=\"outline\">\r\n            Mark as Reviewed\r\n          </Button>\r\n          <Button variant=\"outline\">\r\n            Add Note\r\n          </Button>\r\n          {submission.status === 'draft' && (\r\n            <Button>\r\n              Mark as Complete\r\n            </Button>\r\n          )}\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  </div>\r\n\r\n  <script define:vars={{ submission, template }}>\r\n    // Make submission data available for PDF generation or other client-side operations\r\n    window.__FORM_SUBMISSION__ = submission;\r\n    window.__FORM_TEMPLATE__ = template;\r\n    \r\n    // Handle submission actions\r\n    document.addEventListener('DOMContentLoaded', () => {\r\n      // Add event handlers for various actions\r\n      const exportPdfBtn = document.querySelector('[data-action=\"export-pdf\"]');\r\n      const printBtn = document.querySelector('[data-action=\"print\"]');\r\n      \r\n      if (printBtn) {\r\n        printBtn.addEventListener('click', () => {\r\n          window.print();\r\n        });\r\n      }\r\n      \r\n      // Future: Add PDF export functionality\r\n      if (exportPdfBtn) {\r\n        exportPdfBtn.addEventListener('click', async () => {\r\n          // PDF export logic would go here\r\n          console.log('PDF export requested for submission:', submission.id);\r\n        });\r\n      }\r\n    });\r\n  </script>\r\n</Layout>"],"names":["$$createAstro","$$createComponent","Astro","$$render","$$renderComponent","Layout","$$result","$$maybeRenderHead","$$addAttribute","$$defineScriptVars"],"mappings":"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"}