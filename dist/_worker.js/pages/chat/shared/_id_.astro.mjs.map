{"version":3,"file":"_id_.astro.mjs","sources":["../../../../../src/pages/chat/shared/[id].astro"],"sourcesContent":["---\nimport Layout from '../../../layouts/Layout.astro';\nimport { Card } from '../../../components/ui/card';\nimport { Bot, User, FileText, Share2 } from 'lucide-react';\n\nconst { id } = Astro.params;\n\n// This will be fetched client-side to avoid auth issues\n---\n\n<Layout title=\"Shared Chat Snippet - IPLC Forms\">\n  <div class=\"min-h-screen bg-gradient-to-br from-background via-background to-muted/20 p-4\">\n    <div class=\"max-w-4xl mx-auto\">\n      <!-- Header -->\n      <div class=\"mb-8 text-center\">\n        <div class=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-r from-gradient-metal-start to-gradient-metal-end mb-4\">\n          <Share2 class=\"w-8 h-8 text-white\" />\n        </div>\n        <h1 class=\"text-3xl font-bold mb-2\">Shared Chat Snippet</h1>\n        <p class=\"text-muted-foreground\">This conversation was shared from IPLC Forms AI Assistant</p>\n      </div>\n      \n      <!-- Loading State -->\n      <div id=\"loading\" class=\"text-center py-12\">\n        <div class=\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n        <p class=\"text-muted-foreground mt-4\">Loading conversation...</p>\n      </div>\n      \n      <!-- Error State -->\n      <div id=\"error\" class=\"hidden\">\n        <Card class=\"p-8 text-center\">\n          <div class=\"text-destructive mb-4\">\n            <svg class=\"w-12 h-12 mx-auto\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n            </svg>\n          </div>\n          <h2 class=\"text-xl font-semibold mb-2\">Snippet Not Found</h2>\n          <p class=\"text-muted-foreground\">This snippet may have expired or the link may be invalid.</p>\n        </Card>\n      </div>\n      \n      <!-- Content -->\n      <div id=\"content\" class=\"hidden space-y-6\">\n        <!-- Question -->\n        <Card class=\"p-6\">\n          <div class=\"flex gap-4\">\n            <div class=\"w-8 h-8 rounded-full bg-muted flex items-center justify-center flex-shrink-0\">\n              <User class=\"w-5 h-5\" />\n            </div>\n            <div class=\"flex-1\">\n              <p class=\"font-medium text-sm text-muted-foreground mb-1\">Question</p>\n              <p id=\"question\" class=\"text-base\"></p>\n            </div>\n          </div>\n        </Card>\n        \n        <!-- Answer -->\n        <Card class=\"p-6\">\n          <div class=\"flex gap-4\">\n            <div class=\"w-8 h-8 rounded-full bg-gradient-to-r from-gradient-metal-start to-gradient-metal-end flex items-center justify-center flex-shrink-0\">\n              <Bot class=\"w-5 h-5 text-white\" />\n            </div>\n            <div class=\"flex-1\">\n              <p class=\"font-medium text-sm text-muted-foreground mb-1\">AI Assistant</p>\n              <div id=\"answer\" class=\"text-base prose prose-sm max-w-none\"></div>\n              \n              <!-- Citations -->\n              <div id=\"citations\" class=\"mt-4 space-y-2 hidden\">\n                <p class=\"font-medium text-sm text-muted-foreground\">Sources:</p>\n                <div id=\"citations-list\" class=\"space-y-2\"></div>\n              </div>\n            </div>\n          </div>\n        </Card>\n        \n        <!-- Metadata -->\n        <div class=\"text-center text-sm text-muted-foreground\">\n          <p>Shared on <span id=\"created-date\"></span></p>\n          <p>Expires on <span id=\"expires-date\"></span></p>\n        </div>\n      </div>\n    </div>\n  </div>\n  \n  <script>\n    const snippetId = '<%= id %>';\n    \n    async function loadSnippet() {\n      try {\n        const response = await fetch(`/api/chat/share?id=${snippetId}`);\n        const data = await response.json();\n        \n        if (!response.ok || !data.success) {\n          showError();\n          return;\n        }\n        \n        const snippet = data.snippet;\n        \n        // Hide loading, show content\n        document.getElementById('loading')?.classList.add('hidden');\n        document.getElementById('content')?.classList.remove('hidden');\n        \n        // Populate content\n        const questionEl = document.getElementById('question');\n        if (questionEl) questionEl.textContent = snippet.question;\n        \n        const answerEl = document.getElementById('answer');\n        if (answerEl) {\n          // Parse and render citations in the answer\n          answerEl.innerHTML = renderAnswerWithCitations(snippet.answer, snippet.citations);\n        }\n        \n        // Show citations if available\n        if (snippet.citations && snippet.citations.length > 0) {\n          const citationsEl = document.getElementById('citations');\n          const citationsListEl = document.getElementById('citations-list');\n          \n          if (citationsEl && citationsListEl) {\n            citationsEl.classList.remove('hidden');\n            \n            citationsListEl.innerHTML = snippet.citations.map((citation: any, index: number) => `\n              <div class=\"p-3 bg-muted rounded-lg\">\n                <div class=\"flex items-start gap-2\">\n                  <span class=\"inline-flex items-center justify-center w-6 h-6 text-xs rounded-full bg-primary/20 text-primary flex-shrink-0\">\n                    ${index + 1}\n                  </span>\n                  <div class=\"flex-1\">\n                    <p class=\"font-medium text-sm mb-1\">${citation.documentName}</p>\n                    <p class=\"text-sm text-muted-foreground\">${citation.text}</p>\n                  </div>\n                </div>\n              </div>\n            `).join('');\n          }\n        }\n        \n        // Format dates\n        const createdEl = document.getElementById('created-date');\n        const expiresEl = document.getElementById('expires-date');\n        \n        if (createdEl) createdEl.textContent = new Date(snippet.createdAt).toLocaleDateString();\n        if (expiresEl) expiresEl.textContent = new Date(snippet.expiresAt).toLocaleDateString();\n        \n      } catch (error) {\n        console.error('Error loading snippet:', error);\n        showError();\n      }\n    }\n    \n    function showError() {\n      document.getElementById('loading')?.classList.add('hidden');\n      document.getElementById('error')?.classList.remove('hidden');\n    }\n    \n    function renderAnswerWithCitations(content: string, citations: any[]) {\n      if (!citations || citations.length === 0) {\n        return content.replace(/\\n/g, '<br>');\n      }\n      \n      // Replace citation markers with styled buttons\n      let html = content.replace(/\\^\\[(\\d+)\\]/g, (match, num) => {\n        return `<sup><button onclick=\"scrollToCitation(${num})\" class=\"inline-flex items-center justify-center w-5 h-5 text-xs rounded-full bg-primary/20 text-primary hover:bg-primary/30 transition-colors ml-0.5\">${num}</button></sup>`;\n      });\n      \n      return html.replace(/\\n/g, '<br>');\n    }\n    \n    window.scrollToCitation = function(num: number) {\n      const citationsEl = document.getElementById('citations');\n      if (citationsEl) {\n        citationsEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n      }\n    };\n    \n    // Load snippet on page load\n    loadSnippet();\n  </script>\n</Layout>"],"names":["$$createAstro","$$createComponent","Astro","$$render","$$renderComponent","Layout","$$result","$$maybeRenderHead","$$renderScript"],"mappings":";;;;;;;AAAA,MAAA,UAAAA,WAAA,EAAA;AAAA,MAAA,IAAA,GAAAC,eAAA,CAAA,OAAA,QAAA,EAAA,SAAA,OAAA,KAAA;AAAA,EAAA,MAAAC,MAAAA,GAAA,QAAA,CAAA,WAAA,CAAA,OAAA,EAAA,SAAA,OAAA,CAAA;AAAA,EAAAA,OAAA,IAAA,GAAA,IAAA;AAKA,EAAA,MAAM,EAAE,EAAA,EAAG,GAAIA,MAAAA,CAAM,MAAA;AALrB,EAAA,OAAAC,cAAA,CAAA,EAAAC,gBAAA,QAAA,EAAA,QAAA,EAAAC,UAAA,EAUQ,OAAA,EAVR,kCAAA,EAAA,EAAA,EAAA,SAAA,EAAA,OAAAC,SAAAA,KAAAH,cAAA,CAAA,CAAA,EAAAI,gBAAA,CAAA,iUAAAH,eAAA,CAAAE,SAAAA,EAAA,QAAA,EAAA,MAAA,EAAA,EAgBkB,OAAA,EAAO,sBAAd,CAAA,6cAhBXF,eAAA,CAAAE,SAAAA,EAAA,QAAA,IAAA,EAAA,EA8Bc,OAAA,EA9Bd,iBAAA,EAAA,EAAA,EAAA,WAAA,OAAAA,SAAAA,KAAAH,cAAA,CAAA,6fAAA,CAAA,EAsCU,CAAA,CAAA,uFAAA,EAtCVC,gBAAAE,SAAAA,EAAA,MAAA,EAAA,IAAA,EAAA,EA4Cc,OAAA,EA5Cd,KAAA,IAAA,EAAA,SAAA,EAAA,OAAAA,SAAAA,KAAAH,cAAA,CAAA,qHAAA,EAAAC,gBAAAE,SAAAA,EAAA,MAAA,EAAA,IAAA,EAAA,EA+CoB,OAAA,EAAO,SAAA,EAAZ,CAAA,CAAA,0JAAA,CAAA,EAOL,CAAA,CAAA,iBAAA,EAtDVF,gBAAAE,SAAAA,EAAA,MAAA,EAAA,IAAA,EAAA,EAyDc,OAAA,EAzDd,KAAA,IAAA,EAAA,SAAA,EAAA,OAAAA,SAAAA,KAAAH,cAAA,CAAA,6KAAA,EAAAC,gBAAAE,SAAAA,EAAA,KAAA,EAAA,GAAA,EAAA,EA4DmB,OAAA,EAAO,oBAAA,EAAX,CAAA,CAAA,2XAAA,CAAA,EAaL,CAAA,CAAA,0MAAA,EAWPE,YAAA,CAAAF,WAAA,+GAAA,CAAA,CAAA,CAAA,CAAA,EApFH,CAAA,CAAA,CAAA;AAAA,CAAA,EAAA,+EAAA,MAAA,CAAA;;;;;;;;;;;;;;;;"}