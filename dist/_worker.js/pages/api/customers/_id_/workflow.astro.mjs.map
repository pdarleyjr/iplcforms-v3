{"version":3,"file":"workflow.astro.mjs","sources":["../../../../../../src/pages/api/customers/[id]/workflow.ts"],"sourcesContent":["import { authenticate, authorize } from \"@/lib/middleware/rbac-middleware\";\r\nimport { withPerformanceMonitoring } from \"@/lib/utils/performance-wrapper\";\r\nimport { PERMISSIONS } from \"@/lib/utils/rbac\";\r\nimport type { APIContext, APIRoute } from \"astro\";\r\n\r\ntype Params = {\r\n  id: string;\r\n};\r\n\r\nconst postHandler: APIRoute = async (context: APIContext) => {\r\n  const { CUSTOMER_WORKFLOW } = (context.locals as any).runtime.env;\r\n  \r\n  // Authenticate request\r\n  const authResult = await authenticate(context);\r\n  if (authResult instanceof Response) return authResult;\r\n\r\n  // Authorize request - workflow creation requires MANAGE permission\r\n  const authzMiddleware = authorize(PERMISSIONS.MANAGE, 'workflows');\r\n  const authzResult = await authzMiddleware(authResult);\r\n  if (authzResult instanceof Response) return authzResult;\r\n\r\n  // Validate customer ID\r\n  if (!context.params.id) {\r\n    return new Response(JSON.stringify({ error: \"Customer ID is required\" }), {\r\n      status: 400,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n\r\n  const { id } = context.params;\r\n  await CUSTOMER_WORKFLOW.create({ params: { id } });\r\n  return new Response(null, { status: 202 });\r\n};\r\n\r\nexport const POST = withPerformanceMonitoring(postHandler, 'customers-workflow:create');\r\n"],"names":[],"mappings":";;;;;;AASA,MAAM,WAAA,GAAwB,OAAO,OAAA,KAAwB;AAC3D,EAAA,MAAM,EAAE,iBAAA,EAAkB,GAAK,OAAA,CAAQ,OAAe,OAAA,CAAQ,GAAA;AAG9D,EAAA,MAAM,UAAA,GAAa,MAAM,YAAA,CAAa,OAAO,CAAA;AAC7C,EAAA,IAAI,UAAA,YAAsB,UAAU,OAAO,UAAA;AAG3C,EAAA,MAAM,eAAA,GAAkB,SAAA,CAAU,WAAA,CAAY,MAAA,EAAQ,WAAW,CAAA;AACjE,EAAA,MAAM,WAAA,GAAc,MAAM,eAAA,CAAgB,UAAU,CAAA;AACpD,EAAA,IAAI,WAAA,YAAuB,UAAU,OAAO,WAAA;AAG5C,EAAA,IAAI,CAAC,OAAA,CAAQ,MAAA,CAAO,EAAA,EAAI;AACtB,IAAA,OAAO,IAAI,SAAS,IAAA,CAAK,SAAA,CAAU,EAAE,KAAA,EAAO,yBAAA,EAA2B,CAAA,EAAG;AAAA,MACxE,MAAA,EAAQ,GAAA;AAAA,MACR,OAAA,EAAS,EAAE,cAAA,EAAgB,kBAAA;AAAmB,KAC/C,CAAA;AAAA,EACH;AAEA,EAAA,MAAM,EAAE,EAAA,EAAG,GAAI,OAAA,CAAQ,MAAA;AACvB,EAAA,MAAM,kBAAkB,MAAA,CAAO,EAAE,QAAQ,EAAE,EAAA,IAAM,CAAA;AACjD,EAAA,OAAO,IAAI,QAAA,CAAS,IAAA,EAAM,EAAE,MAAA,EAAQ,KAAK,CAAA;AAC3C,CAAA;AAEO,MAAM,IAAA,GAAO,yBAAA,CAA0B,WAAA,EAAa,2BAA2B,CAAA;;;;;;;;;;;"}