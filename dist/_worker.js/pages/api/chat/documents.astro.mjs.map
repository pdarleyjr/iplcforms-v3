{"version":3,"file":"documents.astro.mjs","sources":["../../../../../src/pages/api/chat/documents.ts"],"sourcesContent":["import type { APIRoute } from 'astro';\n\nexport const GET: APIRoute = async ({ url, locals }) => {\n  const env = locals.runtime.env;\n  const conversationId = url.searchParams.get('conversationId');\n  \n  try {\n    // List all documents, optionally filtered by conversation\n    const prefix = conversationId ? `doc:` : 'doc:';\n    const { keys } = await env.CHAT_HISTORY.list({\n      prefix,\n      limit: 1000\n    });\n    \n    // Fetch all document metadata\n    const documents = [];\n    for (const key of keys) {\n      const docData = await env.CHAT_HISTORY.get(key.name);\n      if (docData) {\n        const doc = JSON.parse(docData);\n        // Filter by conversationId if specified\n        if (!conversationId || doc.conversationId === conversationId) {\n          documents.push(doc);\n        }\n      }\n    }\n    \n    // Sort by upload date, newest first\n    documents.sort((a, b) => \n      new Date(b.uploadedAt).getTime() - new Date(a.uploadedAt).getTime()\n    );\n    \n    return new Response(JSON.stringify({\n      documents,\n      total: documents.length\n    }), {\n      headers: { 'Content-Type': 'application/json' }\n    });\n    \n  } catch (error) {\n    console.error('Failed to list documents:', error);\n    return new Response(JSON.stringify({ \n      error: 'Failed to list documents',\n      details: error instanceof Error ? error.message : 'Unknown error'\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' }\n    });\n  }\n};"],"names":[],"mappings":";;;AAEO,MAAM,GAAA,GAAgB,OAAO,EAAE,GAAA,EAAK,QAAO,KAAM;AACtD,EAAA,MAAM,GAAA,GAAM,OAAO,OAAA,CAAQ,GAAA;AAC3B,EAAA,MAAM,cAAA,GAAiB,GAAA,CAAI,YAAA,CAAa,GAAA,CAAI,gBAAgB,CAAA;AAE5D,EAAA,IAAI;AAEF,IAAA,MAAM,MAAA,GAAS,iBAAiB,CAAA,IAAA,CAAA,GAAS,MAAA;AACzC,IAAA,MAAM,EAAE,IAAA,EAAK,GAAI,MAAM,GAAA,CAAI,aAAa,IAAA,CAAK;AAAA,MAC3C,MAAA;AAAA,MACA,KAAA,EAAO;AAAA,KACR,CAAA;AAGD,IAAA,MAAM,YAAY,EAAC;AACnB,IAAA,KAAA,MAAW,OAAO,IAAA,EAAM;AACtB,MAAA,MAAM,UAAU,MAAM,GAAA,CAAI,YAAA,CAAa,GAAA,CAAI,IAAI,IAAI,CAAA;AACnD,MAAA,IAAI,OAAA,EAAS;AACX,QAAA,MAAM,GAAA,GAAM,IAAA,CAAK,KAAA,CAAM,OAAO,CAAA;AAE9B,QAAA,IAAI,CAAC,cAAA,IAAkB,GAAA,CAAI,cAAA,KAAmB,cAAA,EAAgB;AAC5D,UAAA,SAAA,CAAU,KAAK,GAAG,CAAA;AAAA,QACpB;AAAA,MACF;AAAA,IACF;AAGA,IAAA,SAAA,CAAU,IAAA;AAAA,MAAK,CAAC,CAAA,EAAG,CAAA,KACjB,IAAI,KAAK,CAAA,CAAE,UAAU,CAAA,CAAE,OAAA,KAAY,IAAI,IAAA,CAAK,CAAA,CAAE,UAAU,EAAE,OAAA;AAAQ,KACpE;AAEA,IAAA,OAAO,IAAI,QAAA,CAAS,IAAA,CAAK,SAAA,CAAU;AAAA,MACjC,SAAA;AAAA,MACA,OAAO,SAAA,CAAU;AAAA,KAClB,CAAA,EAAG;AAAA,MACF,OAAA,EAAS,EAAE,cAAA,EAAgB,kBAAA;AAAmB,KAC/C,CAAA;AAAA,EAEH,SAAS,KAAA,EAAO;AACd,IAAA,OAAA,CAAQ,KAAA,CAAM,6BAA6B,KAAK,CAAA;AAChD,IAAA,OAAO,IAAI,QAAA,CAAS,IAAA,CAAK,SAAA,CAAU;AAAA,MACjC,KAAA,EAAO,0BAAA;AAAA,MACP,OAAA,EAAS,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU;AAAA,KACnD,CAAA,EAAG;AAAA,MACF,MAAA,EAAQ,GAAA;AAAA,MACR,OAAA,EAAS,EAAE,cAAA,EAAgB,kBAAA;AAAmB,KAC/C,CAAA;AAAA,EACH;AACF,CAAA;;;;;;;;;;;"}